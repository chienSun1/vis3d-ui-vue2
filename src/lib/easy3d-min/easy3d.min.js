"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var $=_interopDefault(require("jquery")),axios=_interopDefault(require("axios")),L=require("leaflet"),MarkdownItSanitizer=(require("leaflet/dist/leaflet.css"),_interopDefault(require("markdown-it-sanitizer"))),MarkdownIt=_interopDefault(require("markdown-it")),Hammer=_interopDefault(require("hammerjs"));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _createSuper(i){var o=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(i);return _possibleConstructorReturn(this,o?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function cartesianToLnglat(e,t){return e?(t=(t=t||window.viewer).scene.globe.ellipsoid.cartesianToCartographic(e),e=Cesium.Math.toDegrees(t.latitude),[Cesium.Math.toDegrees(t.longitude),e,t.height]):[]}function cartesiansToLnglats(e,t){if(e&&!(e.length<1)){t=t||window.viewer;for(var i=[],o=0;o<e.length;o++)i.push(cartesianToLnglat(e[o],t));return i}}function lnglatsToCartesians(e){if(e&&!(e.length<1)){for(var t=[],i=0;i<e.length;i++){var o=Cesium.Cartesian3.fromDegrees(e[i][0],e[i][1],e[i][2]||0);t.push(o)}return t}}function flyTo(e,t){var i;e&&((i=t.center)?(t=t||{},i instanceof Cesium.Cartesian3&&e.camera.flyToBoundingSphere(new Cesium.BoundingSphere(i),{offset:new Cesium.HeadingPitchRange(Cesium.Math.toRadians(t.heading||0),Cesium.Math.toRadians(t.pitch||-60),t.range||1e4)}),i instanceof Array&&(i=new Cesium.BoundingSphere(Cesium.Cartesian3.fromDegrees(i[0],i[1],i[2])),e.camera.flyToBoundingSphere(i,{offset:new Cesium.HeadingPitchRange(Cesium.Math.toRadians(t.heading||0),Cesium.Math.toRadians(t.pitch||-60),t.range||1e4)}))):console.log("缺少定位坐标！"))}function getCameraView(e){var e=(e=e||window.viewer).camera,t=e.position,i=e.heading,o=e.pitch,e=e.roll,t=Cesium.Cartographic.fromCartesian(t);return{x:Cesium.Math.toDegrees(t.longitude),y:Cesium.Math.toDegrees(t.latitude),z:t.height,heading:Cesium.Math.toDegrees(i),pitch:Cesium.Math.toDegrees(o),roll:Cesium.Math.toDegrees(e)}}function setCameraView(e,t){var i,t=t||window.viewer;e&&(i=e.destination||Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z),t.camera.flyTo({destination:i,orientation:{heading:Cesium.Math.toRadians(e.heading||0),pitch:Cesium.Math.toRadians(e.pitch||0),roll:Cesium.Math.toRadians(e.roll||0)},duration:void 0===e.duration?3:e.duration,complete:e.complete}))}function oreatationToHpr(e,t,i){var o;if(e&&t)return o=new Cesium.Matrix3,t=Cesium.Matrix3.fromQuaternion(t,o),o=Cesium.Matrix4.fromRotationTranslation(t,e,new Cesium.Matrix4),e=(t=Cesium.Transforms.fixedFrameToHeadingPitchRoll(o,Cesium.Ellipsoid.WGS84,Cesium.Transforms.eastNorthUpToFixedFrame,new Cesium.HeadingPitchRoll)).heading,o=t.pitch,t=t.roll,i&&(e=Cesium.Math.toDegrees(e),o=Cesium.Math.toDegrees(o),t=Cesium.Math.toDegrees(t)),{heading:e,pitch:o,roll:t}}var PI=3.141592653589793,a=6378245,ee=.006693421622965943;function transformWD(e,t){var i=2*e-100+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return(i+=2*(20*Math.sin(6*e*PI)+20*Math.sin(2*e*PI))/3)+2*(20*Math.sin(t*PI)+40*Math.sin(t/3*PI))/3+2*(160*Math.sin(t/12*PI)+320*Math.sin(t*PI/30))/3}function transformJD(e,t){t=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return(t+=2*(20*Math.sin(6*e*PI)+20*Math.sin(2*e*PI))/3)+2*(20*Math.sin(e*PI)+40*Math.sin(e/3*PI))/3+2*(150*Math.sin(e/12*PI)+300*Math.sin(e/30*PI))/3}function wgs2gcj(e){var t=Number(e[0]),e=Number(e[1]),i=transformWD(t-105,e-35),o=transformJD(t-105,e-35),n=e/180*PI,s=Math.sin(n),s=1-ee*s*s,r=Math.sqrt(s),e=e+180*i/(a*(1-ee)/(s*r)*PI),i=t+180*o/(a/r*Math.cos(n)*PI);return[i=Number(i.toFixed(6)),e=Number(e.toFixed(6))]}function gcj2wgs(e){var t=Number(e[0]),e=Number(e[1]),i=transformWD(t-105,e-35),o=transformJD(t-105,e-35),n=e/180*PI,s=Math.sin(n),s=1-ee*s*s,r=Math.sqrt(s),i=180*i/(a*(1-ee)/(s*r)*PI),s=2*t-(t+180*o/(a/r*Math.cos(n)*PI)),t=2*e-(e+i);return[s=Number(s.toFixed(6)),t=Number(t.toFixed(6))]}function lerpPositions(e){if(e&&0!=e.length){var t=Cesium.PolylinePipeline.generateArc({positions:e,granularity:1e-5});if(t){for(var i=[],o=0;o<t.length;o+=3){var n=Cesium.Cartesian3.unpack(t,o);i.push(n)}return i}}}function getIntersectPosition(e,t){var i=t.startPoint,t=t.endPoint;if(i&&t)return t=Cesium.Cartesian3.subtract(t.clone(),i.clone(),new Cesium.Cartesian3),t=Cesium.Cartesian3.normalize(t,new Cesium.Cartesian3),i=new Cesium.Ray(i.clone(),t.clone()),(t=e.scene.pickFromRay(i))?t.position:null;console.log("缺少坐标！")}function getCirclePoints(e,t,i){for(var o=Cesium.Cartesian3.distance(e.clone(),t.clone()),n=[],s=0;s<360;s+=i){var r=new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(s),Cesium.Math.toRadians(0),Cesium.Math.toRadians(0)),r=Cesium.Transforms.headingPitchRollToFixedFrame(e.clone(),r),r=Cesium.Matrix4.getMatrix3(r,new Cesium.Matrix3),r=Cesium.Matrix3.multiplyByVector(r,t.clone(),new Cesium.Cartesian3),a=Cesium.Cartesian3.subtract(r.clone(),e.clone(),new Cesium.Cartesian3),a=Cesium.Cartesian3.normalize(a,new Cesium.Cartesian3),r=(a=Cesium.Cartesian3.multiplyByScalar(a,o,new Cesium.Cartesian3),Cesium.Cartesian3.add(e.clone(),a.clone(),new Cesium.Cartesian3)),a=Cesium.Cartographic.fromCartesian(r.clone());n.push(a)}return n.unshift(),n}function getCirclePointsByRadius(e,t){var t=t||{},i=t.center,o=t.radius,n=t.angle;if(i&&o){for(var n=n||60,s=[],r=Cesium.Transforms.eastNorthUpToFixedFrame(i.clone()),t=Cesium.Matrix4.inverse(r,new Cesium.Matrix4),t=Cesium.Matrix4.multiplyByPoint(t,i.clone(),new Cesium.Cartesian3),a=Cesium.Cartesian3.add(t,new Cesium.Cartesian3(o,0,0),new Cesium.Cartesian3),l=0;l<=360;l+=n){var h=Cesium.Math.toRadians(l),h=Cesium.Matrix3.fromRotationZ(h),h=Cesium.Matrix3.multiplyByVector(h,a.clone(),new Cesium.Cartesian3),h=Cesium.Matrix4.multiplyByPoint(r,h.clone(),new Cesium.Cartesian3);s.push(h)}return s}}function computeAngle(e,t){var i=e.longitude,e=e.latitude,o=t.longitude,t=t.latitude,n=Math.sin(o-i)*Math.cos(t),e=Math.cos(e)*Math.sin(t)-Math.sin(e)*Math.cos(t)*Math.cos(o-i),t=Math.atan2(n,e);return(t=180*t/Math.PI)<-180&&(t+=360),t}function updatePositionsHeight(e,t){if(e&&null!=t){for(var i=[],o=0;o<e.length;o++){var n=cartesianToLnglat(e[o]),n=Cesium.Cartesian3.fromDegrees(n[0],n[1],t);i.push(n)}return i}}function computeUniforms(e,t,i){if(e){t=t||1e3;var e=new Cesium.PolygonGeometry.fromPositions({positions:e,vertexFormat:Cesium.PerInstanceColorAppearance.FLAT_VERTEX_FORMAT,granularity:Math.PI/Math.pow(2,11)/t}),o=new Cesium.PolygonGeometry.createGeometry(e),n=o.indices,s=o.attributes.position,r={uniformArr:[]};r.minHeight=Number.MAX_VALUE,r.maxHeight=Number.MIN_VALUE;for(var a=0;a<n.length;a+=3){var l={},h=n[a],c=n[a+1],u=n[a+2],h=new Cesium.Cartesian3(s.values[3*h],o.attributes.position.values[3*h+1],s.values[3*h+2]),d=(i?get3dtilesHeight:getTerrainHeight)(h),c=new Cesium.Cartesian3(s.values[3*c],o.attributes.position.values[3*c+1],s.values[3*c+2]),p=(i?get3dtilesHeight:getTerrainHeight)(c),u=new Cesium.Cartesian3(o.attributes.position.values[3*u],o.attributes.position.values[3*u+1],s.values[3*u+2]),m=(i?get3dtilesHeight:getTerrainHeight)(u);l.height=(d+p+m)/3,r.minHeight>l.height&&(r.minHeight=l.height),r.maxHeight<l.height&&(r.maxHeight=l.height),l.area=computeAreaOfTriangle(h,c,u),r.uniformArr.push(l)}return r}}function getTerrainHeight(e){if(e)return viewer.scene.globe.getHeight(Cesium.Cartographic.fromCartesian(e))}function get3dtilesHeight(e){if(e)return viewer.scene.sampleHeight(Cesium.Cartographic.fromCartesian(e))}function computeAreaOfTriangle(e,t,i){var o;return e&&t&&i?(e=((o=Cesium.Cartesian3.distance(e,t))+(t=Cesium.Cartesian3.distance(t,i))+(i=Cesium.Cartesian3.distance(i,e)))/2,Math.sqrt(e*(e-o)*(e-t)*(e-i))):(console.log("传入坐标有误！"),0)}function getSlopePosition(e,t,i,o){if(e&&t){for(var n=getCirclePointsByRadius(e,{center:t,radius:i||10,angle:o||10}),s=Number.MAX_VALUE,e=getTerrainHeight(t.clone()),r=-1,a=0;a<n.length;a++){var l=getTerrainHeight(n[a]);l<s&&(s=l,r=a)}var i=(s<e?(h=t.clone(),n[r]):(h=n[r].clone(),t)).clone(),o=Cesium.Cartographic.fromCartesian(h),t=Cesium.Cartographic.fromCartesian(i),h=Cesium.Cartesian3.fromRadians(o.longitude,o.latitude,s<e?e:s),o=(i=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,s<e?s:e),Cesium.Cartesian3.distance(h,i)),t=Math.abs(e-s),e=Math.acos(t/o);return{startP:h,endP:i,slope:Cesium.Math.toDegrees(e)}}}var cUtil$1={getSlopePosition:getSlopePosition,getCirclePointsByRadius:getCirclePointsByRadius,updatePositionsHeight:updatePositionsHeight,computeUniforms:computeUniforms,cartesianToLnglat:cartesianToLnglat,cartesiansToLnglats:cartesiansToLnglats,lnglatsToCartesians:lnglatsToCartesians,flyTo:flyTo,getCameraView:getCameraView,setCameraView:setCameraView,wgs2gcj:wgs2gcj,gcj2wgs:gcj2wgs,lerpPositions:lerpPositions,oreatationToHpr:oreatationToHpr,getIntersectPosition:getIntersectPosition,getCirclePoints:getCirclePoints,computeAngle:computeAngle};function downloadCanvasIamge(e,t){var e=e.toDataURL("image/png"),i=(console.log(e),document.createElement("a")),o=new MouseEvent("click");i.download=t||"下载图片名称",i.href=e,i.dispatchEvent(o)}var file={_download:function(e,t){var i=document.createElement("a");i.download=e,i.href=URL.createObjectURL(t),document.body.appendChild(i),i.click(),document.body.removeChild(i)},downloadFile:function(e,t){t=new Blob([t]);this._download(e,t)},downloadImage:function(e,t){t=t.toDataURL("image/png"),t=this.base64Img2Blob(t);this._download(e+".png",t)},base64Img2Blob:function(e){for(var e=e.split(";base64,"),t=e[0].split(":")[1],i=window.atob(e[1]),o=i.length,n=new Uint8Array(o),s=0;s<o;++s)n[s]=i.charCodeAt(s);return new Blob([n],{type:t})}},cTool={downloadCanvasIamge:downloadCanvasIamge,file:file},Prompt$1=function(){function h(e,t){var i,o,n,s,r,a,l;_classCallCheck(this,h),this.viewer=e,this.viewer&&(this.type="prompt",e=null==(t=t||{}).type?1:t.type,i={id:(new Date).getTime()+""+Math.floor(1e4*Math.random()),type:e,anchor:2==e,closeBtn:2==e,offset:2==e?{x:0,y:-20}:{x:30,y:20},content:"",show:!0,style:{background:"rgba(0,0,0,0.5)",color:"white"}},this.opt=Object.assign(i,t),i=this.viewer.container.id,this.isShow=null==this.opt.show||this.opt.show,o=t="",r=this.opt.style.background,a=this.opt.style.color,this.opt.anchor&&(t+='\n            <div class="prompt-anchor-container">\n                <div class="prompt-anchor" style="background:'.concat(r,' !important;">\n                </div>\n            </div>\n            ')),this.opt.closeBtn&&(o='<a class="prompt-close" attr="'.concat(this.opt.id,'" id="prompt-close-').concat(this.opt.id,'" href="#close">x</a>')),n=this.opt.style.boxShadow,s="prompt-"+this.opt.id,r='\n                \x3c!-- 文本内容 --\x3e\n                <div class="prompt-content-container" style="background:'.concat(r," !important;color:").concat(a," !important;box-shadow:").concat(n,'">\n                    <div class="prompt-content" id="prompt-content-').concat(this.opt.id,'">\n                        ').concat(this.opt.content,"\n                    </div>\n                </div>\n                \x3c!-- 锚 --\x3e\n                ").concat(t,"\n                \x3c!-- 关闭按钮 --\x3e\n                ").concat(o,"\n        "),this.promptDiv=window.document.createElement("div"),this.promptDiv.className="easy3d-prompt",this.promptDiv.id=s,this.promptDiv.innerHTML=r,window.document.getElementById(i).appendChild(this.promptDiv),a=window.document.getElementById("prompt-close-".concat(this.opt.id)),l=this,a&&a.addEventListener("click",function(e){l.hide(),l.close&&l.close()}),this.promptDom=window.document.getElementById(s),this.contentW=this.promptDom.offsetWidth,this.contentH=this.promptDom.offsetHeight,this.position=this.transPosition(this.opt.position),2==e&&this.bindRender(),0==this.opt.show&&this.hide(),this.containerW=this.viewer.container.offsetWidth,this.containerH=this.viewer.container.offsetHeight,this.containerLeft=this.viewer.container.offsetLeft,this.containerTop=this.viewer.container.offsetTop)}return _createClass(h,[{key:"destroy",value:function(){this.promptDiv&&(window.document.getElementById(this.viewer.container.id).removeChild(this.promptDiv),this.promptDiv=null),this.rendHandler&&(this.rendHandler(),this.rendHandler=null)}},{key:"bindRender",value:function(){var t=this;this.rendHandler=this.viewer.scene.postRender.addEventListener(function(){var e;!t.isShow&&t.promptDom?t.promptDom.style.display="none":t.position&&(t.position instanceof Cesium.Cartesian3?(e=Cesium.SceneTransforms.wgs84ToWindowCoordinates(t.viewer.scene,t.position))&&(new Cesium.EllipsoidalOccluder(t.viewer.scene.globe.ellipsoid,t.viewer.scene.camera.position).isPointVisible(t.position)?t.promptDom&&(t.promptDom.style.display="block"):t.promptDom&&(t.promptDom.style.display="none"),t.setByPX({x:e.x,y:e.y})):t.setByPX({x:t.position.x,y:t.position.y}))},this)}},{key:"update",value:function(e,t){e instanceof Cesium.Cartesian3&&(this.position=e.clone(),e=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,e)),e&&this.setByPX(e),t&&this.setContent(t)}},{key:"isInView",value:function(){var e,t,i;return!!this.position&&(e=null,e=this.position instanceof Cesium.Cartesian2?this.position:Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.position),t=new Cesium.EllipsoidalOccluder(this.viewer.scene.globe.ellipsoid,this.viewer.scene.camera.position).isPointVisible(this.position),i=!1,(!e||(e.x>this.containerLeft&&e.x<this.containerLeft+this.containerW&&e.y>this.containerTop&&e.y<this.containerTop+this.containerH&&(i=!0),t))&&i)}},{key:"setVisible",value:function(e){this.isInView(this.position)&&e?(this.isShow=!0,this.promptDom&&(this.promptDom.style.display="block")):(this.isShow=!1,this.promptDom&&(this.promptDom.style.display="none"))}},{key:"show",value:function(){this.setVisible(!0)}},{key:"hide",value:function(){this.setVisible(!1)}},{key:"setContent",value:function(e){window.document.getElementById("prompt-content-".concat(this.opt.id)).innerHTML=e}},{key:"setByPX",value:function(e){e&&this.promptDom&&(this.promptDom.style.left=Number(e.x)+Number(this.opt.offset.x||0)-Number(this.contentW)/2+"px",this.promptDom.style.top=Number(e.y)+Number(this.opt.offset.y||0)-Number(this.contentH)+"px")}},{key:"transPosition",value:function(e){return Array.isArray(e)&&Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]||0).clone(),e instanceof Cesium.Cartesian3?e.clone():e}}]),h}(),BasePlot=function(){function i(e,t){_classCallCheck(this,i),this.viewer=e,this.style=(t=t||{})||{},this.objId=Number((new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0)),this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.positions=[],this.state=null,this.prompt=null,this.controlPoints=[],this.modifyPoint=null,this.entity=null,this.pointStyle={},this.promptStyle=t.prompt||{show:!0,offset:{x:30,y:30}},this.properties={}}return _createClass(i,[{key:"getCatesian3FromPX",value:function(e){for(var t,i=this.viewer.scene.drillPick(e),o=(this.viewer.scene.render(),!1),n=0;n<i.length;n++)if(i[n]&&i[n].primitive&&i[n].primitive instanceof Cesium.Cesium3DTileset){o=!0;break}if(o)t=this.viewer.scene.pickPosition(e);else{e=this.viewer.camera.getPickRay(e);if(!e)return null;t=this.viewer.scene.globe.pick(e,this.viewer.scene)}return t}},{key:"getEntity",value:function(){return this.entity}},{key:"getPositions",value:function(e){return e?cUtil$1.cartesiansToLnglats(this.positions,this.viewer):this.positions}},{key:"setOwnProp",value:function(e){this.entity&&(this.entity.ownProp=e)}},{key:"remove",value:function(){this.entity&&(this.state="no",this.viewer.entities.remove(this.entity),this.entity=null)}},{key:"setVisible",value:function(e){this.entity.show=e}},{key:"forbidDrawWorld",value:function(e){this.viewer.scene.screenSpaceCameraController.enableRotate=!e,this.viewer.scene.screenSpaceCameraController.enableTilt=!e,this.viewer.scene.screenSpaceCameraController.enableTranslate=!e,this.viewer.scene.screenSpaceCameraController.enableInputs=!e}},{key:"destroy",value:function(){this.handler&&(this.handler.destroy(),this.handler=null),this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null),this.entity&&(this.viewer.entities.remove(this.entity),this.entity=null),this.positions=[],this.style=null;for(var e=0;e<this.controlPoints.length;e++){var t=this.controlPoints[e];this.viewer.entities.remove(t)}this.controlPoints=[],this.modifyPoint=null,this.prompt&&(this.prompt.destroy(),this.prompt=null),this.state="no",this.forbidDrawWorld(!1)}},{key:"startEdit",value:function(e){if("startEdit"!=this.state&&"editing"!=this.state&&this.entity){this.state="startEdit",this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas));for(var t=this,i=0;i<t.controlPoints.length;i++){var o=t.controlPoints[i];o&&(o.show=!0)}this.entity.show=!0,this.modifyHandler.setInputAction(function(e){t.entity&&(e=t.viewer.scene.pick(e.position),Cesium.defined(e)&&e.id&&(e.id.objId||(t.modifyPoint=e.id),t.forbidDrawWorld(!0)))},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.modifyHandler.setInputAction(function(e){t.positions.length<1||!t.modifyPoint||(e=t.getCatesian3FromPX(e.endPosition,t.viewer,[t.entity,t.modifyPoint]))&&(t.modifyPoint.position.setValue(e),t.positions[t.modifyPoint.wz]=e,t.state="editing")},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.modifyHandler.setInputAction(function(e){t.modifyPoint&&(t.modifyPoint=null,t.forbidDrawWorld(!1),t.state="editing")},Cesium.ScreenSpaceEventType.LEFT_UP)}}},{key:"endEdit",value:function(e){for(var t=0;t<this.controlPoints.length;t++){var i=this.controlPoints[t];i&&(i.show=!1)}this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null,e&&e(this.entity)),this.forbidDrawWorld(!1),this.state="endEdit"}},{key:"createPoint",value:function(e){var t,i;if(e)return this.pointStyle.color=this.pointStyle.color||Cesium.Color.CORNFLOWERBLUE,this.pointStyle.outlineColor=this.pointStyle.color||Cesium.Color.CORNFLOWERBLUE,t=(t=this.pointStyle.color instanceof Cesium.Color?this.pointStyle.color:Cesium.Color.fromCssColorString(this.pointStyle.color)).withAlpha(this.pointStyle.colorAlpha||1),i=(i=this.pointStyle.outlineColor instanceof Cesium.Color?this.pointStyle.outlineColor:Cesium.Color.fromCssColorString(this.pointStyle.outlineColor)).withAlpha(this.pointStyle.outlineColorAlpha||1),this.viewer.entities.add({position:e,point:{pixelSize:this.pointStyle.property||10,color:t,outlineWidth:this.pointStyle.outlineWidth||0,outlineColor:i,disableDepthTestDistance:Number.POSITIVE_INFINITY},show:!1})}},{key:"transfromLineMaterial",value:function(e){var t;if(e)return t={},e instanceof Cesium.Color&&(e=e.color.getValue(),t.colorAlpha=e.alpha,t.colorHex=new Cesium.Color(e.red,e.green,e.blue,1).toCssHexString()),t}},{key:"transfromGonMaterial",value:function(e){var t;if(e)return t={},e instanceof Cesium.Color&&(e=e.color.getValue(),t.colorAlpha=e.alpha,t.colorHex=new Cesium.Color(e.red,e.green,e.blue,1).toCssHexString()),t}},{key:"setAttr",value:function(e){this.properties.attr=e||{}}},{key:"zoomTo",value:function(){this.entity&&this.viewer.zoomTo(this.entity)}}]),i}(),CreateBillboard=function(){_inherits(n,BasePlot);var o=_createSuper(n);function n(e,t){_classCallCheck(this,n),(i=o.call(this,e,t)).type="billboard",i.viewer=e;var i,e={verticalOrigin:Cesium.VerticalOrigin.BOTTOM,scale:1};return i.style=Object.assign({},e,t||{}),i.entity=null,i.style.hasOwnProperty("image")||console.log("未设置billboard的参数！"),i.position=null,i}return _createClass(n,[{key:"start",value:function(t){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle)),this.state="startCreate";var i=this;this.handler.setInputAction(function(e){e=i.getCatesian3FromPX(e.position,i.viewer);e&&(i.position=e.clone(),i.entity=i.createBillboard(i.position),i.handler&&(i.handler.destroy(),i.handler=null),i.prompt&&(i.prompt.destroy(),i.prompt=null),i.state="endCreate",t&&t(i.entity))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){i.prompt.update(e.endPosition,"单击新增"),i.state="startCreate"},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"createByPositions",value:function(e,t){var i;e&&(this.state="startCreate",i=null,(i=e instanceof Cesium.Cartesian3?e.clone():Cesium.Cartesian3.fromDegrees(Number(e[0]),Number(e[1]),Number(e[2]||0)))&&(this.position=i.clone(),this.entity=this.createBillboard(this.position),t&&t(this.entity),this.state="endCreate"))}},{key:"setStyle",value:function(e){var t,i;e&&(t=this.entity.billboard,null!=e.image&&(t.image=e.image),null!=e.heightReference&&(i=(i=1)==this.style.heightReference?1:this.style.heightReference,t.heightReference=i),null!=e.heightReference&&(t.heightReference=null==e.heightReference?1:Number(this.style.heightReference)),null!=e.scale&&(t.scale=Number(e.scale)),e.color&&(i=(i=e.color instanceof Cesium.Color?e.color:Cesium.Color.fromCssColorString(e.color)).withAlpha(e.colorAlpha||1),t.color=i),this.style=Object.assign(this.style,e))}},{key:"getStyle",value:function(){var e,t={},i=this.entity.billboard;return t.image=this.style.image,i.heightReference&&(e=i.heightReference.getValue(),t.heightReference=Boolean(e)),t.scale=i.scale.getValue(),i.color&&(e=i.color.getValue(),t.colorAlpha=e.alpha,t.color=new Cesium.Color(e.red,e.green,e.blue,1).toCssHexString()),t}},{key:"startEdit",value:function(){var t,i;"startEdit"!=this.state&&"editing"!=this.state&&this.entity&&(this.state="startEdit",this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),(t=this).modifyHandler.setInputAction(function(e){e=t.viewer.scene.pick(e.position);Cesium.defined(e)&&e.id&&(i=e.id,t.forbidDrawWorld(!0))},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.modifyHandler.setInputAction(function(e){!i||(e=t.getCatesian3FromPX(e.endPosition,t.viewer))&&(i.position.setValue(e.clone()),t.position=e.clone(),t.state="editing")},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.modifyHandler.setInputAction(function(e){i&&(t.forbidDrawWorld(!1),t.modifyHandler&&(t.modifyHandler.destroy(),t.modifyHandler=null,t.state="editing"))},Cesium.ScreenSpaceEventType.LEFT_UP))}},{key:"endEdit",value:function(e){this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null,e&&e(this.entity)),this.state="endEdit"}},{key:"createBillboard",value:function(e){if(e)return(e=this.viewer.entities.add({position:e,billboard:{color:this.style.color?this.style.color instanceof Cesium.Color?this.style.color:Cesium.Color.fromCssColorString(this.style.outlineColor).withAlpha(this.style.outlineColorAlpha||1):Cesium.Color.WHITE,image:this.style.image||"../img/mark4.png",scale:this.style.scale||1,pixelOffset:this.style.pixelOffset,heightReference:null==this.style.heightReference?1:Number(this.style.heightReference),verticalOrigin:Cesium.VerticalOrigin.BOTTOM}})).objId=this.objId,e}},{key:"remove",value:function(){this.entity&&(this.state="no",this.viewer.entities.remove(this.entity),this.entity=null)}},{key:"getPositions",value:function(e){return e?cUtil$1.cartesianToLnglat(this.position,this.viewer):this.position}},{key:"setPosition",value:function(e){var t=null,t=e instanceof Cesium.Cartesian3?e:Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]||0);this.entity.position.setValue(t.clone()),this.position=t.clone()}}]),n}(),CreateCircle=function(){_inherits(n,BasePlot);var o=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=o.call(this,e,t)).type="circle",i.objId=Number((new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0)),i.viewer=e,i.style=t,i.floatPoint=null,i.centerPoint=null,i.position=null,i.floatPosition=null,i.radius=.001,i.modifyPoint=null,i.pointArr=[],i}return _createClass(n,[{key:"start",value:function(t){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle)),this.state="startCreate";var i=this;this.handler.setInputAction(function(e){e=i.getCatesian3FromPX(e.position,i.viewer);e&&(i.centerPoint?i.entity&&(i.floatPosition=e.clone(),i.state="endCreate",i.handler&&(i.handler.destroy(),i.handler=null),i.floatPoint&&(i.floatPoint.show=!1),i.centerPoint&&(i.centerPoint.show=!1),i.prompt&&(i.prompt.destroy(),i.prompt=null),t&&t(i.entity)):(i.position=e,i.centerPoint=i.createPoint(e),i.centerPoint.typeAttr="center",i.floatPoint=i.createPoint(e.clone()),i.floatPosition=e.clone(),i.floatPoint.typeAttr="float",i.entity=i.createCircle(i.position,i.radius)))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){var t;i.centerPoint?(i.state="creating",i.prompt.update(e.endPosition,"再次单击结束"),(t=i.getCatesian3FromPX(e.endPosition,i.viewer))&&(i.floatPoint&&(i.floatPoint.position.setValue(t),i.floatPosition=t.clone()),i.radius=Cesium.Cartesian3.distance(t,i.position))):i.prompt.update(e.endPosition,"单击开始绘制")},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"createByPositions",value:function(e,t){if(e&&!(e.length<1)){if(this.state="startCreate",Array.isArray(e)){var i=[];if(!(i=e[0]instanceof Cesium.Cartesian3?e:cUtil$1.lnglatsToCartesians(e))||i.length<1)return;this.position=i[0].clone(),this.radius=Cesium.Cartesian3.distance(this.position,i[1]),this.floatPosition=i[1].clone()}else this.position=e.position,this.radius=e.radius,this.floatPosition=cUtil$1.getPositionByLength();this.centerPoint=this.createPoint(this.position),this.centerPoint.typeAttr="center",this.floatPoint=this.createPoint(this.float),this.floatPoint.typeAttr="float",this.entity=this.createCircle(this.position,this.radius),this.state="endCreate",t&&t(this.entity)}}},{key:"startEdit",value:function(t){var i;"startEdit"!=this.state&&"editing"!=this.state&&this.entity&&(this.state="startEdit",this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),(i=this).floatPoint&&(i.floatPoint.show=!0),i.centerPoint&&(i.centerPoint.show=!0),this.modifyHandler.setInputAction(function(e){i.entity&&(i.state="editing",e=i.viewer.scene.pick(e.position),Cesium.defined(e)&&e.id?(e.id.objId||(i.modifyPoint=e.id),i.forbidDrawWorld(!0)):(i.floatPoint&&(i.floatPoint.show=!1),i.centerPoint&&(i.centerPoint.show=!1),i.modifyHandler&&(i.modifyHandler.destroy(),i.modifyHandler=null,t&&t(i.entity))))},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.modifyHandler.setInputAction(function(e){var t;!i.modifyPoint||(e=i.getCatesian3FromPX(e.endPosition,i.viewer))&&(i.state="editing","center"==i.modifyPoint.typeAttr?(t=Cesium.Cartesian3.subtract(e,i.position,new Cesium.Cartesian3),i.position=e,i.centerPoint.position.setValue(i.position),i.entity.position.setValue(i.position),i.floatPosition=Cesium.Cartesian3.add(i.float,t,new Cesium.Cartesian3),i.floatPoint.position.setValue(i.float)):(i.floatPosition=e,i.floatPoint.position.setValue(i.float),i.radius=Cesium.Cartesian3.distance(i.float,i.position)))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.modifyHandler.setInputAction(function(e){i.modifyPoint&&(i.modifyPoint=null,i.forbidDrawWorld(!1),i.state="editing")},Cesium.ScreenSpaceEventType.LEFT_UP))}},{key:"endEdit",value:function(e){this.floatPoint&&(this.floatPoint.show=!1),this.centerPoint&&(this.centerPoint.show=!1),this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null,e&&e(this.entity)),this.forbidDrawWorld(!1),this.state="endEdit"}},{key:"createCircle",value:function(){var e=this,t={semiMajorAxis:new Cesium.CallbackProperty(function(){return e.radius},!1),semiMinorAxis:new Cesium.CallbackProperty(function(){return e.radius},!1),material:this.style.color instanceof Cesium.Color?this.style.color:this.style.color?Cesium.Color.fromCssColorString(this.style.color).withAlpha(this.style.colorAlpha||1):Cesium.Color.WHITE,outlineColor:this.style.outlineColor instanceof Cesium.Color?this.style.outlineColor:this.style.outlineColor?Cesium.Color.fromCssColorString(this.style.outlineColor).withAlpha(this.style.outlineColorAlpha||1):Cesium.Color.BLACK,outline:this.style.outline,outlineWidth:1,fill:this.style.fill},t=(this.style.heightReference&&0!=Number(this.style.heightReference)?t.heightReference=1:(t.height=100,t.heightReference=0),this.viewer.entities.add({position:this.position,ellipse:t}));return t.objId=this.objId,t}},{key:"setStyle",value:function(e){var t;e&&(t=(t=Cesium.Color.fromCssColorString(e.color||"#ffff00")).withAlpha(e.colorAlpha),this.entity.ellipse.material=t,this.entity.ellipse.outline=e.outline,this.entity.ellipse.outlineWidth=e.outlineWidth,t=(t=Cesium.Color.fromCssColorString(e.outlineColor||"#000000")).withAlpha(e.outlineColorAlpha),this.entity.ellipse.outlineColor=t,this.entity.ellipse.heightReference=Number(e.heightReference),0==e.heightReference&&(this.entity.ellipse.height=Number(e.height),this.updatePointHeight(e.height)),this.entity.ellipse.fill=Boolean(e.fill),this.style=Object.assign(this.style,e))}},{key:"getStyle",value:function(){var e={},t=this.entity.ellipse,i=t.material.color.getValue(),i=(e.colorAlpha=i.alpha,e.color=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString(),t.outline&&(e.outline=t.outline.getValue()),e.outlineWidth=t.outlineWidth._value,t.outlineColor.getValue());return e.outlineColorAlpha=i.alpha,e.outlineColor=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString(),t.height&&(e.height=t.height.getValue()),t.fill&&(e.fill=t.fill.getValue()),e.heightReference=t.heightReference.getValue(),e}},{key:"destroy",value:function(){this.handler&&(this.handler.destroy(),this.handler=null),this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null),this.entity&&(this.viewer.entities.remove(this.entity),this.entity=null),this.floatPoint&&(this.viewer.entities.remove(this.floatPoint),this.floatPoint=null),this.centerPoint&&(this.viewer.entities.remove(this.centerPoint),this.centerPoint=null),this.style=null,this.modifyPoint=null,this.prompt&&this.prompt.destroy(),this.forbidDrawWorld(!1),this.state="no"}},{key:"updatePointHeight",value:function(e){var t=this.centerPoint.position.getValue(),i=this.floatPoint.position.getValue(),t=cUtil$1.updatePositionsHeight([t],Number(this.style.height))[0],i=cUtil$1.updatePositionsHeight([i],Number(this.style.height))[0];this.centerPoint.position.setValue(t),this.floatPoint.position.setValue(i)}},{key:"getPositions",value:function(e){return e?cUtil$1.cartesiansToLnglats([this.position,this.floatPosition]):[this.position,this.floatPosition]}}]),n}(),CreateGltfModel=function(){_inherits(n,BasePlot);var o=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=o.call(this,e,t)).type="gltfModel",t=t||{},i.viewer=e,t.uri?(i.style=Object.assign({heading:0,pitch:0,roll:0,minimumPixelSize:24,maximumScale:120},t||{}),i.modelUri=t.uri,i.entity=null,i):(console.warn("请输入模型地址！"),_possibleConstructorReturn(i))}return _createClass(n,[{key:"start",value:function(t){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle)),this.state="startCreate";var i=this;this.handler.setInputAction(function(e){e=i.getCatesian3FromPX(e.position,i.viewer);e&&(i.entity.position=e,i.position=e.clone()),i.state="endCreate",i.handler&&(i.handler.destroy(),i.handler=null),i.prompt&&(i.prompt.destroy(),i.prompt=null),t&&t(i.entity)},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){i.prompt.update(e.endPosition,"单击新增");e=i.getCatesian3FromPX(e.endPosition,i.viewer,[i.entity]);e&&(i.entity?i.entity.position=e:i.entity=i.createGltfModel(e.clone()))},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"createByPositions",value:function(e,t){e&&(this.state="startCreate",e instanceof Cesium.Cartesian3?this.position=e:this.position=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]||0),this.entity=this.createGltfModel(this.position),t(this.entity),this.state="endCreate")}},{key:"startEdit",value:function(){var t,i;"startEdit"!=this.state&&"editing"!=this.state&&(this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),(t=this).state="startEdit",this.modifyHandler.setInputAction(function(e){e=t.viewer.scene.pick(e.position);Cesium.defined(e)&&e.id&&(i=e.id,t.forbidDrawWorld(!0))},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.modifyHandler.setInputAction(function(e){!i||(e=t.getCatesian3FromPX(e.endPosition,t.viewer,[t.entity]))&&(t.entity&&(t.entity.position.setValue(e),t.position=e.clone()),t.state="editing")},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.modifyHandler.setInputAction(function(e){i&&(t.forbidDrawWorld(!1),t.modifyHandler&&(t.modifyHandler.destroy(),t.modifyHandler=null),t.state="editing")},Cesium.ScreenSpaceEventType.LEFT_UP))}},{key:"endEdit",value:function(e){this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null,e&&e(this.entity)),this.forbidDrawWorld(!1),this.state="endEdit"}},{key:"createGltfModel",value:function(e){var t,i,o;if(e)return t=Cesium.Math.toRadians(this.style.heading),i=Cesium.Math.toRadians(this.style.pitch),o=Cesium.Math.toRadians(this.style.roll),t=new Cesium.HeadingPitchRoll(t,i,o),i=Cesium.Transforms.headingPitchRollQuaternion(e,t),(o=this.viewer.entities.add({position:e,orientation:i,model:{uri:this.modelUri,minimumPixelSize:this.style.minimumPixelSize,maximumScale:this.style.maximumScale,scale:this.style.scale||1,heightReference:this.style.heightReference}})).objId=this.objId,o}},{key:"getPositions",value:function(e){return e?cUtil$1.cartesianToLnglat(this.position,this.viewer):this.position}},{key:"getStyle",value:function(){var e={},t=this.entity.model,i=(e.minimumPixelSize=t.minimumPixelSize.getValue(),this.entity.orientation.getValue()),o=this.entity.position.getValue(this.viewer.clock.currentTime),o=cUtil$1.oreatationToHpr(o.clone(),i,!0)||{};return e.heading=(o.heading||0)<360?o.heading+360:o.heading,e.pitch=o.pitch||0,e.roll=o.roll||0,e.scale=t.scale.getValue(),e.uri=t.uri.getValue(),e}},{key:"setStyle",value:function(e){e&&(this.setOrientation(e.heading,e.pitch,e.roll),this.entity.model.scale.setValue(null==e.scale?1:e.scale),e.uri&&this.entity.model.uri.setValue(e.uri),null!=e.heightReference&&this.entity.model.heightReference.setValue(Number(e.heightReference)),this.style=Object.assign(this.style,e))}},{key:"setOrientation",value:function(e,t,i){t=t||0,i=i||0,this.style.heading=e=e||0,this.style.pitch=t,this.style.roll=i;e=Cesium.Math.toRadians(e||0),t=Cesium.Math.toRadians(t||0),i=Cesium.Math.toRadians(i||0),e=new Cesium.HeadingPitchRoll(e,t,i),t=this.entity.position._value,i=Cesium.Transforms.headingPitchRollQuaternion(t,e);this.entity&&(this.entity.orientation=i)}},{key:"remove",value:function(){this.entity&&(this.state="no",this.viewer.entities.remove(this.entity),this.entity=null)}},{key:"destroy",value:function(){this.handler&&(this.handler.destroy(),this.handler=null),this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null),this.entity&&(this.viewer.entities.remove(this.entity),this.entity=null),this.style=null,this.prompt&&(that.prompt.destroy(),this.prompt=null)}}]),n}(),CreateLabel=function(){_inherits(n,BasePlot);var o=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=o.call(this,e,t)).type="label",i.objId=Number((new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0)),i.viewer=e,i.style=t,i.position=null,i}return _createClass(n,[{key:"start",value:function(n){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle));var s=this;this.state="startCreate",this.handler.setInputAction(function(e){var t,i,o=s.getCatesian3FromPX(e.position,s.viewer);o&&(s.prompt.update(e.position,'\n        <ul class="label-context-'.concat(s.objId,'" objId="').concat(s.objId,'">\n          <li>名称：<input type="text" objId="').concat(s.objId,'" id="label-name-').concat(s.objId,'" /></li>\n          <li>\n              <input type="button" value="确定" objId="').concat(s.objId,'" id="label-confirm-').concat(s.objId,'"/>\n              <input type="button" value="取消" objId="').concat(s.objId,'" id="label-reset-').concat(s.objId,'"/>\n          </li>\n        <ul>\n      ')),t=document.getElementById("label-confirm-".concat(s.objId)),i=document.getElementById("label-reset-".concat(s.objId)),t.addEventListener("click",function(){var e=t.getAttribute("objId"),e=document.getElementById("label-name-".concat(e)).innerText();s.entity=s.createLabel(o,e),s.position=o,s.state="endCreate",s.handler&&(s.handler.destroy(),s.handler=null),s.prompt&&(s.prompt.destroy(),s.prompt=null),n&&n(s.entity)}),i.addEventListener("click",function(){i.getAttribute("objId");s.destroy()}))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){s.prompt.update(e.endPosition,"单击新增"),s.state="startCreate"},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"createByPositions",value:function(e,t){e&&(this.state="startCreate",e=e instanceof Cesium.Cartesian3?e:Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),(this.position=e)&&(this.entity=this.createLabel(e,this.style.text),t&&t(this.entity),this.state="endCreate"))}},{key:"setStyle",value:function(e){var t;e&&(e.fillColor&&(t=(t=e.fillColor instanceof Cesium.Color?e.fillColor:Cesium.Color.fromCssColorString(e.fillColor||"#ffff00")).withAlpha(e.fillColorAlpha||1),this.entity.label.fillColor=t),this.entity.label.outlineWidth=e.outlineWidth,e.backgroundColor&&(t=(t=e.backgroundColor instanceof Cesium.Color?e.backgroundColor:Cesium.Color.fromCssColorString(e.backgroundColor||"#000000")).withAlpha(e.backgroundColorAlpha||1),this.entity.label.backgroundColor=t),null!=e.heightReference&&(this.entity.label.heightReference=Number(e.heightReference)),e.pixelOffset&&(this.entity.label.pixelOffset=e.pixelOffset),e.text&&(this.entity.label.text=e.text),null!=e.showBackground&&(this.entity.label.showBackground=Boolean(e.showBackground)),this.style=Object.assign(this.style,e))}},{key:"getStyle",value:function(){var e={},t=this.entity.label,i=t.fillColor.getValue(),i=(e.fillColorAlpha=i.alpha,e.fillColor=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString(),e.outlineWidth=t.outlineWidth._value,t.backgroundColor.getValue());return e.backgroundColorAlpha=i.alpha,e.backgroundColor=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString(),e.showBackground=Boolean(t.showBackground.getValue()),null!=t.heightReference&&(e.heightReference=t.heightReference.getValue()),e.pixelOffset=t.pixelOffset,e.text=t.text.getValue(),e}},{key:"getPositions",value:function(e){return e?cUtil$1.cartesianToLnglat(this.position):this.position}},{key:"startEdit",value:function(){var t,i;"startEdit"!=this.state&&"editing"!=this.state&&this.entity&&(this.state="startEdit",this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),(t=this).modifyHandler.setInputAction(function(e){e=t.viewer.scene.pick(e.position);Cesium.defined(e)&&e.id&&(i=e.id,t.forbidDrawWorld(!0))},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.modifyHandler.setInputAction(function(e){!i||(e=t.getCatesian3FromPX(e.endPosition,t.viewer))&&t.entity&&(t.entity.position.setValue(e),t.position=e,t.state="editing")},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.modifyHandler.setInputAction(function(e){i&&(t.forbidDrawWorld(!1),t.modifyHandler&&(t.modifyHandler.destroy(),t.modifyHandler=null,t.state="editing"))},Cesium.ScreenSpaceEventType.LEFT_UP))}},{key:"endEdit",value:function(e){this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null,e&&e(this.entity)),this.forbidDrawWorld(!1),this.state="endEdit"}},{key:"createLabel",value:function(e,t){if(e)return(e=this.viewer.entities.add({position:e,label:{text:t||"",fillColor:this.style.fillColor?Cesium.Color.fromCssColorString(this.style.fillColor).withAlpha(this.style.fillColorAlpha||1):Cesium.Color.WHITE,backgroundColor:this.style.backgroundColor?Cesium.Color.fromCssColorString(this.style.backgroundColor).withAlpha(this.style.backgroundColorAlpha||1):Cesium.Color.WHITE,style:Cesium.LabelStyle.FILL,outlineWidth:this.style.outlineWidth||4,scale:this.style.scale||1,pixelOffset:this.style.pixelOffset||Cesium.Cartesian2.ZERO,showBackground:this.style.showBackground,heightReference:this.style.heightReference||0}})).objId=this.objId,e}}]),n}(),CreatePoint=function(){_inherits(n,BasePlot);var o=_createSuper(n);function n(e,t){_classCallCheck(this,n),(i=o.call(this,e,t)).type="point",i.viewer=e;var i,e={color:Cesium.Color.AQUA,pixelSize:10,outlineWidth:1};return i.style=Object.assign(e,t||{}),i.position=null,i}return _createClass(n,[{key:"start",value:function(t){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle)),this.state="startCreate";var i=this;this.handler.setInputAction(function(e){e=i.getCatesian3FromPX(e.position,i.viewer);e&&(i.entity=i.createPoint(e),i.position=e,i.state="endCreate",i.handler&&(i.handler.destroy(),i.handler=null),i.prompt&&(i.prompt.destroy(),i.prompt=null),t&&t(i.entity))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){i.prompt.update(e.endPosition,"单击新增"),i.state="startCreate"},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"createByPositions",value:function(e,t){e&&(this.state="startCreate",e=e instanceof Cesium.Cartesian3?e:Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),(this.position=e)&&(this.entity=this.createPoint(e),t&&t(this.entity),this.state="endCreate"))}},{key:"setStyle",value:function(e){var t;e&&(e.color&&(t=(t=Cesium.Color.fromCssColorString(e.color||"#ffff00")).withAlpha(e.colorAlpha),this.entity.point.color=t),this.entity.point.outlineWidth=Number(e.outlineWidth),e.outlineColor&&(t=(t=Cesium.Color.fromCssColorString(e.outlineColor||"#000000")).withAlpha(e.outlineColorAlpha),this.entity.point.outlineColor=t),this.entity.point.heightReference=Number(e.heightReference),this.entity.point.pixelSize=Number(e.pixelSize),this.style=Object.assign(this.style,e))}},{key:"getStyle",value:function(){var e={},t=this.entity.point,i=t.color.getValue(),i=(e.colorAlpha=i.alpha,e.color=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString(),e.outlineWidth=t.outlineWidth._value,t.outlineColor.getValue());return e.outlineColorAlpha=i.alpha,e.outlineColor=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString(),null!=t.heightReference&&(e.heightReference=t.heightReference.getValue()),e.pixelSize=Number(t.pixelSize),e}},{key:"getPositions",value:function(e){return e?cUtil$1.cartesianToLnglat(this.position):this.position}},{key:"startEdit",value:function(){var t,i;"startEdit"!=this.state&&"editing"!=this.state&&this.entity&&(this.state="startEdit",this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),(t=this).modifyHandler.setInputAction(function(e){e=t.viewer.scene.pick(e.position);Cesium.defined(e)&&e.id&&(i=e.id,t.forbidDrawWorld(!0))},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.modifyHandler.setInputAction(function(e){!i||(e=t.getCatesian3FromPX(e.endPosition,t.viewer))&&t.entity&&(t.entity.position.setValue(e),t.position=e,t.state="editing")},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.modifyHandler.setInputAction(function(e){i&&(t.forbidDrawWorld(!1),t.modifyHandler&&(t.modifyHandler.destroy(),t.modifyHandler=null,t.state="editing"))},Cesium.ScreenSpaceEventType.LEFT_UP))}},{key:"endEdit",value:function(e){this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null,e&&e(this.entity)),this.forbidDrawWorld(!1),this.state="endEdit"}},{key:"createPoint",value:function(e){if(e)return(e=this.viewer.entities.add({position:e,point:{color:this.style.color instanceof Cesium.Color?this.style.color:this.style.color?Cesium.Color.fromCssColorString(this.style.color).withAlpha(this.style.colorAlpha||1):Cesium.Color.WHITE,outlineColor:this.style.outlineColor instanceof Cesium.Color?this.style.outlineColor:this.style.outlineColor?Cesium.Color.fromCssColorString(this.style.outlineColor).withAlpha(this.style.outlineColorAlpha||1):Cesium.Color.BLACK,outlineWidth:this.style.outlineWidth||4,pixelSize:this.style.pixelSize||20}})).objId=this.objId,e}}]),n}(),CreatePolygon=function(){_inherits(n,BasePlot);var o=_createSuper(n);function n(e,t){var i;_classCallCheck(this,n),(i=o.call(this,e,t)).type="polygon",i.viewer=e,i.entity=null,i.polyline=null;return i.style=Object.assign({outlineColor:"#000000",outlineWidth:2},t||{}),i.outline=null,i}return _createClass(n,[{key:"start",value:function(t){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle)),this.state="startCreate";var i=this;this.handler.setInputAction(function(e){var e=i.getCatesian3FromPX(e.position,i.viewer,[]);e&&(i.movePush&&(i.positions.pop(),i.movePush=!1),i.positions.push(e),(e=i.createPoint(e)).wz=i.positions.length-1,i.controlPoints.push(e))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){i.positions.length<1?(i.prompt.update(e.endPosition,"单击开始绘制"),i.state="startCreate"):(i.prompt&&i.prompt.update(e.endPosition,"双击结束，右键取消上一步"),e=i.getCatesian3FromPX(e.endPosition,i.viewer,[]),1<=i.positions.length&&(i.state="creating",i.movePush?i.positions[i.positions.length-1]=e:(i.positions.push(e),i.movePush=!0),2!=i.positions.length||Cesium.defined(i.polyline)||(i.polyline=i.createPolyline()),3!=i.positions.length||Cesium.defined(i.entity)||(i.entity=i.createPolygon(i.style),!i.style.outline&&i.polyline&&(i.polyline.show=!1),i.entity.objId=i.objId)))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){i.entity&&(i.positions.splice(i.positions.length-2,1),i.viewer.entities.remove(i.controlPoints.pop()),2==i.positions.length&&i.entity&&(i.viewer.entities.remove(i.entity),i.entity=null,i.polyline&&(i.polyline.show=!0)),1==i.positions.length&&(i.polyline&&(i.viewer.entities.remove(i.polyline),i.polyline=null),i.prompt&&i.prompt.update(e.endPosition,"单击开始绘制"),i.positions=[],i.movePush=!1))},Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.handler.setInputAction(function(e){i.entity&&(i.state="endCreate",i.positions.pop(),i.viewer.entities.remove(i.controlPoints.pop()),i.handler&&(i.handler.destroy(),i.handler=null),i.movePush=!1,i.prompt&&(i.prompt.destroy(),i.prompt=null),i.viewer.trackedEntity=void 0,i.viewer.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),t&&t(i.entity))},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}},{key:"createByPositions",value:function(e,t){if(e){this.state="startCreate";var i=e[0]instanceof Cesium.Cartesian3?e:cUtil$1.lnglatsToCartesians(e);if(i){this.entity=this.createPolygon(),this.polyline=this.createPolyline(),this.polyline.show=this.style.outline,this.positions=i;for(var o=0;o<i.length;o++){var n=i[o],s=Cesium.Cartographic.fromCartesian(i[o]),n=(this.style.heightReference&&(s.height=this.viewer.scene.sampleHeight(s),n=Cesium.Cartographic.toCartesian(s)),this.createPoint(n));n.ctgc=s,n.wz=this.controlPoints.length,this.controlPoints.push(n)}this.state="endCreate",this.entity.objId=this.objId,t&&t(this.entity)}}}},{key:"getStyle",value:function(){var e,t,i;if(this.entity)return e={},(t=this.entity.polygon).material instanceof Cesium.ColorMaterialProperty&&(e.material="common",i=t.material.color.getValue(),e.colorAlpha=i.alpha,e.color=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString()),e.fill=!!t.fill&&t.fill.getValue(),t.heightReference&&(i=t.heightReference.getValue(),e.heightReference=Boolean(i)),(t=this.polyline.polyline)&&this.polyline.show?(e.outlineWidth=t.width.getValue(),e.outline=!0,i=t.material.color.getValue(),e.outlineColorAlpha=i.alpha,e.outlineColor=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString()):e.outline=!1,e}},{key:"setStyle",value:function(e){var t,i;e&&(this.polyline.show=e.outline,(i=this.polyline.polyline).width=e.outlineWidth,this.polyline.clampToGround=Boolean(e.heightReference),t=(e.outlineColor instanceof Cesium.Color?e.outlineColor:Cesium.Color.fromCssColorString(e.outlineColor)).withAlpha(e.outlineColorAlpha||1),i.material=t,null!=e.heightReference&&(this.entity.polygon.heightReference=Number(e.heightReference)),i=(e.color instanceof Cesium.Color?e.color:Cesium.Color.fromCssColorString(e.color)).withAlpha(e.colorAlpha||1),this.entity.polygon.material=i,null!=e.fill&&(this.entity.polygon.fill=e.fill),this.style=Object.assign(this.style,e))}},{key:"createPolygon",value:function(){var e=this,t=(this.style.color=this.style.color||Cesium.Color.WHITE,this.style.outlineColor=this.style.outlineColor||Cesium.Color.BLACK,{polygon:{hierarchy:new Cesium.CallbackProperty(function(){return new Cesium.PolygonHierarchy(e.positions)},!1),heightReference:Number(this.style.heightReference),show:!0,fill:this.style.fill||!0,material:this.style.color instanceof Cesium.Color?this.style.color:Cesium.Color.fromCssColorString(this.style.color).withAlpha(this.style.colorAlpha||1)}});return this.style.heightReference||(t.polygon.height=0,t.polygon.perPositionHeight=!0),this.viewer.entities.add(t)}},{key:"createPolyline",value:function(){var e=this;return this.viewer.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return e.positions.concat(e.positions[0])},!1),clampToGround:Boolean(this.style.heightReference),material:this.style.outlineColor instanceof Cesium.Color?this.style.outlineColor:Cesium.Color.fromCssColorString(this.style.outlineColor).withAlpha(this.style.outlineColorAlpha||1),width:this.style.outlineWidth||1}})}},{key:"destroy",value:function(){this.handler&&(this.handler.destroy(),this.handler=null),this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null),this.entity&&(this.viewer.entities.remove(this.entity),this.entity=null),this.polyline&&(this.viewer.entities.remove(this.polyline),this.polyline=null),this.positions=[],this.style=null,this.modifyPoint&&(this.viewer.entities.remove(this.modifyPoint),this.modifyPoint=null);for(var e=0;e<this.controlPoints.length;e++){var t=this.controlPoints[e];this.viewer.entities.remove(t)}this.controlPoints=[],this.state="no",this.prompt&&this.prompt.destroy(),this.polyline&&(this.polyline=null,this.viewer.entities.remove(this.polyline)),this.forbidDrawWorld(!1)}}]),n}(),CreateRectangle=function(){_inherits(n,BasePlot);var o=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=o.call(this,e,t)).type="rectangle",i.viewer=e,i.style=t,i.rightdownPoint=null,i.leftupPoint=null,i.leftup=null,i.rightdown=null,i.radius=0,i.modifyPoint=null,i.pointArr=[],i}return _createClass(n,[{key:"start",value:function(t){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle)),this.state="startCreate";var i=this;this.handler.setInputAction(function(e){e=i.getCatesian3FromPX(e.position,i.viewer,[]);e&&(i.leftupPoint?i.entity&&(i.state="endCreate",i.handler&&(i.handler.destroy(),i.handler=null),i.rightdownPoint&&(i.rightdownPoint.show=!1),i.leftupPoint&&(i.leftupPoint.show=!1),i.prompt&&(i.prompt.destroy(),i.prompt=null),t&&t(i.entity)):(i.leftup=e,i.leftupPoint=i.createPoint(e),i.leftupPoint.typeAttr="leftup",i.rightdownPoint=i.createPoint(e.clone()),i.rightdown=e.clone(),i.rightdownPoint.typeAttr="rightdown",i.entity=i.createRectangle(i.leftup,i.radius)))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){var t;i.leftupPoint?(i.prompt.update(e.endPosition,"单击结束"),(t=i.getCatesian3FromPX(e.endPosition,i.viewer,[]))&&(i.rightdownPoint&&(i.rightdownPoint.position.setValue(t),i.rightdown=t.clone(),i.state="creating"),i.radius=Cesium.Cartesian3.distance(t,i.leftup))):(i.prompt.update(e.endPosition,"单击开始绘制"),i.state="startCreate")},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"startEdit",value:function(e){var t;"startEdit"!=this.state&&"editing"!=this.state&&this.entity&&(this.state="startEdit",this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),(t=this).rightdownPoint&&(t.rightdownPoint.show=!0),t.leftupPoint&&(t.leftupPoint.show=!0),this.modifyHandler.setInputAction(function(e){t.entity&&(e=t.viewer.scene.pick(e.position),Cesium.defined(e)&&e.id&&(e.id.objId||(t.modifyPoint=e.id),t.forbidDrawWorld(!0)))},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.modifyHandler.setInputAction(function(e){!t.modifyPoint||(e=t.getCatesian3FromPX(e.endPosition,t.viewer,[t.entity,t.modifyPoint]))&&(t.state,"leftup"==t.modifyPoint.typeAttr?(t.leftup=e,t.leftupPoint.position.setValue(t.leftup),t.entity.position.setValue(t.leftup)):(t.rightdown=e,t.rightdownPoint.position.setValue(t.rightdown)),t.radius=Cesium.Cartesian3.distance(t.rightdown,t.leftup))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.modifyHandler.setInputAction(function(e){t.modifyPoint&&(t.modifyPoint=null,t.forbidDrawWorld(!1),t.state)},Cesium.ScreenSpaceEventType.LEFT_UP))}},{key:"endEdit",value:function(e){this.rightdownPoint&&(this.rightdownPoint.show=!1),this.leftupPoint&&(this.leftupPoint.show=!1),this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null,e&&e(this.entity)),this.forbidDrawWorld(!1),this.state="endEdit"}},{key:"createRectangle",value:function(){var e=this,t=this.viewer.entities.add({rectangle:{coordinates:new Cesium.CallbackProperty(function(){return Cesium.Rectangle.fromCartesianArray([e.leftup,e.rightdown])},!1),heightReference:this.style.heightReference||0,show:!0,fill:this.style.fill||!0,material:this.style.color instanceof Cesium.Color?this.style.color:this.style.color?Cesium.Color.fromCssColorString(this.style.color).withAlpha(this.style.colorAlpha||1):Cesium.Color.WHITE,outlineColor:this.style.outlineColor instanceof Cesium.Color?this.style.outlineColor:this.style.outlineColor?Cesium.Color.fromCssColorString(this.style.outlineColor).withAlpha(this.style.outlineColorAlpha||1):Cesium.Color.BLACK,outlineWidth:1,outline:this.style.outline}});return t.objId=this.objId,t}},{key:"getPositions",value:function(e){return e?cUtil.cartesiansToLnglats([this.leftup,this.rightdown]):[this.leftup,this.rightdown]}},{key:"getStyle",value:function(){var e={},t=this.entity.rectangle,i=t.material.color.getValue(),i=(e.colorAlpha=i.alpha,e.color=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString(),t.outline&&(e.outline=t.outline.getValue()),e.outlineWidth=t.outlineWidth._value,t.outlineColor.getValue());return e.outlineColorAlpha=i.alpha,e.outlineColor=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString(),e.height&&(e.height=t.height.getValue()),t.fill&&(e.fill=t.fill.getValue()),e.heightReference=t.heightReference.getValue(),e}},{key:"setStyle",value:function(e){var t;e&&(t=e.color instanceof Cesium.Color?e.color:Cesium.Color.fromCssColorString(e.color||"#ffff00"),e.colorAlpha&&(t=t.withAlpha(e.colorAlpha)),this.entity.rectangle.material=t,this.entity.rectangle.outline=e.outline,this.entity.rectangle.outlineWidth=e.outlineWidth,t=e.outlineColor instanceof Cesium.Color?e.outlineColor:Cesium.Color.fromCssColorString(e.outlineColor||"#000000"),e.outlineColorAlpha&&(t=t.withAlpha(e.outlineColorAlpha)),this.entity.rectangle.outlineColor=t,this.entity.rectangle.heightReference=Number(e.heightReference),0==e.heightReference&&(this.entity.rectangle.height=Number(e.height),this.updatePointHeight(e.height)),this.entity.rectangle.fill=Boolean(e.fill),this.style=Object.assign(this.style,e))}}]),n}(),CreatePolyline=function(){_inherits(n,BasePlot);var o=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),i=o.call(this,e,t),(i=o.call(this,e,t=t||{})).movePush=!1,i.type="polyline",i.maxPointNum=t.maxPointNum||Number.MAX_VALUE,i}return _createClass(n,[{key:"start",value:function(t){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle)),this.state="startCreate";var i=this;this.handler.setInputAction(function(e){var e=i.getCatesian3FromPX(e.position,i.viewer,[i.entity]);e&&(i.movePush&&(i.positions.pop(),i.movePush=!1),i.positions.push(e),(e=i.createPoint(e)).wz=i.positions.length-1,i.controlPoints.push(e),i.positions.length==i.maxPointNum&&(i.state="endCreate",i.handler&&(i.handler.destroy(),i.handler=null),i.prompt&&(i.prompt.destroy(),i.prompt=null),i.viewer.trackedEntity=void 0,i.viewer.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),t&&t(i.entity)))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){i.state="creating",i.positions.length<1?(i.prompt.update(e.endPosition,"单击开始绘制"),i.state="startCreate"):(i.prompt.update(e.endPosition,"右键取消上一步，双击结束"),(e=i.getCatesian3FromPX(e.endPosition,i.viewer,[i.entity]))&&(i.movePush?i.positions[i.positions.length-1]=e:(i.positions.push(e),i.movePush=!0),2!=i.positions.length||Cesium.defined(i.entity)||(i.entity=i.createPolyline())))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){i.entity&&(i.positions.splice(i.positions.length-2,1),i.viewer.entities.remove(i.controlPoints.pop()),1==i.positions.length&&(i.entity&&(i.viewer.entities.remove(i.entity),i.entity=null),i.prompt.update(e.endPosition,"单击开始绘制"),i.movePush=!1,i.positions=[]))},Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.handler.setInputAction(function(e){i.entity&&(i.state="endCreate",i.handler&&(i.handler.destroy(),i.handler=null),i.positions.pop(),i.viewer.entities.remove(i.controlPoints.pop()),i.prompt&&(i.prompt.destroy(),i.prompt=null),i.viewer.trackedEntity=void 0,i.viewer.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),t&&t(i.entity))},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}},{key:"createByPositions",value:function(e,t){if(e&&!(e.length<1)){this.state="startCreate";var i=e[0]instanceof Cesium.Cartesian3?e:cUtil.lnglatsToCartesians(e);if(i){this.entity=this.createPolyline(this.style),this.positions=i,t&&t(this.entity);for(var o=0;o<i.length;o++){var n=i[o],s=(this.style.clampToGround&&((s=Cesium.Cartographic.fromCartesian(i[o])).height=this.viewer.scene.sampleHeight(s),n=Cesium.Cartographic.toCartesian(s)),this.createPoint(n));s.wz=this.controlPoints.length,this.controlPoints.push(s)}this.state="endCreate"}}}},{key:"setStyle",value:function(e){var t;e&&(t=void 0,t=e.lineType?this.getMaterial(e.lineType,e):(e.color instanceof Cesium.Color?e.color:Cesium.Color.fromCssColorString(e.color||"#000000")).withAlpha(e.colorAlpha||1),this.entity.polyline.material=t,this.entity.polyline.clampToGround=Number(e.clampToGround),e.width&&(this.entity.polyline.width=e.width||3),this.style=Object.assign(this.style,e))}},{key:"getStyle",value:function(){var e,t,i;if(this.entity)return e={},t=this.entity.polyline,null!=this.style.lineType&&(e.lineType=this.style.lineType,e.image=this.style.image,e.duration=this.style.duration),t.material instanceof Cesium.ColorMaterialProperty?e.material="common":(t.material instanceof FlowLineMaterial&&(e.material="flowLine"),t.material instanceof FlyLineMaterial&&(e.material="flyLine"),e.duration=t.material.duration),i=t.material.color.getValue(),e.colorAlpha=i.alpha,e.color=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString(),e.width=t.width._value,e.clampToGround=!!t.clampToGround&&t.clampToGround.getValue(),e}},{key:"createPolyline",value:function(){var e=this,t=this.viewer.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return e.positions},!1),show:!0,material:this.getMaterial(this.style.lineType,this.style),width:this.style.width||3,clampToGround:this.style.clampToGround}});return t.objId=this.objId,t}},{key:"getMaterial",value:function(e,t){t=t||{};return"flowLine"==e?new FlowLineMaterial({color:t.color||Cesium.Color.RED,image:t.image||"../img/texture/lineClr.png",duration:t.duration||5e3}):"rainbowLine"==e?new FlowLineMaterial({image:t.image||"../img/texture/lineClr2.png",duration:t.duration||5e3}):"flyLine"==e?new FlyLineMaterial({color:t.color||Cesium.Color.RED,duration:t.duration||3e3,image:t.image||"../img/texture/glow.png",repeat:new Cesium.Cartesian2(1,1)}):t.color instanceof Cesium.Color?t.color:t.color?Cesium.Color.fromCssColorString(t.color).withAlpha(t.colorAlpha||1):Cesium.Color.WHITE}}]),n}(),ArrowUtil=function(){function t(e){_classCallCheck(this,t),this.FITTING_COUNT=100,this.HALF_PI=Math.PI/2,this.ZERO_TOLERANCE=1e-4,this.TWO_PI=2*Math.PI,this.headHeightFactor=e.headHeightFactor,this.headWidthFactor=e.headWidthFactor,this.neckHeightFactor=e.neckHeightFactor,this.neckWidthFactor=e.neckWidthFactor,this.headTailFactor=e.headTailFactor,this.tailWidthFactor=e.tailWidthFactor,this.swallowTailFactor=e.swallowTailFactor}return _createClass(t,[{key:"cartesian32WeMercator",value:function(e){if(e)return e=this.cartesianToLnglat(e),this.lnglat2WeMercator(e)}},{key:"webMercator2Cartesian3",value:function(e){if(e)return e=this.webMercator2Lnglat(e),Cesium.Cartesian3.fromDegrees(e[0],e[1])}},{key:"webMercator2Lnglat",value:function(e){var t;if(e)return t=e[0]/20037508.34*180,e=e[1]/20037508.34*180,[t,e=180/Math.PI*(2*Math.atan(Math.exp(e*Math.PI/180))-Math.PI/2)]}},{key:"lnglat2WeMercator",value:function(e){if(e)return[20037508.34*e[0]/180,20037508.34*(Math.log(Math.tan((90+e[1])*Math.PI/360))/(Math.PI/180))/180]}},{key:"getThirdPoint",value:function(e,t,i,o,n){e=this.getAzimuth(e,t),n=n?e+i:e-i,e=o*Math.cos(n),i=o*Math.sin(n);return[t[0]+e,t[1]+i]}},{key:"getAzimuth",value:function(e,t){var i=void 0,o=Math.asin(Math.abs(t[1]-e[1])/this.MathDistance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=o+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=2*Math.PI-o:t[1]<e[1]&&t[0]<e[0]?i=o:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-o),i}},{key:"MathDistance",value:function(e,t){var i=Math.pow(e[0]-t[0],2),e=Math.pow(e[1]-t[1],2);return Math.sqrt(i+e)||.001}},{key:"isClockWise",value:function(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}},{key:"getBisectorNormals",value:function(e,t,i,o){var n=this.getNormal(t,i,o),s=null,r=null,a=null,l=Math.sqrt(n[0]*n[0]+n[1]*n[1]),h=n[0]/l,n=n[1]/l,c=this.MathDistance(t,i),u=this.MathDistance(i,o),r=l>this.ZERO_TOLERANCE?this.isClockWise(t,i,o)?(s=[i[0]-(a=e*c)*n,i[1]+a*h],[i[0]+(a=e*u)*n,i[1]-a*h]):(s=[i[0]+(a=e*c)*n,i[1]-a*h],[i[0]-(a=e*u)*n,i[1]+a*h]):(s=[i[0]+e*(t[0]-i[0]),i[1]+e*(t[1]-i[1])],[i[0]+e*(o[0]-i[0]),i[1]+e*(o[1]-i[1])]);return[s,r]}},{key:"getCubicValue",value:function(e,t,i,o,n){var s=1-(e=Math.max(Math.min(e,1),0)),r=e*e,a=r*e,l=s*s,h=l*s;return[h*t[0]+3*l*e*i[0]+3*s*r*o[0]+a*n[0],h*t[1]+3*l*e*i[1]+3*s*r*o[1]+a*n[1]]}},{key:"getNormal",value:function(e,t,i){var o=e[0]-t[0],e=e[1]-t[1],n=Math.sqrt(o*o+e*e),n=(o/=n,e/=n,i[0]-t[0]),i=i[1]-t[1],t=Math.sqrt(n*n+i*i);return[o+(n/=t),e+(i/=t)]}},{key:"getArcPoints",value:function(e,t,i,o){for(var n=[],s=(s=o-i)<0?s+2*Math.PI:s,r=0;r<=100;r++){var a=i+s*r/100,l=e[0]+t*Math.cos(a),a=e[1]+t*Math.sin(a);n.push([l,a])}return n}},{key:"getBaseLength",value:function(e){return Math.pow(this.wholeDistance(e),.99)}},{key:"wholeDistance",value:function(i){var o=0,n=this;return i&&Array.isArray(i)&&0<i.length&&i.forEach(function(e,t){t<i.length-1&&(o+=n.MathDistance(e,i[t+1]))}),o}},{key:"getArrowHeadPoints",value:function(e,t,i){this.DGIndex=e.length,this.points=e;var o=this.getBaseLength(e)*this.headHeightFactor,n=e[e.length-1],s=this.MathDistance(n,e[e.length-2]),t=this.MathDistance(t,i),i=(o=o>t*this.headTailFactor?t*this.headTailFactor:o)*this.headWidthFactor,t=o*this.neckWidthFactor,s=(o=s<o?s:o)*this.neckHeightFactor,o=this.getThirdPoint(e[e.length-2],n,0,o,!0),e=this.getThirdPoint(e[e.length-2],n,0,s,!0),s=this.getThirdPoint(n,o,Math.PI/2,i,!1),o=this.getThirdPoint(n,o,Math.PI/2,i,!0);return[this.getThirdPoint(n,e,Math.PI/2,t,!1),s,n,o,this.getThirdPoint(n,e,Math.PI/2,t,!0)]}},{key:"getArrowHeadPointsNoLR",value:function(e){var t=this.getBaseLength(e)*this.headHeightFactor,i=e[e.length-1],o=t*this.headWidthFactor,n=t*this.neckWidthFactor,s=t*this.neckHeightFactor,t=this.getThirdPoint(e[e.length-2],i,0,t,!0),e=this.getThirdPoint(e[e.length-2],i,0,s,!0),s=this.getThirdPoint(i,t,Math.PI/2,o,!1),t=this.getThirdPoint(i,t,Math.PI/2,o,!0);return[this.getThirdPoint(i,e,Math.PI/2,n,!1),s,i,t,this.getThirdPoint(i,e,Math.PI/2,n,!0)]}},{key:"getTailPoints",value:function(e){var t=this.getBaseLength(e)*this.tailWidthFactor;return[this.getThirdPoint(e[1],e[0],Math.PI/2,t,!1),this.getThirdPoint(e[1],e[0],Math.PI/2,t,!0)]}},{key:"getArrowBodyPoints",value:function(e,t,i,o){for(var n=this.wholeDistance(e),s=this.getBaseLength(e)*o,r=(s-this.MathDistance(t,i))/2,a=0,l=[],h=[],c=1;c<e.length-1;c++){var u=this.getAngleOfThreePoints(e[c-1],e[c],e[c+1])/2,d=(s/2-(a+=this.MathDistance(e[c-1],e[c]))/n*r)/Math.sin(u),p=this.getThirdPoint(e[c-1],e[c],Math.PI-u,d,!0),u=this.getThirdPoint(e[c-1],e[c],u,d,!1);l.push(p),h.push(u)}return l.concat(h)}},{key:"getAngleOfThreePoints",value:function(e,t,i){e=this.getAzimuth(t,e)-this.getAzimuth(t,i);return e<0?e+2*Math.PI:e}},{key:"getQBSplinePoints",value:function(e){if(e.length<=2)return e;var t=[],i=e.length-2-1;t.push(e[0]);for(var o=0;o<=i;o++)for(var n=0;n<=1;n+=.05){for(var s=0,r=0,a=0;a<=2;a++){var l=this.getQuadricBSplineFactor(a,n);s+=l*e[o+a][0],r+=l*e[o+a][1]}t.push([s,r])}return t.push(e[e.length-1]),t}},{key:"getQuadricBSplineFactor",value:function(e,t){var i=0;return 0===e?i=Math.pow(t-1,2)/2:1===e?i=(-2*Math.pow(t,2)+2*t+1)/2:2===e&&(i=Math.pow(t,2)/2),i}},{key:"Mid",value:function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}},{key:"getCircleCenterOfThreePoints",value:function(e,t,i){var o=[(e[0]+t[0])/2,(e[1]+t[1])/2],t=[o[0]-e[1]+t[1],o[1]+e[0]-t[0]],n=[(e[0]+i[0])/2,(e[1]+i[1])/2],e=[n[0]-e[1]+i[1],n[1]+e[0]-i[0]];return this.getIntersectPoint(o,t,n,e)}},{key:"getIntersectPoint",value:function(e,t,i,o){return e[1]===t[1]?[(o[0]-i[0])/(o[1]-i[1])*(e[1]-i[1])+i[0],e[1]]:i[1]===o[1]?[(t[0]-e[0])/(t[1]-e[1])*(i[1]-e[1])+e[0],i[1]]:(t=(t[0]-e[0])/(t[1]-e[1]),o=(o[0]-i[0])/(o[1]-i[1]),[t*(i=(t*e[1]-e[0]-o*i[1]+i[0])/(t-o))-t*e[1]+e[0],i])}},{key:"getBezierPoints",value:function(e){if(e.length<=2)return e;for(var t=[],i=e.length-1,o=0;o<=1;o+=.01){for(var n=0,s=0,r=0;r<=i;r++){var a=this.getBinomialFactor(i,r),l=Math.pow(o,r),h=Math.pow(1-o,i-r);n+=a*l*h*e[r][0],s+=a*l*h*e[r][1]}t.push([n,s])}return t.push(e[i]),t}},{key:"getFactorial",value:function(e){var t=1;switch(e){case e<=1:t=1;break;case 2===e:t=2;break;case 3===e:t=6;break;case 24===e:t=24;break;case 5===e:t=120;break;default:for(var i=1;i<=e;i++)t*=i}return t}},{key:"getBinomialFactor",value:function(e,t){return this.getFactorial(e)/(this.getFactorial(t)*this.getFactorial(e-t))}},{key:"cartesianToLnglat",value:function(e){var t;if(e)return viewer.scene.globe.ellipsoid,e=Cesium.Cartographic.fromCartesian(e),t=Cesium.Math.toDegrees(e.latitude),[Cesium.Math.toDegrees(e.longitude),t,e.height]}},{key:"getCurvePoints",value:function(e,t){for(var i=null,o=null,n=[this.getLeftMostControlPoint(t,e)],s=[],r=0;r<t.length-2;r++)var a=[t[r],t[r+1],t[r+2]],i=a[0],o=a[1],a=this.getBisectorNormals(e,i,o,a[2]),n=n.concat(a);var l=this.getRightMostControlPoint(t,e);l&&n.push(l);for(var h=0;h<t.length-1;h++){i=t[h],o=t[h+1],s.push(i);for(var c=0;c<this.FITTING_COUNT;c++){var u=this.getCubicValue(c/this.FITTING_COUNT,i,n[2*h],n[2*h+1],o);s.push(u)}s.push(o)}return s}},{key:"getLeftMostControlPoint",value:function(e,t){var i,o,n,s,e=[e[0],e[1],e[2],null,null],r=e[0],a=e[1],l=e[2],h=e[3],e=e[4],c=this.getBisectorNormals(0,r,a,l)[0],l=this.getNormal(r,a,l);return e=Math.sqrt(l[0]*l[0]+l[1]*l[1])>this.ZERO_TOLERANCE?(l=this.Mid(r,a),n=r[0]-l[0],i=r[1]-l[1],o=2/this.MathDistance(r,a),s=c[0]-l[0],c=c[1]-l[1],h=l[0]+((i=-o*i)*i-(o=o*n)*o)*s+(n=2*i*o)*c,l[1]+n*s+(o*o-i*i)*c):(h=r[0]+t*(a[0]-r[0]),r[1]+t*(a[1]-r[1])),[h,e]}},{key:"getRightMostControlPoint",value:function(e,t){var i,o,n,s,r=e.length,a=e[r-3],l=e[r-2],e=e[r-1],r=this.getBisectorNormals(0,a,l,e)[1],a=this.getNormal(a,l,e),h=null,c=null;return c=Math.sqrt(a[0]*a[0]+a[1]*a[1])>this.ZERO_TOLERANCE?(a=this.Mid(l,e),n=e[0]-a[0],i=e[1]-a[1],o=2/this.MathDistance(l,e),s=r[0]-a[0],r=r[1]-a[1],h=a[0]+((i=-o*i)*i-(o=o*n)*o)*s+(n=2*i*o)*r,a[1]+n*s+(o*o-i*i)*r):(h=e[0]+t*(l[0]-e[0]),e[1]+t*(l[1]-e[1])),[h,c]}}]),t}(),AttackArrow=function(){function t(e){_classCallCheck(this,t),this.type="AttackArrow",(e=e||{}).headHeightFactor=e.headHeightFactor||.18,e.headWidthFactor=e.headWidthFactor||.3,e.neckHeightFactor=e.neckHeightFactor||.85,e.neckWidthFactor=e.neckWidthFactor||.15,e.headTailFactor=e.headTailFactor||.8,this.positions=null,this.plotUtil=new ArrowUtil(e)}return _createClass(t,[{key:"startCompute",value:function(e){if(e){this.positions=e;for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}var n=[t[0],t[1]],s=n[0],n=n[1];this.plotUtil.isClockWise(t[0],t[1],t[2])&&(s=t[1],n=t[0]);var r=[this.plotUtil.Mid(s,n)].concat(t.slice(2)),a=this.plotUtil.getArrowHeadPoints(r,s,n);if(!a||0==a.length)return console.warn("计算面数据有误，不计算，返回传入坐标数组！"),e;for(var l=[a[0],a[4]],h=l[0],l=l[1],c=this.plotUtil.MathDistance(s,n)/this.plotUtil.getBaseLength(r),r=this.plotUtil.getArrowBodyPoints(r,h,l,c),c=r.length,s=[s].concat(r.slice(0,c/2)),h=(s.push(h),[n].concat(r.slice(c/2,c))),u=(h.push(l),s=this.plotUtil.getQBSplinePoints(s),h=this.plotUtil.getQBSplinePoints(h),s.concat(a,h.reverse())),d=[],p=0;p<u.length;p++){var m=this.plotUtil.webMercator2Cartesian3(u[p]);d.push(m)}return d}}}]),t}(),AttackArrowPW=function(){function i(e){_classCallCheck(this,i);var t={};t.headHeightFactor=(e=e||{}).headHeightFactor||.18,t.headWidthFactor=e.headWidthFactor||.3,t.neckHeightFactor=e.neckHeightFactor||.85,t.neckWidthFactor=e.neckWidthFactor||.15,t.tailWidthFactor=this.tailWidthFactor=e.tailWidthFactor||.1,this.positions=null,this.plotUtil=new ArrowUtil(t)}return _createClass(i,[{key:"startCompute",value:function(e){if(e){this.positions=e;for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}for(var n=this.plotUtil.getTailPoints(t),s=this.plotUtil.getArrowHeadPoints(t,n[0],n[1]),r=s[0],a=s[4],l=this.plotUtil.getArrowBodyPoints(t,r,a,this.tailWidthFactor),h=l.length,c=[n[0]].concat(l.slice(0,h/2)),r=(c.push(r),[n[1]].concat(l.slice(h/2,h))),u=(r.push(a),c=this.plotUtil.getQBSplinePoints(c),r=this.plotUtil.getQBSplinePoints(r),c.concat(s,r.reverse())),d=[],p=0;p<u.length;p++){var m=this.plotUtil.webMercator2Cartesian3(u[p]);d.push(m)}return d}}}]),i}(),AttackArrowYW=function(){function i(e){_classCallCheck(this,i);var t={};t.headHeightFactor=(e=e||{}).headHeightFactor||.18,t.headWidthFactor=e.headWidthFactor||.3,t.neckHeightFactor=e.neckHeightFactor||.85,t.neckWidthFactor=e.neckWidthFactor||.15,t.tailWidthFactor=this.tailWidthFactor=e.tailWidthFactor||.1,t.headTailFactor=e.headTailFactor||.8,t.swallowTailFactor=this.swallowTailFactor=e.swallowTailFactor||1,this.positions=null,this.plotUtil=new ArrowUtil(t)}return _createClass(i,[{key:"startCompute",value:function(e){if(e){this.positions=e;for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}var n=[t[0],t[1]],s=n[0],n=n[1];this.plotUtil.isClockWise(t[0],t[1],t[2])&&(s=t[1],n=t[0]);for(var r=[this.plotUtil.Mid(s,n)].concat(t.slice(2)),a=this.plotUtil.getArrowHeadPoints(r,s,n),l=[a[0],a[4]],h=l[0],l=l[1],c=this.plotUtil.MathDistance(s,n),u=this.plotUtil.getBaseLength(r),d=u*this.tailWidthFactor*this.swallowTailFactor,d=this.plotUtil.getThirdPoint(r[1],r[0],0,d,!0),r=this.plotUtil.getArrowBodyPoints(r,h,l,c/u),c=r.length,u=[s].concat(r.slice(0,c/2)),s=(u.push(h),[n].concat(r.slice(c/2,c))),p=(s.push(l),u=this.plotUtil.getQBSplinePoints(u),s=this.plotUtil.getQBSplinePoints(s),u.concat(a,s.reverse(),[d,u[0]])),m=[],v=0;v<p.length;v++){var f=this.plotUtil.webMercator2Cartesian3(p[v]);m.push(f)}return m}}}]),i}(),CloseCurve=function(){function t(e){_classCallCheck(this,t);this.positions=null,this.plotUtil=new ArrowUtil({})}return _createClass(t,[{key:"startCompute",value:function(e){for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}t.push(t[0],t[1]);for(var n=[],s=[],i=0;i<t.length-2;i++)var r=this.plotUtil.getBisectorNormals(.3,t[i],t[i+1],t[i+2]),n=n.concat(r);var a=n.length;n=[n[a-1]].concat(n.slice(0,a-1));for(var l=0;l<t.length-2;l++){var h=t[l],c=t[l+1];s.push(h);for(var u=0;u<=100;u++){var d=this.plotUtil.getCubicValue(u/100,h,n[2*l],n[2*l+1],c);s.push(d)}s.push(c)}for(var p=[],m=0;m<s.length;m++){var v=this.plotUtil.webMercator2Cartesian3(s[m]);p.push(v)}return p}}]),t}(),Curve=function(){function t(e){_classCallCheck(this,t);this.typeName="Curve",this.plotUtil=new ArrowUtil({}),this.t=.3}return _createClass(t,[{key:"startCompute",value:function(e){for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}var n=[];if(t.length<2)return!1;for(var n=2===t.length?t:this.plotUtil.getCurvePoints(this.t,t),s=[],r=0;r<n.length;r++){var a=this.plotUtil.webMercator2Cartesian3(n[r]);s.push(a)}return s}}]),t}(),CurveFlag=function(){function t(e){_classCallCheck(this,t);this.typeName="CurveFlag",this.plotUtil=new ArrowUtil({})}return _createClass(t,[{key:"startCompute",value:function(e){for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}for(var n,s,r,a,l,h,c,u,d,p,m,v=[],f=(1<t.length&&(p=t[0],m=[((d=t[t.length-1])[0]-p[0])/4+p[0],(d[1]-p[1])/8+p[1]],n=[(p[0]+d[0])/2,p[1]],s=[3*(d[0]-p[0])/4+p[0],-(d[1]-p[1])/8+p[1]],r=[d[0],p[1]],a=[d[0],(p[1]+d[1])/2],l=[3*(d[0]-p[0])/4+p[0],3*(d[1]-p[1])/8+p[1]],h=[(p[0]+d[0])/2,(p[1]+d[1])/2],c=[(d[0]-p[0])/4+p[0],5*(d[1]-p[1])/8+p[1]],u=[p[0],(p[1]+d[1])/2],d=[p[0],d[1]],p=this.plotUtil.getBezierPoints([p,m,n,s,r]),m=this.plotUtil.getBezierPoints([a,l,h,c,u]),(v=p.concat(m)).push(d)),[]),y=0;y<v.length;y++){var g=this.plotUtil.webMercator2Cartesian3(v[y]);f.push(g)}return f}}]),t}(),DoubleArrow=function(){function i(e){_classCallCheck(this,i);var t={};t.headHeightFactor=(e=e||{}).headHeightFactor||.25,t.headWidthFactor=e.headWidthFactor||.3,t.neckHeightFactor=e.neckHeightFactor||.85,t.neckWidthFactor=e.neckWidthFactor||.15,this.positions=null,this.plotUtil=new ArrowUtil(t)}return _createClass(i,[{key:"startCompute",value:function(e){if(e){this.positions=e;for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}for(var n=[t[0],t[1],t[2]],s=n[0],r=n[1],n=n[2],a=this.positions.length,a=3===a?(c=this.getTempPoint4(s,r,n),this.plotUtil.Mid(s,r)):4===a?(c=t[3],this.plotUtil.Mid(s,r)):(c=t[3],t[4]),l=void 0,h=void 0,h=this.plotUtil.isClockWise(s,r,n)?(l=this.getArrowPoints(s,a,c,!1),this.getArrowPoints(a,r,n,!0)):(l=this.getArrowPoints(r,a,n,!1),this.getArrowPoints(a,s,c,!0)),r=l.length,n=(r-5)/2,a=l.slice(0,n),s=l.slice(n,5+n),c=l.slice(5+n,r),l=h.slice(0,n),u=h.slice(n,5+n),h=h.slice(5+n,r),l=this.plotUtil.getBezierPoints(l),n=this.plotUtil.getBezierPoints(h.concat(a.slice(1))),c=this.plotUtil.getBezierPoints(c),d=l.concat(u,n,s,c),p=[],m=0;m<d.length;m++){var v=this.plotUtil.webMercator2Cartesian3(d[m]);p.push(v)}return p}}},{key:"getTempPoint4",value:function(e,t,i){var t=this.plotUtil.Mid(e,t),o=this.plotUtil.MathDistance(t,i),i=this.plotUtil.getAngleOfThreePoints(e,t,i),n=void 0,s=void 0,r=void 0;return i<Math.PI/2?(n=o*Math.sin(i),s=o*Math.cos(i),r=this.plotUtil.getThirdPoint(e,t,Math.PI/2,n,!1),this.plotUtil.getThirdPoint(t,r,Math.PI/2,s,!0)):i>=Math.PI/2&&i<Math.PI?(n=o*Math.sin(Math.PI-i),s=o*Math.cos(Math.PI-i),r=this.plotUtil.getThirdPoint(e,t,Math.PI/2,n,!1),this.plotUtil.getThirdPoint(t,r,Math.PI/2,s,!1)):i>=Math.PI&&i<1.5*Math.PI?(n=o*Math.sin(i-Math.PI),s=o*Math.cos(i-Math.PI),r=this.plotUtil.getThirdPoint(e,t,Math.PI/2,n,!0),this.plotUtil.getThirdPoint(t,r,Math.PI/2,s,!0)):(n=o*Math.sin(2*Math.PI-i),s=o*Math.cos(2*Math.PI-i),r=this.plotUtil.getThirdPoint(e,t,Math.PI/2,n,!0),this.plotUtil.getThirdPoint(t,r,Math.PI/2,s,!1))}},{key:"getArrowPoints",value:function(e,t,i,o){var n=this.plotUtil.Mid(e,t),s=this.plotUtil.MathDistance(n,i),r=this.plotUtil.getThirdPoint(i,n,0,.3*s,!0),a=this.plotUtil.getThirdPoint(i,n,0,.5*s,!0),r=[n,this.plotUtil.getThirdPoint(n,r,Math.PI/2,s/5,o),this.plotUtil.getThirdPoint(n,a,Math.PI/2,s/4,o),i],n=this.plotUtil.getArrowHeadPointsNoLR(r);if(!(n&&Array.isArray(n)&&0<n.length))throw new Error("插值出错");var a=[n[0],n[4]],s=a[0],o=a[1],i=this.plotUtil.MathDistance(e,t)/this.plotUtil.getBaseLength(r)/2,a=this.plotUtil.getArrowBodyPoints(r,s,o,i);if(a)return r=a.length,i=a.slice(0,r/2),a=a.slice(r/2,r),i.push(s),a.push(o),(i=i.reverse()).push(t),(a=a.reverse()).push(e),i.reverse().concat(n,a)}}]),i}(),FineArrow=function(){function i(e){_classCallCheck(this,i);var t={};t.headAngle=this.headAngle=(e=e||{}).headAngle||Math.PI/8.5,t.neckAngle=this.neckAngle=e.neckAngle||Math.PI/13,t.tailWidthFactor=this.tailWidthFactor=e.tailWidthFactor||.1,t.neckWidthFactor=this.neckWidthFactor=e.neckWidthFactor||.2,t.headWidthFactor=this.headWidthFactor=e.headWidthFactor||.25,t.neckHeightFactor=e.neckHeightFactor||.85,this.positions=null,this.plotUtil=new ArrowUtil(t)}return _createClass(i,[{key:"startCompute",value:function(e){if(e){this.positions=e;for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}for(var n=[t[0],t[1]],s=n[0],n=n[1],r=this.plotUtil.getBaseLength(t),a=r*this.tailWidthFactor,l=r*this.neckWidthFactor,r=r*this.headWidthFactor,h=this.plotUtil.getThirdPoint(n,s,Math.PI/2,a,!0),a=this.plotUtil.getThirdPoint(n,s,Math.PI/2,a,!1),c=this.plotUtil.getThirdPoint(s,n,this.headAngle,r,!1),r=this.plotUtil.getThirdPoint(s,n,this.headAngle,r,!0),u=[h,this.plotUtil.getThirdPoint(s,n,this.neckAngle,l,!1),c,n,r,this.plotUtil.getThirdPoint(s,n,this.neckAngle,l,!0),a],d=[],p=0;p<u.length;p++){var m=this.plotUtil.webMercator2Cartesian3(u[p]);d.push(m)}return d}}}]),i}(),GatheringPlace=function(){function t(e){_classCallCheck(this,t),e=e||{},this.positions=null,this.plotUtil=new ArrowUtil(e)}return _createClass(t,[{key:"startCompute",value:function(e){for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}for(var n=this.plotUtil.Mid(t[0],t[2]),s=(t.push(n,t[0],t[1]),[]),r=void 0,a=void 0,l=[],i=0;i<t.length-2;i++)var r=t[i],a=t[i+1],h=t[i+2],h=this.plotUtil.getBisectorNormals(.4,r,a,h),s=s.concat(h);n=s.length;s=[s[n-1]].concat(s.slice(0,n-1));for(var c=0;c<t.length-2;c++){r=t[c],a=t[c+1],l.push(r);for(var u=0;u<=100;u++){var d=this.plotUtil.getCubicValue(u/100,r,s[2*c],s[2*c+1],a);l.push(d)}l.push(a)}for(var p=[],m=0;m<l.length;m++){var v=this.plotUtil.webMercator2Cartesian3(l[m]);p.push(v)}return p}}]),t}(),LineStraightArrow=function(){function t(e){_classCallCheck(this,t);this.typeName="LineStraightArrow",this.plotUtil=new ArrowUtil({}),this.fixPointCount=2,this.maxArrowLength=3e6,this.arrowLengthScale=5}return _createClass(t,[{key:"startCompute",value:function(e){for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}var n=[];try{if(t.length<2)return!1;var s=[t[0],t[1]],r=s[0],a=s[1],l=(l=this.plotUtil.MathDistance(r,a)/this.arrowLengthScale)>this.maxArrowLength?this.maxArrowLength:l,n=[r,a,this.plotUtil.getThirdPoint(r,a,Math.PI/6,l,!1),a,this.plotUtil.getThirdPoint(r,a,Math.PI/6,l,!0)]}catch(e){console.log(e)}for(var h=[],c=0;c<n.length;c++){var u=this.plotUtil.webMercator2Cartesian3(n[c]);h.push(u)}return h}}]),t}(),Lune=function(){function t(e){_classCallCheck(this,t),e=e||{},this.positions=null,this.plotUtil=new ArrowUtil(e)}return _createClass(t,[{key:"startCompute",value:function(e){for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}var n=[t[0],t[1],t[2],void 0,void 0],s=n[0],r=n[1],a=n[2],l=n[3],n=n[4],h=this.plotUtil.getCircleCenterOfThreePoints(s,r,a),c=this.plotUtil.MathDistance(s,h),u=this.plotUtil.getAzimuth(s,h),d=this.plotUtil.getAzimuth(r,h),n=this.plotUtil.isClockWise(s,r,a)?(l=d,u):(l=u,d);(t=this.plotUtil.getArcPoints(h,c,l,n)).push(t[0]);for(var p=[],m=0;m<t.length;m++){var v=this.plotUtil.webMercator2Cartesian3(t[m]);p.push(v)}return p}}]),t}(),RectFlag=function(){function t(e){_classCallCheck(this,t),(e=e||{}).typeName="RectFlag",this.plotUtil=new ArrowUtil(e)}return _createClass(t,[{key:"startCompute",value:function(e){for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}for(var n,s,r=[],a=(1<t.length&&(r=[n=t[0],[(s=t[t.length-1])[0],n[1]],[s[0],(n[1]+s[1])/2],[n[0],(n[1]+s[1])/2],[n[0],s[1]]]),[]),l=0;l<r.length;l++){var h=this.plotUtil.webMercator2Cartesian3(r[l]);a.push(h)}return a}}]),t}(),Sector=function(){function t(e){_classCallCheck(this,t);this.typeName="Sector",this.plotUtil=new ArrowUtil({})}return _createClass(t,[{key:"startCompute",value:function(e){if(e.length<=2)return[];for(var t=[],i=0;i<e.length;i++){var o=this.plotUtil.cartesian32WeMercator(e[i]);t.push(o)}for(var n=[t[0],t[1],t[2]],s=n[0],r=n[1],n=n[2],a=this.plotUtil.MathDistance(r,s),r=this.plotUtil.getAzimuth(r,s),n=this.plotUtil.getAzimuth(n,s),l=this.plotUtil.getArcPoints(s,a,r,n),h=(l.push(s,l[0]),[]),c=0;c<l.length;c++){var u=this.plotUtil.webMercator2Cartesian3(l[c]);h.push(u)}return h}}]),t}(),arrowAlgorithm={AttackArrow:AttackArrow,AttackArrowPW:AttackArrowPW,AttackArrowYW:AttackArrowYW,CloseCurve:CloseCurve,Curve:Curve,CurveFlag:CurveFlag,DoubleArrow:DoubleArrow,FineArrow:FineArrow,GatheringPlace:GatheringPlace,LineStraightArrow:LineStraightArrow,Lune:Lune,RectFlag:RectFlag,Sector:Sector},CreateArrow=function(){_inherits(s,BasePlot);var n=_createSuper(s);function s(e,t,i){var o;if(_classCallCheck(this,s),(o=n.call(this,e,i)).type="arrow",!t)return console.log("缺少箭头类型"),_possibleConstructorReturn(o);if(o.situationType=t,o.arrowObj=getSituationByType(t),!o.arrowObj)return _possibleConstructorReturn(o);if(o.minPointNum=o.arrowObj.minPointNum,1==o.minPointNum)return console.warn("控制点有误！"),_possibleConstructorReturn(o);if(o.maxPointNum=-1==o.arrowObj.maxPointNum?o.minPointNum:o.arrowObj.maxPointNum,o.arrowPlot=o.arrowObj.arrowPlot,!o.arrowPlot)return console.warn("计算坐标类有误！"),_possibleConstructorReturn(o);o.type="arrow",o.viewer=e,o.entity=null,o.polyline=null;return o.style=Object.assign({outlineColor:"#000000",outlineWidth:2},i||{}),o.outline=null,o}return _createClass(s,[{key:"start",value:function(t){var i=this;!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle)),this.state="startCreate",this.handler.setInputAction(function(e){var e=i.getCatesian3FromPX(e.position,i.viewer);!e||i.positions.length>i.maxPointNum||(i.movePush&&(i.positions.pop(),i.movePush=!1),i.positions.push(e),(e=i.createPoint(e)).wz=i.controlPoints.length,i.controlPoints.push(e))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){i.positions.length<1?(i.prompt.update(e.endPosition,"单击开始绘制"),i.state="startCreate"):(i.positions.length>=i.maxPointNum?i.prompt.update(e.endPosition,"双击结束"):i.prompt.update(e.endPosition,"单击新增，不少于"+i.minPointNum+"个点</br>双击结束"),i.state="creating",(e=i.getCatesian3FromPX(e.endPosition,i.viewer))&&(i.movePush?i.positions[i.positions.length-1]=e:(i.positions.push(e),i.movePush=!0),2<=i.positions.length&&!Cesium.defined(i.polyline)&&(i.polyline=i.createPolyline()),i.positions.length>=i.minPointNum&&(Cesium.defined(i.entity)||(i.entity=i.createPolygon(),i.entity.objId=i.objId,i.polyline.show=!1))))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){i.entity&&i.getCatesian3FromPX(e.position,i.viewer,[i.entity])&&i.positions.length>=i.minPointNum&&(i.movePush||(i.positions.pop(),i.movePush=!1,i.viewer.entities.remove(i.controlPoints[i.controlPoints.length-1]),i.controlPoints.pop()),i.prompt&&(i.prompt.destroy(),i.prompt=null),i.state="endCreate",i.handler.destroy(),t&&t(i.entity))},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}},{key:"createByPositions",value:function(e,t){if(e){this.state="startCreate";var i=e[0]instanceof Cesium.Cartesian3?e:cUtil.lnglatsToCartesians(e);if(i){this.entity=this.createPolygon(),this.positions=i;for(var o=0;o<i.length;o++){var n=i[o],s=(this.style.heightReference&&((s=Cesium.Cartographic.fromCartesian(i[o])).height=this.viewer.scene.sampleHeight(s),n=Cesium.Cartographic.toCartesian(s)),this.createPoint(n));s.ctgc=ctgc,s.wz=this.controlPoints.length,this.controlPoints.push(s)}this.state="endCreate",this.entity.objId=this.objId,t&&t(this.entity)}}}},{key:"getStyle",value:function(){var e,t,i;if(this.entity)return e={},i=(t=this.entity.polygon).material.color.getValue(),e.colorAlpha=i.alpha,e.color=new Cesium.Color(i.red,i.green,i.blue,1).toCssHexString(),e.fill=!!t.fill&&t.fill.getValue(),t.heightReference&&(i=t.heightReference.getValue(),e.heightReference=Boolean(i)),e}},{key:"setStyle",value:function(e){var t;e&&(null!=e.heightReference&&(this.entity.polygon.heightReference=Number(e.heightReference)),t=(e.color instanceof Cesium.Color?e.color:Cesium.Color.fromCssColorString(e.color)).withAlpha(e.colorAlpha||1),this.entity.polygon.material=t,null!=e.fill&&(this.entity.polygon.fill=e.fill),this.style=Object.assign(this.style,e))}},{key:"createPolygon",value:function(){var t=this,e=(this.style.color=this.style.color||Cesium.Color.WHITE,this.style.outlineColor=this.style.outlineColor||Cesium.Color.BLACK,{polygon:{hierarchy:new Cesium.CallbackProperty(function(){var e=t.arrowPlot.startCompute(t.positions);return null!=t.arrowPlot.spliceWZ&&e.splice(t.arrowPlot.spliceWZ-1,1),new Cesium.PolygonHierarchy(e)},!1),heightReference:Number(this.style.heightReference),show:!0,fill:this.style.fill||!0,material:this.style.color instanceof Cesium.Color?this.style.color:Cesium.Color.fromCssColorString(this.style.color).withAlpha(this.style.colorAlpha||1)}});return this.style.heightReference||(e.polygon.height=0,e.polygon.perPositionHeight=!0),this.viewer.entities.add(e)}},{key:"createPolyline",value:function(){var e=this;return this.viewer.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return e.positions},!1),clampToGround:Boolean(this.style.clampToGround),material:this.style.outlineColor instanceof Cesium.Color?this.style.outlineColor:Cesium.Color.fromCssColorString(this.style.outlineColor).withAlpha(this.style.outlineColorAlpha||1),width:this.style.outlineWidth||1}})}},{key:"destroy",value:function(){this.handler&&(this.handler.destroy(),this.handler=null),this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null),this.entity&&(this.viewer.entities.remove(this.entity),this.entity=null),this.polyline&&(this.viewer.entities.remove(this.polyline),this.polyline=null),this.positions=[],this.style=null,this.modifyPoint&&(this.viewer.entities.remove(this.modifyPoint),this.modifyPoint=null);for(var e=0;e<this.controlPoints.length;e++){var t=this.controlPoints[e];this.viewer.entities.remove(t)}this.controlPoints=[],this.state="no",this.prompt&&this.prompt.destroy(),this.polyline&&(this.polyline=null,this.viewer.entities.remove(this.polyline)),this.forbidDrawWorld(!1)}}]),s}();function getSituationByType(e){if((e=Number(e),!isNaN(e))&&(e&&"number"==typeof e)){var t,i=-1,o=-1,n={canPlay:!1,pointNum:0,pointWZ:[]};switch(n.canPlay=!1,e){case 1:t=new arrowAlgorithm.AttackArrow,i=3,o=999,n.canPlay=!0,n.pointNum=1,n.pointWZ=[o];break;case 2:t=new arrowAlgorithm.AttackArrowPW,i=3,o=999,n.canPlay=!0,n.pointNum=1,n.pointWZ=[o];break;case 3:t=new arrowAlgorithm.AttackArrowYW,i=3,o=999,n.canPlay=!0,n.pointNum=1,n.pointWZ=[o];break;case 4:t=new arrowAlgorithm.CloseCurve,i=3,o=999,n.canPlay=!0,n.pointNum=1,n.pointWZ=[o];break;case 5:t=new arrowAlgorithm.DoubleArrow,i=3,o=5,n.canPlay=!0,n.pointNum=2,n.pointWZ=[2,3];break;case 6:t=new arrowAlgorithm.FineArrow,o=i=2,n.canPlay=!0,n.pointNum=1,n.pointWZ=[o];break;case 7:t=new arrowAlgorithm.FineArrowYW,o=i=2,n.canPlay=!0,n.pointNum=1,n.pointWZ=[o];break;case 8:t=new arrowAlgorithm.GatheringPlace,o=i=3,n.canPlay=!0,n.pointNum=1,n.pointWZ=[o];break;case 9:t=new arrowAlgorithm.Lune,i=3,n.canPlay=!0,o=3,n.canPlay=!0,n.pointNum=1,n.pointWZ=[o];break;case 10:t=new arrowAlgorithm.StraightArrow,o=i=2,n.canPlay=!0,n.pointNum=1,n.pointWZ=[o];break;case 11:o=i=2,(t=new arrowAlgorithm.RectFlag).hasLine=!0,t.lineWZ=[1,4,5],t.spliceWZ=[5],n.canPlay=!1;break;case 12:t=new arrowAlgorithm.Sector,n.canPlay=!(o=i=3);break;case 13:o=i=2,(t=new arrowAlgorithm.TrangleFlag).hasLine=!0,t.lineWZ=[1,3,4],t.spliceWZ=[4],n.canPlay=!1;break;case 14:o=i=2,(t=new arrowAlgorithm.CurveFlag).hasLine=!0,t.lineWZ=[1,202,203],t.spliceWZ=[203],n.canPlay=!1;break;case 15:i=2,o=999,(t=new arrowAlgorithm.Curve).onlyLine=!0,n.canPlay=!0;break;case 16:o=i=2,(t=new arrowAlgorithm.LineStraightArrow).onlyLine=!0,n.canPlay=!0;break;default:console.warn("不存在该类型！")}return{arrowPlot:t,minPointNum:i,maxPointNum:o,playObj:n}}console.warn("输入态势标绘类型不对！")}var DrawTool=function(){function i(e,t){_classCallCheck(this,i),e?(t=t||{},this.viewer=e,this.toolArr=[],this.handler=null,this.removeHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.nowEditObj=null,this.startEditFun=null,this.endEditFun=null,this.removeFun=null,this.deleteEntityObj=null,this.bindEdit(),this.bindRemove(),this.deletePrompt=null,this.canEdit=null==t.canEdit||t.canEdit,this.intoEdit=null,this.lastEntityObj=null,this.lastStartEntityObj=null):console.warn("缺少必要参数！--viewer")}return _createClass(i,[{key:"on",value:function(e,t){"startEdit"==e?this.startEditFun=t:"endEdit"==e?this.endEditFun=t:"remove"==e?this.removeFun=t:"endCreate"==e&&(this.endCreateFun=t)}},{key:"canEdit",value:function(e){this.canEdit=e}},{key:"start",value:function(t){if(t&&t.type){t.id=t.id||Number((new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0));var i=this,o=(this.intoEdit=null==t.intoEdit||t.intoEdit,this.endEdit(),this.lastStartEntityObj&&"startCreate"==this.lastStartEntityObj.state&&(this.lastStartEntityObj.destroy(),this.lastStartEntityObj=null),this.createByType(t));if(o)return o.attr=t||{},o.start(function(e){i.toolArr.push(o),t.success&&t.success(o,e),i.endCreateFun&&i.endCreateFun(o,e),0==t.show&&o.setVisible(!1),i.canEdit&&i.intoEdit&&(o.startEdit(),i.startEditFun&&i.startEditFun(o,e),i.lastEntityObj=o)}),this.lastStartEntityObj=o}}},{key:"end",value:function(){this.lastStartEntityObj&&"startCreate"==this.lastStartEntityObj.state&&(this.lastStartEntityObj.destroy(),this.lastStartEntityObj=null),this.endEdit()}},{key:"cancel",value:function(){!this.lastStartEntityObj||"endCreate"==this.lastStartEntityObj.state&&"endEdit"==this.lastStartEntityObj.state||(this.lastStartEntityObj.destroy(),this.lastStartEntityObj=null)}},{key:"startEditOne",value:function(e){this.canEdit&&(this.lastEntityObj&&(this.lastEntityObj.endEdit(),this.endEditFun&&this.endEditFun(this.lastEntityObj,this.lastEntityObj.getEntity()),this.lastEntityObj=null),e&&(e.startEdit(),this.startEditFun&&this.startEditFun(e,e.getEntity()),this.lastEntityObj=e))}},{key:"updateOneStyle",value:function(e,t){e&&e.setStyle(t)}},{key:"createByPositions",value:function(t){if((t=(t=t||{})||{}).positions){t.id=t.id||Number((new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0));var i=this,o=this.createByType(t);if(o)return o.attr=t,this.intoEdit=null==t.intoEdit||t.intoEdit,o.createByPositions(t.positions,function(e){i.toolArr.push(o),o.setStyle(t.style),t.success&&t.success(o,e),i.endCreateFun&&i.endCreateFun(o,e),0==t.show&&o.setVisible(!1)}),o}}},{key:"createByGeojson",value:function(e){for(var t=e.features,i=0;i<t.length;i++){var o=t[i],n=o.properties,o=o.geometry,s=n.plotType,r=o.type,a=o.coordinates,l=[],h="";switch(r){case"LineString":l=cUtil$1.lnglatsToCartesians(a),h="polyline";break;case"Polygon":l=cUtil$1.lnglatsToCartesians(a[0]),h="polygon";break;case"Point":l=cUtil$1.lnglatsToCartesians([a])[0],h=s}this.createByPositions({type:h,positions:l,style:n.style})}}},{key:"toGeojson",value:function(){var e={type:"FeatureCollection",features:[]};if(0==this.toolArr.length)return null;for(var t=0;t<this.toolArr.length;t++){var i=this.toolArr[t],o=i.getPositions(!0),n=i.getStyle(),s=this.transType(i.type),r={type:"Feature",properties:{plotType:i.type,style:n},geometry:{type:s,coordinates:[]}};switch(s){case"Polygon":r.geometry.coordinates=[o];break;case"Point":case"LineString":r.geometry.coordinates=o}r.properties=Object.assign(r.properties,i.properties),e.features.push(r)}return e}},{key:"transType",value:function(e){var t="";switch(e){case"polyline":t="LineString";break;case"polygon":t="Polygon";break;case"point":case"gltfModel":case"label":case"Billboard":t="Point";break;default:t=e}return t}},{key:"destroy",value:function(){for(var e=0;e<this.toolArr.length;e++)this.toolArr[e].destroy();this.toolArr=[],this.nowEditObj=null,this.handler&&(this.handler.destroy(),this.handler=null),this.removeHandler&&(this.removeHandler.destroy(),this.removeHandler=null)}},{key:"removeOne",value:function(e){e&&this.removeById(e.objId)}},{key:"removeAll",value:function(){for(var e=0;e<this.toolArr.length;e++)this.toolArr[e].destroy();this.toolArr=[],this.nowEditObj=null}},{key:"hasEntityObj",value:function(e){return!!e&&this.getEntityObjByObjId(e.objId)!={}}},{key:"removeById",value:function(e){e=this.getEntityObjByObjId(e);this.toolArr.splice(e.index,1),this.removeFun&&this.removeFun(e.entityObj,e.entityObj.getEntity()),e.entityObj&&e.entityObj.destroy()}},{key:"zoomToById",value:function(e){e=this.getEntityObjByObjId(e);e.entityObj&&e.entityObj.zoomTo()}},{key:"getEntityObjByAttr",value:function(e,t){var i={};if(t)for(var o=0;o<this.toolArr.length;o++){var n=this.toolArr[o];if(n.attr[e]==t){i.entityObj=n,i.index=o;break}}else for(var s=0;s<this.toolArr.length;s++){var r=this.toolArr[s];if(r.attr.id==e){i.entityObj=r,i.index=s;break}}return i}},{key:"setVisible",value:function(e,t){e=this.getEntityObjByAttr("id",e);e.entityObj&&e.entityObj.setVisible(t)}},{key:"getEntityObjByObjId",value:function(e){if(e){for(var t={},i=0;i<this.toolArr.length;i++){var o=this.toolArr[i];if(o.objId==e){t.entityObj=o,t.index=i;break}}return t}}},{key:"bindEdit",value:function(){var o=this;this.handler||(this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.handler.setInputAction(function(e){if(o.canEdit){var t=o.viewer.scene.pick(e.position);if(Cesium.defined(t)&&t.id){for(var i=0;i<o.toolArr.length;i++)if(t.id.objId==o.toolArr[i].objId&&("startCreate"!=o.toolArr[i].state||"creating"!=o.toolArr[i].state||"endEdit"!=o.toolArr[i].state)){o.lastEntityObj&&(o.lastEntityObj.endEdit(),o.endEditFun&&o.endEditFun(o.lastEntityObj,o.lastEntityObj.getEntity()),o.lastEntityObj=null),o.toolArr[i].startEdit(),o.nowEditObj=o.toolArr[i],o.startEditFun&&o.startEditFun(o.nowEditObj,t.id),o.lastEntityObj=o.toolArr[i];break}}else o.lastEntityObj&&(o.lastEntityObj.endEdit(),o.endEditFun&&o.endEditFun(o.lastEntityObj,o.lastEntityObj.getEntity()),o.lastEntityObj=null)}},Cesium.ScreenSpaceEventType.LEFT_CLICK)}},{key:"closeEdit",value:function(){this.endEdit(),this.canEdit=!1}},{key:"openEdit",value:function(){this.canEdit=!0}},{key:"endEdit",value:function(){this.lastEntityObj&&(this.lastEntityObj.endEdit(),this.endEditFun&&this.endEditFun(this.lastEntityObj,this.lastEntityObj.getEntity()),this.lastEntityObj=null);for(var e=0;e<this.toolArr.length;e++)this.toolArr[e].endEdit()}},{key:"bindRemove",value:function(){var s=this;this.removeHandler.setInputAction(function(e){if(s.canEdit){s.deletePrompt&&(s.deletePrompt.destroy(),s.deletePrompt=null);var t,i,o=s.viewer.scene.pick(e.position);if(Cesium.defined(o)&&o.id)for(var n=0;n<s.toolArr.length;n++)if(o.id.objId==s.toolArr[n].objId&&("endCreate"==s.toolArr[n].state||"startEdit"==s.toolArr[n].state||"endEdit"==s.toolArr[n].state)){s.deleteEntityObj={entityObj:s.toolArr[n],index:n},t=e.position,i=void 0,s.deletePrompt&&(s.deletePrompt.destroy(),s.deletePrompt=null),s.deletePrompt=new Prompt$1(viewer,{content:"<span id='deleteEntity' style='cursor: pointer;'>删除</span>",show:!0,offset:{x:60,y:60}}),i=document.getElementById("deleteEntity"),s.deletePrompt.update(t),i.addEventListener("click",function(){var e;s.endEdit(),s.deletePrompt.destroy(),s.deleteEntityObj&&s.deleteEntityObj!={}&&(e=s.deleteEntityObj.entityObj,s.removeFun&&s.removeFun(e,e.getEntity()),e.destroy(),s.toolArr.splice(s.deleteEntityObj.index,1))});break}}},Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.removeHandler.setInputAction(function(e){s.deletePrompt&&(s.deletePrompt.destroy(),s.deletePrompt=null)},Cesium.ScreenSpaceEventType.LEFT_CLICK)}},{key:"getAll",value:function(){return this.toolArr}},{key:"createByType",value:function(e){var t=void 0,i="";if("polyline"==e.type&&(t=new CreatePolyline(this.viewer,e.style),i="折线_"),"polygon"==e.type&&(t=new CreatePolygon(this.viewer,e.style),i="面_"),"billboard"==e.type&&(t=new CreateBillboard(this.viewer,e.style),i="图标_"),"circle"==e.type&&(t=new CreateCircle(this.viewer,e.style),i="圆_"),"rectangle"==e.type&&(t=new CreateRectangle(this.viewer,e.style),i="矩形_"),"gltfModel"==e.type&&(t=new CreateGltfModel(this.viewer,e.style),i="模型_"),"point"==e.type&&(t=new CreatePoint(this.viewer,e.style),i="点_"),"label"==e.type&&(t=new CreateLabel(this.viewer,e.style),i="文字_"),"arrow"==e.type){if(!e.arrowType)return void console.log("缺少军事标绘类型");t=new CreateArrow(this.viewer,e.arrowType,e.style)}return t&&(t.name=i+(new Date).getTime()),t}}]),i}(),BaseLayer=function(){function i(e,t){_classCallCheck(this,i),this.viewer=e,this.opt=t||{},this.id=t.id||Number((new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0)),t.url||"tdt"==t.type||"grid"==t.type?(this.providerAttr={},this.opt.rectangle&&(this.opt.rectangle=new Cesium.Rectangle(Cesium.Math.toRadians(this.opt.rectangle[0]),Cesium.Math.toRadians(this.opt.rectangle[1]),Cesium.Math.toRadians(this.opt.rectangle[2]),Cesium.Math.toRadians(this.opt.rectangle[3])),this.providerAttr.rectangle=this.opt.rectangle),this.opt.minimumLevel&&(this.providerAttr.minimumLevel=this.opt.minimumLevel),this.opt.maximumLevel&&(this.providerAttr.maximumLevel=this.opt.maximumLevel),this.providerAttr.url=t.url,"EPSG:3857"==this.opt.srs?this.opt.tilingScheme=new Cesium.WebMercatorTilingScheme:"EPSG:4490"!=this.opt.srs&&"EPSG:4326"==this.opt.srs&&(this.opt.tilingScheme=new Cesium.GeographicTilingScheme),this.providerAttr=Object.assign(this.opt,this.providerAttr),this._layer=null,this._provider={}):console.log("缺少服务地址！",t)}return _createClass(i,[{key:"layer",get:function(){return this._layer}},{key:"load",value:function(){var e;this._provider&&this._provider!={}&&(e={rectangle:this.opt.rectangle,alpha:this.opt.alpha||1,show:null==this.opt.show||this.opt.show},this.opt.minimumTerrainLevel&&(e.minimumTerrainLevel=this.opt.minimumTerrainLevel),this.opt.maximumTerrainLevel&&(e.maximumTerrainLevel=this.opt.maximumTerrainLevel),this._layer=new Cesium.ImageryLayer(this._provider,e),this.viewer.imageryLayers.add(this._layer,this.opt.zIndex),this._layer.attr=this.opt)}},{key:"getLayer",value:function(){return this._layer}},{key:"remove",value:function(){this._layer&&this.viewer.imageryLayers.remove(this._layer)}},{key:"show",value:function(){this._layer&&(this._layer.show=!0,this._layer.attr.show=!0)}},{key:"hide",value:function(){this._layer&&(this._layer.show=!1,this._layer.attr.show=!1)}},{key:"setVisible",value:function(e){(e=null==e||e)?this.show():this.hide()}},{key:"zoomTo",value:function(){this.opt.view?cUtil$1.setCameraView(this.opt.view):this.viewer.zoomTo(this._layer)}},{key:"setAlpha",value:function(e){this._layer&&(this._layer.alpha=e=null==e?1:e)}},{key:"lowerLayer",value:function(){this._layer&&this.viewer.imageryLayers.lower(this._layer)}},{key:"lowerLayerToBottom",value:function(){this._layer&&this.viewer.imageryLayers.lowerToBottom(this._layer)}},{key:"raiseLayer",value:function(){this._layer&&this.viewer.imageryLayers.raise(this._layer)}},{key:"raiselayerToTop",value:function(){this._layer&&this.viewer.imageryLayers.raiseToTop(this._layer)}}]),i}(),ArcgiscacheLayer=function(){_inherits(o,BaseLayer);var i=_createSuper(o);function o(e,t){_classCallCheck(this,o),(e=i.call(this,e,t)).type="arcgiscache",Cesium.UrlTemplateImageryProvider.prototype.padLeft0||(Cesium.UrlTemplateImageryProvider.prototype.padLeft0=function(e,t){for(var i=(e=String(e)).length;i<t;)e="0"+e,i++;return e});t=Object.assign(e.providerAttr,{customTags:{arc_x:function(e,t,i,o){return e.padLeft0(t.toString(16),8)},arc_y:function(e,t,i,o){return e.padLeft0(i.toString(16),8)},arc_z:function(e,t,i,o){return e.padLeft0(o.toString(),2)},arc_z4490:function(e,t,i,o){return e.padLeft0((o+1).toString(),2)},arc_X:function(e,t,i,o){return e.padLeft0(t.toString(16),8).toUpperCase()},arc_Y:function(e,t,i,o){return e.padLeft0(i.toString(16),8).toUpperCase()},arc_Z:function(e,t,i,o){return e.padLeft0(o.toString(),2).toUpperCase()},arc_Z4490:function(e,t,i,o){return e.padLeft0((o+1).toString(),2).toUpperCase()}}});return e._provider=new Cesium.UrlTemplateImageryProvider(t),e}return _createClass(o)}(),MapserverLayer=function(){_inherits(o,BaseLayer);var i=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(e=i.call(this,e,t)).type="mapserver",e._provider=new Cesium.ArcGisMapServerImageryProvider(e.providerAttr),e}return _createClass(o)}(),GridLayer=function(){_inherits(o,BaseLayer);var i=_createSuper(o);function o(e,t){_classCallCheck(this,o),(e=i.call(this,e,t)).type="grid";t=Cesium.Color.fromCssColorString(t.color||"#C0C0C0");return e.viewer.scene.globe.baseColor=Cesium.Color.GREY,e.providerAttr.cells=e.providerAttr.cells||4,e.providerAttr.color=t,e._provider=new Cesium.GridImageryProvider(e.providerAttr),e}return _createClass(o)}(),GeojsonLayer=function(_BaseLayer){_inherits(GeojsonLayer,_BaseLayer);var _super=_createSuper(GeojsonLayer);function GeojsonLayer(e,t){var i;_classCallCheck(this,GeojsonLayer),(i=_super.call(this,e,t)).type="geojson",i.viewer=e,i.opt=t||{};return i.style=Object.assign({point:{color:"#00FFFF",colorAlpha:1,outlineWidth:1,outlineColor:"#000000",outlineColorAlpha:1,pixelSize:20},polyline:{color:"#FFFF00",colorAlpha:1,width:3,clampToGround:1},polygon:{heightReference:1,fill:!0,color:"#00FFFF",colorAlpha:1,outline:!0,outlineWidth:1,outlineColor:"#FFFF00",outlineColorAlpha:1}},t.style||{}),i.url=i.opt.url||"",-1!=i.url.indexOf("WFS")&&(i.url=i.opt.url+"?service=WFS&version=1.0.0&request=GetFeature&typeName=".concat(i.opt.typeName,"&maxFeatures=50&outputFormat=application%2Fjson")),i._layer=new Cesium.CustomDataSource(i.opt.typeName||"geojson"+(new Date).getTime()),i._layer.attr=i.opt,i.viewer.dataSources.add(i._layer),i}return _createClass(GeojsonLayer,[{key:"load",value:function(f){var y=this;Cesium.Resource.fetchJson({url:this.url}).then(function(e){for(var t=e.features,i=0;i<t.length;i++){var o=t[i],n=o.geometry,s=o.properties;if(n){var o=n.type,r=n.coordinates,a=[];switch(o){case"Point":var l=cUtil$1.lnglatToCartesian(r),l=y.createPoint(l,y.style.point,s);l.properties=s,y.opt.popup&&(l.popup=y.getContent(s,y.opt.popup)),y.opt.tooltip&&(l.tooltip=y.getContent(s,y.opt.tooltip));break;case"MultiPoint":for(var h=0;h<r.length;h++){var c=cUtil$1.lnglatToCartesian(r[h]),c=y.createPoint(c,y.style.point,s);c.properties=s,y.opt.popup&&(c.popup=y.getContent(s,y.opt.popup)),y.opt.tooltip&&(c.tooltip=y.getContent(s,y.opt.tooltip))}break;case"LineString":a=cUtil$1.lnglatsToCartesians(r),l=y.createPolyline(a,y.style.polyline,s);l.properties=s,y.opt.popup&&(l.popup=y.getContent(s,y.opt.popup)),y.opt.tooltip&&(l.tooltip=y.getContent(s,y.opt.tooltip));break;case"MultiLineString":for(var u=0;u<r.length;u++){var d=cUtil$1.lnglatsToCartesians(r[u]),d=y.createPolyline(d,y.style.polyline,s);d.show=null==y.opt.show||y.opt.show,d.properties=s,y.opt.popup&&(d.popup=y.getContent(s,y.opt.popup)),y.opt.tooltip&&(d.tooltip=y.getContent(s,y.opt.tooltip))}break;case"Polygon":a=cUtil$1.lnglatsToCartesians(r[0]);var p=y.createPolygon(a,y.style.polygon,s);p.show=null==y.opt.show||y.opt.show,p.properties=s,y.opt.popup&&(p.popup=y.getContent(s,y.opt.popup)),y.opt.tooltip&&(p.tooltip=y.getContent(s,y.opt.tooltip));break;case"MultiPolygon":for(var m=0;m<r.length;m++){var v=cUtil$1.lnglatsToCartesians(r[m][0]),v=y.createPolygon(v,y.style.polygon,s);v.show=null==y.opt.show||y.opt.show,v.properties=s,y.opt.popup&&(v.popup=y.getContent(s,y.opt.popup)),y.opt.tooltip&&(v.tooltip=y.getContent(s,y.opt.tooltip))}}}}f&&f()})}},{key:"zoomTo",value:function(){this._layer&&(this._layer.attr.view?cUtil$1.setCameraView(opt.view):this.viewer.zoomTo(this._layer.entities))}},{key:"remove",value:function(){this._layer&&this.viewer.dataSources.remove(this._layer)}},{key:"show",value:function(){this._layer&&(this._layer.show=!0,this._layer.attr.show=!0)}},{key:"hide",value:function(){this._layer&&(this._layer.attr.show=!1,this._layer.show=!1)}},{key:"getContent",value:function(e,t){for(var i="",o=0;o<t.length;o++){var n=t[o],s=n.field,n=n.fieldName,s=e[s];i+="\n                <tr>\n                    <td>".concat(n,"：</td>\n                    <td>").concat(s,"</td>\n                </tr>\n            ")}return"\n            <table>".concat(i,"</table>\n        ")}},{key:"getStyleValue",value:function getStyleValue(key,value,conditions){for(var styleValue=null,ind=0;ind<conditions.length;ind++)if("true"==conditions[ind][0]){styleValue=conditions[ind][1];break}for(var i=0;i<conditions.length;i++){var condition=conditions[i],replaceStr="${"+key+"}",str=condition[0].replace(replaceStr,'"'+value+'"');if(console.log("eval===>",str,eval(str)),eval(str)){styleValue=condition[1];break}}return styleValue}},{key:"setAlpha",value:function(n){this._layer.entities.values.forEach(function(e){var t=e.style,i=null,o=(i=(i=Cesium.Color.fromCssColorString(t.color)).withAlpha(n||1),null);o=(o=Cesium.Color.fromCssColorString(t.outlineColor)).withAlpha(n||1),e.point&&(e.point.color=i,e.point.outlineColor=o),e.polygon&&(e.polygon.material=i),e.polyline&&(e.polyline.material=o)})}},{key:"createPoint",value:function(e,t,i){var o=null,i=((t=this.getNewStyle(t,i)).color=t.color||"#ffff00",t.colorAlpha=t.colorAlpha||1,o=(o=Cesium.Color.fromCssColorString(t.color)).withAlpha(t.colorAlpha),null),e=(t.outlineColor=t.outlineColor||"#000000",t.outlineColorAlpha=t.outlineColorAlpha||1,i=(i=Cesium.Color.fromCssColorString(t.outlineColor)).withAlpha(t.outlineColorAlpha),this._layer.entities.add({position:e,point:{color:o,outlineColor:i,outlineWidth:t.outlineWidth||1,pixelSize:t.pixelSize||6,heightReference:1}}));return e.style=t,e}},{key:"createPolygon",value:function(e,t,i){var o=null,i=((t=this.getNewStyle(t,i)).color=t.color||"#ffff00",t.colorAlpha=t.colorAlpha||1,o=(o=Cesium.Color.fromCssColorString(t.color)).withAlpha(t.colorAlpha),null),n=(t.outlineColor=t.outlineColor||"#000000",t.outlineColorAlpha=t.outlineColorAlpha||1,i=(i=Cesium.Color.fromCssColorString(t.outlineColor)).withAlpha(t.outlineColorAlpha),{}),o=(n.polygon={hierarchy:new Cesium.PolygonHierarchy(e),heightReference:1,material:o},t.outline&&(n.polyline={positions:new Cesium.CallbackProperty(function(){return e},!1),material:i,width:t.outlineWidth||1,clampToGround:!0}),this._layer.entities.add(n));return o.style=t,o}},{key:"createPolyline",value:function(e,t,i){var o=null,i=((t=this.getNewStyle(t,i)).color=t.color||"#ffff00",t.colorAlpha=t.colorAlpha||1,o=(o=Cesium.Color.fromCssColorString(t.color)).withAlpha(t.colorAlpha),this._layer.entities.add({polyline:{positions:e,material:o,width:t.width||3,clampToGround:!0}}));return i.style=t,i}},{key:"getRandomColor",value:function(){for(var e="#",t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],i=0;i<6;i++)e+=t[parseInt(16*Math.random())];return e}},{key:"getNewStyle",value:function(e,t){e=JSON.parse(JSON.stringify(e||{}));var i,o,n,s={};if(t){for(var r in e)e[r].conditions&&e[r].conditions instanceof Array?(i=e[r].field,o=e[r].conditions,n=t[i],s[r]=this.getStyleValue(i+"",n,o)):e[r]instanceof String?s[r]=e[r]:"random"==e[r].conditions&&("color"==e[r].type&&(s[r]=this.getRandomColor()),"number"==e[r].type&&(s[r]=100*Math.random()));e=Object.assign(e,s)}return e}}]),GeojsonLayer}(BaseLayer),TDTLayer=function(){_inherits(a,BaseLayer);var r=_createSuper(a);function a(e,t){_classCallCheck(this,a);var i=["313cd4b28ed520472e8b43de00b2de56","83b36ded6b43b9bc81fbf617c40b83b5","0ebd57f93a114d146a954da4ecae1e67","6c99c7793f41fccc4bd595b03711913e","56b81006f361f6406d0e940d2f89a39c"],e=r.call(this,e,t);if(e.type="tdt",e.opt=t||{},e.opt.keys&&0!=e.opt.keys.length?Array.isArray(e.opt.keys)?(t=Math.random()*e.opt.key.length,t=Math.floor(t),e.key=i[t]):e.key=e.opt.keys:(t=Math.random()*i.length,t=Math.floor(t),e.key=i[t]),!e.opt.layerName)return console.log("缺少图层名称"),_possibleConstructorReturn(e);for(var i="",t="",o="https://t{s}.tianditu.gov.cn/"+(t=4326==e.opt.crs?(i="c",e.opt.layerName+"_c"):(i="w",e.opt.layerName+"_w"))+"/wmts?service=WMTS&version=1.0.0&request=GetTile&tilematrix={TileMatrix}&layer="+e.opt.layerName+"&style={style}&tilerow={TileRow}&tilecol={TileCol}&tilematrixset={TileMatrixSet}&format=tiles&tk="+e.key,n=[],s=0;s<=18;s++)n[s]=s.toString();o={url:o,layer:t,style:"default",format:"tiles",tileMatrixSetID:i,subdomains:["0","1","2","3","4","5","6","7"],tileMatrixLabels:n,tilingScheme:new Cesium.WebMercatorTilingScheme},o=Object.assign(e.providerAttr||{},o);return e._provider=new Cesium.WebMapTileServiceImageryProvider(o),e}return _createClass(a)}(),SingleImageLayer=function(){_inherits(o,BaseLayer);var i=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(e=i.call(this,e,t)).type="singleImage",e._provider=new Cesium.SingleTileImageryProvider(e.opt),e}return _createClass(o)}(),TMSLayer=function(){_inherits(o,BaseLayer);var i=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(e=i.call(this,e,t)).type="tmsLayer",e._provider=new Cesium.TileMapServiceImageryProvider(e.opt),e}return _createClass(o)}(),XYZLayer=function(){_inherits(o,BaseLayer);var i=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(e=i.call(this,e,t)).type="XYZLayer",e._provider=new Cesium.UrlTemplateImageryProvider(e.providerAttr),e}return _createClass(o,[{key:"layer",get:function(){return this._layer}},{key:"provider",get:function(){return this._provider}}]),o}(),TilesetLayer=function(){_inherits(o,BaseLayer);var i=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(e=i.call(this,e,t)).opt=t||{},e.type="3dtiles",e.opt.url||console.log("缺少服务地址！",t),e._layer=void 0,e}return _createClass(o,[{key:"layer",get:function(){return this._layer}},{key:"load",value:function(t){var i=this;this.viewer.scene.primitives.add(new Cesium.Cesium3DTileset({maximumScreenSpaceError:this.opt.maximumScreenSpaceError||1,url:this.opt.url,preferLeaves:!0})).readyPromise.then(function(e){i._layer=e,i._layer.layerConfig=i.opt,i._layer.initBoundingSphere=e.boundingSphere.clone(),i._layer.show=null==i.opt.show||i.opt.show,i.opt.center&&i.setCenter(i.opt.center),i.opt.position&&i.setPosition(i.opt.position),i.opt.flyTo&&i.zoomTo(),i.opt.style&&i.updateStyle(e,i.opt.style),t&&t(e)}).otherwise(function(e){})}},{key:"remove",value:function(){this._layer&&this.viewer.scene.primitives.remove(this._layer)}},{key:"show",value:function(){this._layer&&(this._layer.show=!0,this._layer.layerConfig.show=!0)}},{key:"hide",value:function(){this._layer&&(this._layer.show=!1,this._layer.layerConfig.show=!1)}},{key:"zoomTo",value:function(){this._layer&&(this._layer.layerConfig.view?cUtil.setCameraView(this._layer.layerConfig.view):this.viewer.flyTo(this._layer,new Cesium.HeadingPitchRange(Cesium.Math.toRadians(0),Cesium.Math.toRadians(-60),5*this._layer.boundingSphere.radius)))}},{key:"setCenter",value:function(e){var t=Cesium.Cartographic.fromCartesian(this._layer.initBoundingSphere.center),i=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,0),o=e.x||Cesium.Math.toDegrees(t.longitude),t=e.y||Cesium.Math.toDegrees(t.latitude),o=Cesium.Cartesian3.fromDegrees(o,t,e.z||0),t=Cesium.Cartesian3.subtract(o,i,new Cesium.Cartesian3);this._layer.modelMatrix=Cesium.Matrix4.fromTranslation(t)}},{key:"setPosition",value:function(e){e&&(e=e instanceof Cesium.Cartesian3?e.clone():Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z),e=Cesium.Transforms.eastNorthUpToFixedFrame(e),this._layer._root.transform=e)}},{key:"updateStyle",value:function(e,t){e&&t&&(e.style=new Cesium.Cesium3DTileStyle(t))}},{key:"setAlpha",value:function(e){e=null==e?1:e,this._layer.style=new Cesium.Cesium3DTileStyle({color:"color('rgba(255,255,255,"+e+")')"})}}]),o}(),WMSLayer=function(){_inherits(o,BaseLayer);var i=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(e=i.call(this,e,t)).type="wms",e.providerAttr.layers||console.log("当前服务缺少 layers 参数！",e.providerAttr),e._provider=new Cesium.WebMapServiceImageryProvider(e.providerAttr),e}return _createClass(o)}(),LayerTool=function(){function t(e){_classCallCheck(this,t),this.viewer=e,this._layerObjs=[]}return _createClass(t,[{key:"layers",get:function(){return this._layerObjs}},{key:"add",value:function(e){var t=null;switch((e=JSON.parse(JSON.stringify(e||{}))).type){case"xyz":t=new XYZLayer(this.viewer,e);break;case"wfs":case"geojson":t=new GeojsonLayer(this.viewer,e);break;case"mapserver":t=new MapserverLayer(this.viewer,e);break;case"arcgiscache":t=new ArcgiscacheLayer(this.viewer,e);break;case"tdt":t=new TDTLayer(this.viewer,e);break;case"singleImage":t=new SingleImageLayer(this.viewer,e);break;case"tms":t=new TMSLayer(this.viewer,e);break;case"3dtiles":t=new TilesetLayer(this.viewer,e);break;case"wms":t=new WMSLayer(this.viewer,e);break;case"grid":t=new GridLayer(this.viewer,e)}if(t)return"3dtiles"==t.type||"geojson"==t.type?t.load(function(){null!=e.alpha&&t.setAlpha(e.alpha),t.setVisible(e.show)}):(t.load(),null!=e.alpha&&t.setAlpha(e.alpha),t.setVisible(e.show)),this._layerObjs.push(t),e.id=e.id||Number((new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0)),e.alpha=null==e.alpha?1:e.alpha,t.attr=e,t}},{key:"getLayerObjById",value:function(e){if(e){for(var t={},i=0;i<this._layerObjs.length;i++)if(this._layerObjs[i].attr.id==e){t={layerObj:this._layerObjs[i],index:i};break}return t}}},{key:"getLayerObj",value:function(e){for(var t=e.key,i=e.value,o=0;o<this._layerObjs.length;o++)if(this._layerObjs[o].attr[t]==i){this._layerObjs[o];break}}},{key:"removeLayerObj",value:function(e){e&&this.removeLayerObjById(e.id)}},{key:"removeLayerObjById",value:function(e){!e||(e=this.getLayerObjById(e))&&e.layerObj&&(e.layerObj.remove(),this._layerObjs.splice(e.index,1))}},{key:"removeAll",value:function(){for(var e=0;e<this._layerObjs.length;e++)this._layerObjs[e].remove();this._layerObjs=[]}},{key:"destroy",value:function(){this.removeAll(),this._layerObjs=[],delete this._layerObjs}},{key:"hideById",value:function(e){!e||(e=this.getLayerObjById(e))&&e.layerObj&&(e.layerObj.hide(),e.layerObj.attr.show=!1)}},{key:"showById",value:function(e){!e||(e=this.getLayerObjById(e))&&e.layerObj&&(e.layerObj.show(),e.layerObj.attr.show=!0)}},{key:"setVisible",value:function(e,t){e&&(t?this.showById(e):this.hideById(e))}},{key:"zoomTo",value:function(e){!e||(e=this.getLayerObjById(e)||{})&&e.layerObj&&e.layerObj.zoomTo()}},{key:"hideAll",value:function(){for(var e=0;e<this._layerObjs.length;e++)this._layerObjs[e].hide()}},{key:"getAllshow",value:function(){for(var e=[],t=0;t<this._layerObjs.length;t++)this._layerObjs[t].attr.show&&e.push(this._layerObjs[t]);return e}},{key:"getAllhide",value:function(){for(var e=[],t=0;t<this._layerObjs.length;t++)this._layerObjs[t].attr.show||e.push(this._layerObjs[t]);return e}},{key:"getLayerObjByField",value:function(e,t){if(e){for(var i=[],o=0;o<this._layerObjs.length;o++)this._layerObjs[o].attr[e]==t&&i.push(this._layerObjs[o]);return i}}},{key:"lowerLayer",value:function(e){e&&(e instanceof String&&(e={key:"id",value:e}),(e=this.getLayerObj(e))&&e.layerObj&&e.layerObj.lowerLayer())}},{key:"lowerLayerToBottom",value:function(e){e&&(e instanceof String&&(e={key:"id",value:e}),(e=this.getLayerObj(e))&&e.layerObj&&e.layerObj.lowerLayerToBottom())}},{key:"raiseLayer",value:function(){var e;opt&&(opt instanceof String&&(opt={key:"id",value:opt}),(e=this.getLayerObj(opt))&&e.layerObj&&e.layerObj.raiseLayer())}},{key:"raiselayerToTop",value:function(){var e;opt&&(opt instanceof String&&(opt={key:"id",value:opt}),(e=this.getLayerObj(opt))&&e.layerObj&&e.layerObj.raiselayerToTop())}}]),t}(),PopupTooltipTool=function(){function i(e,t){_classCallCheck(this,i),this.viewer=e,this.opt=t||{},this.toolOpen=!0,this.popupHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.tooltipHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.lastTooltipPromptEnt=void 0,this.defaultVal={type:2,show:!0}}return _createClass(i,[{key:"autoBindPopup",value:function(){var o=this;this.popupHandler.setInputAction(function(e){var t,i;o.toolOpen&&(i=o.viewer.scene.pick(e.position),Cesium.defined(i)&&(i.primitive&&(t=i.primitive),(t=i.id&&i.id instanceof Cesium.Entity?i.id:t).click&&t.click(t),null!=t.popup&&(t.popupPrompt||(i={},"string"==typeof t.popup?i.content=t.popup:i=Object.assign(i,t.popup),i.type=i.type||2,t.popupPrompt=o.createPrompt(t,i,e.position),t.popupPrompt.ent=t),t.position||t.popupPrompt.update(e.position),i=t.popup.constructor==String||(null==t.popup.show||t.popup.show),t.popupPrompt.setVisible(i))))},Cesium.ScreenSpaceEventType.LEFT_CLICK)}},{key:"autoBindTooltip",value:function(){var o=this;this.popupHandler.setInputAction(function(e){var t,i;o.toolOpen&&((i=o.viewer.scene.pick(e.endPosition))&&i.primitive&&(t=i.primitive),(t=i&&i.id&&i.id instanceof Cesium.Entity?i.id:t)?(o.lastTooltipPromptEnt&&o.lastTooltipPromptEnt.tooltipPrompt&&t.id!=o.lastTooltipPromptEnt.id&&(o.lastTooltipPromptEnt.tooltipPrompt.destroy(),o.lastTooltipPromptEnt.tooltipPrompt=null),null!=t.tooltip&&""!=t.tooltip&&(t.tooltipPrompt?t.tooltipPrompt.update(e.endPosition):t.tooltipPrompt=o.createPrompt(t,t.tooltip,e.endPosition),i=t.tooltip.constructor==String||(null==t.tooltip.show||t.tooltip.show),t.tooltipPrompt.setVisible(i),o.lastTooltipPromptEnt=t)):o.lastTooltipPromptEnt&&o.lastTooltipPromptEnt.tooltipPrompt&&(o.lastTooltipPromptEnt.tooltipPrompt.destroy(),o.lastTooltipPromptEnt.tooltipPrompt=null))},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"createPrompt",value:function(e,t,i){var o=JSON.parse(JSON.stringify(this.defaultVal)),i=e.billboard||e.point||e.model?e.position.getValue(this.viewer.clock.currentTime):i;return e.tooltip&&(this.defaultVal.closeBtn=!1),o.position=i,t.constructor==String?o.content=t:o=Object.assign(o,t),new Prompt$1(this.viewer,o)}},{key:"close",value:function(){this.toolOpen=!1}},{key:"open",value:function(){this.toolOpen=!0}}]),i}(),RightTool=function(){function i(e,t){_classCallCheck(this,i),t=t||{};this.opt=Object.assign({lnglat:!0,cameraView:!0,depth:!0},t),e?(this.viewer=e,this.mapContainer=this.viewer.container,this.rightClickHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.randomId=(new Date).getTime()+""+Math.ceil(1e4*Math.random()),t='\n            <div class="easy3d-right-tool" id="easy3d-right-tool-'.concat(this.randomId,'">\n                <ul>\n                </ul>\n            </div>\n        '),$(this.mapContainer).append(t),$(document).off("click").on("click",function(){$(".easy3d-right-tool").hide()}),$(".easy3d-right-tool").click(function(e){e.stopPropagation()}),this.opt.lnglat&&this.crateLnglatTool(),this.opt.cameraView&&this.createCameraViewTool(),this.opt.depth&&this.crateDepthTool(),this.bindHandler(),this._clickPX=null):console.log("缺少viewer对象！")}return _createClass(i,[{key:"crateLnglatTool",value:function(){var a=this,e='\n          <li class="right-tool-lnglat" id="right-tool-lnglat-'.concat(this.randomId,'">\n            <span style="font-weight:bold;">当前坐标</span>\n          </li>\n        ');$("#easy3d-right-tool-".concat(this.randomId," ul")).append(e),$("#right-tool-lnglat-".concat(this.randomId)).on("click",function(){if($("#easy3d-right-tool-".concat(a.randomId)).hide(),a._clickPX){for(var e=a.viewer.scene.drillPick(a._clickPX),t=(a.viewer.scene.render(),!1),i=0;i<e.length;i++)if(e[i]&&e[i].primitive&&e[i].primitive instanceof Cesium.Cesium3DTileset){t=!0;break}if(t)r=a.viewer.scene.pickPosition(a._clickPX);else{var o=a.viewer.camera.getPickRay(a._clickPX);if(!o)return null;r=a.viewer.scene.globe.pick(o,a.viewer.scene)}var o=Cesium.Cartographic.fromCartesian(r.clone()),n=Cesium.Math.toDegrees(o.longitude),s=Cesium.Math.toDegrees(o.latitude),o=o.height,r="[".concat(Number(r.x)," , ").concat(Number(r.y)," , ").concat(Number(r.z),"]"),n="[".concat(Number(n).toFixed(6)," , ").concat(Number(s).toFixed(6)," , ").concat(Number(o).toFixed(2),"]"),s="\n                世界坐标：\n                <div>".concat(r,"</div>\n                经纬度：\n                <div>").concat(n,"</div>\n            ");a.crerateResultHtml("该点坐标",s)}})}},{key:"createCameraViewTool",value:function(){var n=this,e='\n          <li class="right-tool-view" id="right-tool-view-'.concat(this.randomId,'">\n                <span>相机视角</span>\n          </li>\n      ');$("#easy3d-right-tool-".concat(this.randomId," ul")).append(e),$("#right-tool-view-".concat(this.randomId)).on("click",function(){$("#easy3d-right-tool-".concat(n.randomId)).hide();var e=n.viewer.camera,t=e.position,i=e.heading,o=e.pitch,e=e.roll,t=Cesium.Cartographic.fromCartesian(t),t='\n                <div>{</div>              \n                <ul style="margin-left:10px;">\n                    <li>\n                        <span>\n                            "x" : '.concat(Cesium.Math.toDegrees(t.longitude),',\n                        </span>\n                    </li>\n                    <li>\n                        <span>\n                            "y" : ').concat(Cesium.Math.toDegrees(t.latitude),',\n                        </span>\n                    </li>\n                    <li>\n                        <span>\n                            "z" : ').concat(t.height,',\n                        </span>\n                    </li>\n                    <li>\n                        <span>\n                            "heading" : ').concat(Cesium.Math.toDegrees(i),',\n                        </span>\n                    </li>\n                    <li>\n                        <span>\n                            "pitch" : ').concat(Cesium.Math.toDegrees(o),',\n                        </span>\n                    </li>\n                    <li>\n                        <span>\n                        "roll" : ').concat(Cesium.Math.toDegrees(e),"\n                        </span>\n                    </li>\n                </ul>\n                <div>}</div> \n            ");n.crerateResultHtml("当前相机视角",t)})}},{key:"crateDepthTool",value:function(){var e=this,t=this.viewer.scene.globe.depthTestAgainstTerrain?"深度检测（关）":"深度检测（开）",t='\n          <li>\n            <span class="right-tool-depth" id="right-tool-depth-'.concat(this.randomId,'">\n              ').concat(t,"\n            </span>\n          </li>\n      ");$("#easy3d-right-tool-".concat(this.randomId," ul")).append(t),$("#right-tool-depth-".concat(this.randomId)).on("click",function(){$("#easy3d-right-tool-".concat(e.randomId)).hide(),-1!=$(this).text().indexOf("开")?($(this).text("深度检测（关）"),e.viewer.scene.globe.depthTestAgainstTerrain=!0):($(this).text("深度检测（开）"),e.viewer.scene.globe.depthTestAgainstTerrain=!1)})}},{key:"refreshDepthVal",value:function(){var e=this.viewer.scene.globe.depthTestAgainstTerrain?"深度检测（关）":"深度检测（开）";$("#right-tool-depth-".concat(this.randomId)).html(e)}},{key:"bindHandler",value:function(){var o=this;this.rightClickHandler.setInputAction(function(e){var t,i=o.viewer.scene.pick(e.position);!i||!i.primitive||i.primitive instanceof Cesium.Cesium3DTileset||(t=i.primitive),(t=i&&i.id&&i.id instanceof Cesium.Entity?i.id:t)||(o.refreshDepthVal(),i=e.position,o._clickPX=e.position,$("#easy3d-right-tool-".concat(o.randomId)).css({left:Number(i.x+10)+"px",top:Number(i.y+10)+"px",display:"block"}))},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}},{key:"destroy",value:function(){this.rightClickHandler&&(this.rightClickHandler.destroy(),this.rightClickHandler=null),$("easy3d-right-tool-".concat(this.randomId)).remove()}},{key:"crerateResultHtml",value:function(e,t){var i=this,e=($("#easy3d-right-content-".concat(this.randomId)).remove(),this.createShadow(),'\n            <div class="easy3d-right-content" class="easy3d-right-content-'.concat(this.randomId,'">\n                <span class="right-content-close" id="right-content-close-').concat(this.randomId,'" alt="" title="点击关闭">x</span>\n                <div class="right-content-result scrollbar">\n                <div class="content-result-title" style="font-weight:bold;">').concat(e,'：</div>\n                <div class="content-result-line"></div>\n                <div class="content-result-info">').concat(t,"</div>\n                </div>\n            </div>\n        "));$("body").append(e),$("#right-content-close-".concat(this.randomId)).off("click").on("click",function(){$(this).parent().remove(),$("#easy3d-right-tool-shadow-".concat(i.randomId)).remove()})}},{key:"createShadow",value:function(){$("#easy3d-right-tool-shadow-".concat(this.randomId)).remove();var e='\n            <div class="easy3d-right-tool-shadow" id="easy3d-right-tool-shadow-'.concat(this.randomId,'"></div>\n        ');$("body").append(e),$("#easy3d-right-tool-shadow-".concat(this.randomId)).show()}}]),i}(),turf=require("turf/turf.js"),BaseMeasure=function(){function i(e,t){_classCallCheck(this,i),t=t||{},this.viewer=e,this.objId=Number((new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0)),this.state=null,this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.floatLable=null,this.unit=t.unit,this.controlPoints=[],this.pointStyle={},this.modifyPoint=null,this.promptStyle=t.prompt||{show:!0,offset:{x:30,y:30}}}return _createClass(i,[{key:"createLine",value:function(e,t){if(e)return(t=this.viewer.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return e},!1),show:!0,material:Cesium.Color.YELLOW.withAlpha(.7),width:3,clampToGround:t}})).objId=this.objId,t}},{key:"forbidDrawWorld",value:function(e){this.viewer.scene.screenSpaceCameraController.enableRotate=!e,this.viewer.scene.screenSpaceCameraController.enableTilt=!e,this.viewer.scene.screenSpaceCameraController.enableTranslate=!e,this.viewer.scene.screenSpaceCameraController.enableInputs=!e}},{key:"createLabel",value:function(e,t){if(e)return this.viewer.entities.add({position:e,label:{text:t||"",font:"24px Helvetica",fillColor:Cesium.Color.SKYBLUE,outlineColor:Cesium.Color.BLACK,outlineWidth:2,disableDepthTestDistance:Number.POSITIVE_INFINITY,style:Cesium.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Cesium.Cartesian2(0,-20)}})}},{key:"setUnit",value:function(e){e&&(this.unit=e)}},{key:"getAzimuthtAndCenter",value:function(e,t){var i;if(t&&!(t.length<2))return i=t[0].clone(),e=e||Cesium.Transforms.eastNorthUpToFixedFrame(i.clone()),e=Cesium.Matrix4.inverse(e,new Cesium.Matrix4),t=t[1].clone(),i=Cesium.Matrix4.multiplyByPoint(e,i,new Cesium.Cartesian3),t=Cesium.Matrix4.multiplyByPoint(e,t,new Cesium.Cartesian3),e=Cesium.Cartesian3.subtract(t,i,new Cesium.Cartesian3),e=Cesium.Cartesian3.normalize(e,new Cesium.Cartesian3),i=new Cesium.Cartesian3(0,1,0),i=Cesium.Cartesian3.dot(i,e),e=new Cesium.Cartesian3(1,0,0),e=Cesium.Cartesian3.dot(e,t),t=Math.acos(i),i=Cesium.Math.toDegrees(t),e<0?360-i:i}},{key:"formateLength",value:function(e,t){var i;if(null!=e)return i="","km"==(t=t||"m")||"千米"==t?i+=(Number(e)/1e3).toFixed(2)+"km":"m"!=t&&"米"!=t||(i+=Number(e).toFixed(2)+"m"),i}},{key:"formateArea",value:function(e,t){var i;if(null!=e)return i="","km"==(t=t||"m")||"平方千米"==t?i+=(Number(e)/1e6).toFixed(2)+"km²":"m"!=t&&"平方米"!=t||(i+=Number(e).toFixed(2)+"m²"),i}},{key:"getCatesian3FromPX",value:function(e,t){for(var i,o=t.scene.drillPick(e),n=(t.scene.render(),!1),s=0;s<o.length;s++)if(o[s]&&o[s].primitive&&o[s].primitive instanceof Cesium.Cesium3DTileset){n=!0;break}if(n)i=t.scene.pickPosition(e);else{e=t.camera.getPickRay(e);if(!e)return null;i=t.scene.globe.pick(e,t.scene)}return i}},{key:"getGroundLength",value:function(e,r){var a=this.viewer.scene.globe.ellipsoid,t=this.getLength(e[0],e[1]);if(this.viewer.terrainProvider.availability){var i=Cesium.PolylinePipeline.generateArc({positions:e,granularity:1e-5});if(i){for(var o=[],l=Cesium.Cartographic.fromCartesian(e[0]).height,n=0;n<i.length;n+=3){var s=Cesium.Cartesian3.unpack(i,n);o.push(a.cartesianToCartographic(s))}Cesium.when(Cesium.sampleTerrainMostDetailed(this.viewer.terrainProvider,o),function(e){for(var t=0,i=0;i<e.length;i++){var o=e[i];o.height?o.height+=10:o.height=l}for(var n=a.cartographicArrayToCartesianArray(e),s=0;s<n.length-1;s++)t+=Cesium.Cartesian3.distance(n[s],n[s+1]);t&&r(t)})}}else console.log("缺少地形数据，或地形加载失败！"),r&&r(t)}},{key:"getSlope",value:function(r,a){var e,l,t,i,h;r&&(t=Cesium.Cartographic.fromCartesian(r),e=Cesium.Math.toDegrees(t.latitude),i=Cesium.Math.toDegrees(t.longitude),l=t.height,t=Cesium.Cartographic.fromDegrees(i,e+1e-5),i=Cesium.Cartographic.fromDegrees(i+1e-5,e),h=this,Cesium.when(Cesium.sampleTerrainMostDetailed(this.viewer.terrainProvider,[t,i]),function(e){for(var t=0;t<e.length;t++){var i=e[t];i.height=i.height||l}var o=h.viewer.scene.globe.ellipsoid.cartographicArrayToCartesianArray(e),n=o[0],o=o[1],s=Cesium.Transforms.eastNorthUpToFixedFrame(r),s=Cesium.Matrix4.inverse(s,new Cesium.Matrix4),s=(r=Cesium.Matrix4.multiplyByPoint(s,r,new Cesium.Cartesian3),n=Cesium.Matrix4.multiplyByPoint(s,n,new Cesium.Cartesian3),o=Cesium.Matrix4.multiplyByPoint(s,o,new Cesium.Cartesian3),Cesium.Cartesian3.subtract(n,r,new Cesium.Cartesian3)),n=Cesium.Cartesian3.subtract(o,r,new Cesium.Cartesian3),o=Cesium.Cartesian3.cross(s,n,new Cesium.Cartesian3),o=Cesium.Cartesian3.normalize(o,new Cesium.Cartesian3),s=new Cesium.Cartesian3(0,0,1),n=Cesium.Cartesian3.dot(o,s),o=Math.acos(n),s=90<(s=Cesium.Math.toDegrees(o))?180-s:s;a&&a(s)}))}},{key:"getLength",value:function(e,t){return e&&t&&Cesium.Cartesian3.distance(e,t)||0}},{key:"getAreaAndCenter",value:function(e){if(e&&!(e.length<1)){for(var t,i,o=[],n=[],s=0;s<e.length;s++){var r=e[s],r=Cesium.Cartographic.fromCartesian(r);o.push([Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude)]),n.push(turf.point([Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude)]))}if(o.length)return o=o.concat([o[0]]),t=turf.polygon([o]),t=turf.area(t),i=turf.featureCollection(n),i=turf.center(i).geometry.coordinates,{area:t,center:Cesium.Cartesian3.fromDegrees(i[0],i[1])}}}},{key:"createPoint",value:function(e){var t,i;if(e)return this.pointStyle.color=this.pointStyle.color||Cesium.Color.CORNFLOWERBLUE,this.pointStyle.outlineColor=this.pointStyle.color||Cesium.Color.CORNFLOWERBLUE,t=(t=this.pointStyle.color instanceof Cesium.Color?this.pointStyle.color:Cesium.Color.fromCssColorString(this.pointStyle.color)).withAlpha(this.pointStyle.colorAlpha||.8),i=(i=this.pointStyle.outlineColor instanceof Cesium.Color?this.pointStyle.outlineColor:Cesium.Color.fromCssColorString(this.pointStyle.outlineColor)).withAlpha(this.pointStyle.outlineColorAlpha||.8),this.viewer.entities.add({position:e,point:{pixelSize:this.pointStyle.property||10,color:t,outlineWidth:this.pointStyle.outlineWidth||0,outlineColor:i,disableDepthTestDistance:Number.POSITIVE_INFINITY},show:!1})}}]),i}(),MeasureGroundDistance=function(){_inherits(n,BaseMeasure);var o=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=o.call(this,e,t)).unitType="length",i.type="groundDistance",i.style=(t=t||{}).style||{},i.viewer=e,i.polyline=null,i.positions=[],i.labels=[],i.nowLabel=null,i.nextlabel=null,i.lastPosition=null,i.nextPosition=null,i.modifyPoint=null,i.lastCartesian=null,i.allDistance=0,i.prompt,i.movePush=!1,i.floatDistance=-1,i}return _createClass(n,[{key:"start",value:function(e){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle));var o=this;this.state="startCreate",this.handler.setInputAction(function(e){o.state="creating";var t,i,e=o.getCatesian3FromPX(e.position,o.viewer);e&&(o.movePush&&(o.positions.pop(),o.movePush=!1),o.floatLable||(o.floatLable=o.createLabel(e,""),o.floatLable.wz=0,o.floatLable.show=!1),(t=o.createLabel(e,"")).wz=o.positions.length,o.labels.push(t),(i=o.createPoint(e.clone())).wz=o.positions.length,o.controlPoints.push(i),0==o.positions.length?t.label.text="起点":(o.lastDistance=o.floatDistance,o.allDistance+=o.floatDistance,i=o.formateLength(o.floatDistance),t.label.text=i,t.distance=o.floatDistance),o.positions.push(e.clone()),o.lastCartesian=e.clone())},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){var t;o.state="creating",o.positions.length<1?o.prompt.update(e.endPosition,"单击开始测量"):(o.prompt.update(e.endPosition,"双击结束，右键取消上一步"),(t=o.getCatesian3FromPX(e.endPosition,o.viewer))&&(o.movePush?o.positions[o.positions.length-1]=t.clone():(o.positions.push(t),o.movePush=!0),Cesium.defined(o.polyline)||(o.polyline=o.createLine(o.positions,!0)),o.lastCartesian&&o.getGroundLength([t,o.lastCartesian],function(e){o.floatLable.show=!0,o.floatLable.label.text=o.formateLength(e,o.unit),o.floatLable.position.setValue(t),o.floatLable.distance=e,o.floatDistance=e,o.fun&&o.fun(e)})))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){var t;o.state="creating",!o.polyline||o.positions.length<=2||(o.positions.splice(o.positions.length-2,1),o.viewer.entities.remove(o.labels.pop()),o.viewer.entities.remove(o.controlPoints.pop()),o.allDistance=o.allDistance-o.lastDistance,1==o.positions.length&&(o.polyline&&(o.viewer.entities.remove(o.polyline),o.polyline=null),o.prompt.update(e.endPosition,"单击开始测量"),o.floatLable.show=!1,o.positions=[]),(t=o.getCatesian3FromPX(e.position,o.viewer))&&o.getGroundLength([t,o.positions[o.positions.length-2]],function(e){o.floatLable.show=!0,o.floatLable.label.text=o.formateLength(e,o.unit),o.floatLable.distance=e,o.floatLable.position.setValue(t)}))},Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.handler.setInputAction(function(e){var t;o.polyline&&(o.floatLable.show=!1,o.viewer.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),o.viewer.trackedEntity=void 0,o.positions.pop(),o.viewer.entities.remove(o.labels.pop()),o.viewer.entities.remove(o.controlPoints.pop()),t=o.formateLength(o.allDistance,o.unit),o.labels[o.labels.length-1].label.text="总长："+t,o.handler&&(o.handler.destroy(),o.handler=null),o.prompt&&(o.prompt.destroy(),o.prompt=null),o.state="endCreate")},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}},{key:"startEdit",value:function(t){if("endCrerate"!=this.state&&"endEdit"!=this.state||this.polyline){this.state="startEdit",this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas));for(var n=this,e=0;e<n.controlPoints.length;e++){var i=n.controlPoints[e];i&&(i.show=!0)}this.modifyHandler.setInputAction(function(e){var t,i,e=n.viewer.scene.pick(e.position);Cesium.defined(e)&&e.id&&(e.id.objId||(n.modifyPoint=e.id),n.forbidDrawWorld(!0),t=(e=n.modifyPoint.wz)+1,i=e-1,n.nowLabel=n.labels[e],0<=i&&(n.lastPosition=n.positions[i]),t<=n.positions.length-1&&(n.nextPosition=n.positions[t],n.nextlabel=n.labels[t]))},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.modifyHandler.setInputAction(function(e){var t,i,o;n.positions.length<1||!n.modifyPoint||(e=n.getCatesian3FromPX(e.endPosition,n.viewer))&&(n.modifyPoint.position.setValue(e),t=n.modifyPoint.wz,n.positions[t]=e.clone(),n.state="editing",n.nowLabel.position.setValue(e.clone()),o=i=0,n.nowLabel&&n.lastPosition&&n.getGroundLength([e.clone(),n.lastPosition.clone()],function(e){n.nowLabel.label.text=n.formateLength(e,n.unit),i=e-n.nowLabel.distance,n.nowLabel.distance=e,n.allDistance=n.allDistance+i+o;e=n.formateLength(n.allDistance,n.unit);n.labels[n.labels.length-1].label.text="总长："+e}),n.nextPosition&&n.nextlabel&&n.getGroundLength([e.clone(),n.nextPosition.clone()],function(e){n.nextlabel.label.text=n.formateLength(e,n.unit),o=e-n.nextlabel.distance,n.nextlabel.distance=e,n.allDistance=n.allDistance+i+o;e=n.formateLength(n.allDistance,n.unit);n.labels[n.labels.length-1].label.text="总长："+e}))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.modifyHandler.setInputAction(function(e){n.modifyPoint&&(n.modifyPoint=null,n.lastPosition=null,n.nextPosition=null,n.forbidDrawWorld(!1),t&&t(),n.state="endEdit")},Cesium.ScreenSpaceEventType.LEFT_UP)}}},{key:"endEdit",value:function(){this.state="endEdit",this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null);for(var e=0;e<this.controlPoints.length;e++){var t=this.controlPoints[e];t&&(t.show=!1)}}},{key:"destroy",value:function(){this.polyline&&(this.viewer.entities.remove(this.polyline),this.polyline=null);for(var e=0;e<this.labels.length;e++)this.viewer.entities.remove(this.labels[e]);this.labels=[];for(var t=0;t<this.controlPoints.length;t++)this.viewer.entities.remove(this.controlPoints[t]);this.controlPoints=[],this.modifyPoint=null,this.floatLable&&(this.viewer.entities.remove(this.floatLable),this.floatLable=null),this.floatLable=null,this.prompt&&(this.prompt.destroy(),this.prompt=null),this.handler&&(this.handler.destroy(),this.handler=null),this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null),this.viewer.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this.viewer.trackedEntity=void 0,this.state="no"}},{key:"setUnit",value:function(e){for(var t=0;t<this.labels.length;t++){var i=this.labels[t],o=i.distance;t==this.labels.length-1?i.text="总长："+this.formateLength(o,e):i.text=this.formateLength(o,e)}this.unit=e}}]),n}(),MeasureSpaceDistance=function(){_inherits(o,MeasureGroundDistance);var i=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(e=i.call(this,e,t)).unitType="length",e.type="spaceDistance",e.allDistance=0,e.labels=[],e.nowLabel=null,e.nextlabel=null,e.lastPosition=null,e.nextPosition=null,e}return _createClass(o,[{key:"start",value:function(i){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle));var n=this;this.state="startCreate",this.handler.setInputAction(function(e){n.state="creating";var t,i,o,e=n.getCatesian3FromPX(e.position,n.viewer);e&&(n.movePush&&(n.positions.pop(),n.movePush=!1),0==n.positions.length?(i=n.createLabel(e,"起点"),n.floatLable=n.createLabel(e,""),n.floatLable.wz=0,n.floatLable.show=!1):(t=n.getLength(e,n.lastCartesian),n.lastDistance=t,n.allDistance+=t,o=n.formateLength(t,n.unit),(i=n.createLabel(e,o)).wz=n.positions.length,i.distance=t),n.labels.push(i),(o=n.createPoint(e.clone())).wz=n.positions.length,n.controlPoints.push(o),n.positions.push(e),n.lastCartesian=e.clone())},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){var t=n.getCatesian3FromPX(e.endPosition,n.viewer);t&&(n.state="creating",n.positions.length<1?n.prompt.update(e.endPosition,"单击开始测量"):(n.prompt.update(e.endPosition,"双击结束，右键取消上一步"),n.floatLable.show=!0,n.movePush?n.positions[n.positions.length-1]=t:(n.positions.push(t),n.movePush=!0),Cesium.defined(n.polyline)||(n.polyline=n.createLine(n.positions,!1)),n.lastCartesian&&(e=n.getLength(t,n.lastCartesian),n.floatLable.show=!0,n.floatLable.label.text=n.formateLength(e,n.unit),n.floatLable.distance=e,n.floatLable.position.setValue(t))))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){var t;n.state="creating",!n.polyline||n.positions.length<=2||(n.positions.splice(n.positions.length-2,1),n.viewer.entities.remove(n.labels.pop()),n.viewer.entities.remove(n.controlPoints.pop()),n.allDistance=n.allDistance-n.lastDistance,1==n.positions.length&&(n.polyline&&(n.viewer.entities.remove(n.polyline),n.polyline=null),n.prompt.update(e.endPosition,"单击开始测量"),n.movePush=!1,n.floatLable.show=!1,n.positions=[]),(e=n.getCatesian3FromPX(e.position,n.viewer))&&(t=n.getLength(e,n.positions[n.positions.length-2]),n.floatLable.show=!0,n.floatLable.label.text=n.formateLength(t,n.unit),n.floatLable.distance=t,n.floatLable.position.setValue(e)))},Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.handler.setInputAction(function(e){var t;n.polyline&&(n.floatLable.show=!1,n.viewer.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),n.viewer.trackedEntity=void 0,n.positions.pop(),n.viewer.entities.remove(n.labels.pop()),n.viewer.entities.remove(n.controlPoints.pop()),t=n.formateLength(n.allDistance,n.unit),n.labels[n.labels.length-1].label.text="总长："+t,n.movePush=!1,n.prompt&&(n.prompt.destroy(),n.prompt=null),n.handler&&(n.handler.destroy(),n.handler=null),n.state="endCreate",i&&i())},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}},{key:"startEdit",value:function(t){if("endCrerate"!=this.state&&"endEdit"!=this.state||this.polyline){this.state="startEdit",this.modifyHandler||(this.modifyHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas));for(var o=this,e=0;e<o.controlPoints.length;e++){var i=o.controlPoints[e];i&&(i.show=!0)}this.modifyHandler.setInputAction(function(e){var t,i,e=o.viewer.scene.pick(e.position);Cesium.defined(e)&&e.id&&(e.id.objId||(o.modifyPoint=e.id),o.forbidDrawWorld(!0),t=(e=o.modifyPoint.wz)+1,i=e-1,o.nowLabel=o.labels[e],0<=i&&(o.lastPosition=o.positions[i]),t<=o.positions.length-1&&(o.nextPosition=o.positions[t],o.nextlabel=o.labels[t]))},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.modifyHandler.setInputAction(function(e){var t,i;o.positions.length<1||!o.modifyPoint||(e=o.getCatesian3FromPX(e.endPosition,o.viewer))&&(o.modifyPoint.position.setValue(e),t=o.modifyPoint.wz,o.positions[t]=e.clone(),o.state="editing",o.nowLabel.position.setValue(e.clone()),t=0,o.nowLabel&&o.lastPosition&&(i=o.getLength(e.clone(),o.lastPosition.clone()),o.nowLabel.label.text=o.formateLength(i,o.unit),t=i-o.nowLabel.distance,o.nowLabel.distance=i),i=0,o.nextPosition&&o.nextlabel&&(e=o.getLength(e.clone(),o.nextPosition.clone()),o.nextlabel.label.text=o.formateLength(e,o.unit),i=e-o.nextlabel.distance,o.nextlabel.distance=e),o.allDistance=o.allDistance+t+i,e=o.formateLength(o.allDistance,o.unit),o.labels[o.labels.length-1].label.text="总长："+e)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.modifyHandler.setInputAction(function(e){o.modifyPoint&&(o.modifyPoint=null,o.lastPosition=null,o.nextPosition=null,o.forbidDrawWorld(!1),t&&t(),o.state="endEdit")},Cesium.ScreenSpaceEventType.LEFT_UP)}}},{key:"endEdit",value:function(){this.state="endEdit",this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null);for(var e=0;e<this.controlPoints.length;e++){var t=this.controlPoints[e];t&&(t.show=!1)}}},{key:"destroy",value:function(){this.polyline&&(this.viewer.entities.remove(this.polyline),this.polyline=null);for(var e=0;e<this.labels.length;e++)this.viewer.entities.remove(this.labels[e]);this.labels=[];for(var t=0;t<this.controlPoints.length;t++)this.viewer.entities.remove(this.controlPoints[t]);this.controlPoints=[],this.modifyPoint=null,this.floatLable&&(this.viewer.entities.remove(this.floatLable),this.floatLable=null),this.floatLable=null,this.prompt&&(this.prompt.destroy(),this.prompt=null),this.handler&&(this.handler.destroy(),this.handler=null),this.modifyHandler&&(this.modifyHandler.destroy(),this.modifyHandler=null),this.movePush=!1,this.viewer.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this.viewer.trackedEntity=void 0,this.state="no"}},{key:"setUnit",value:function(e){for(var t=0;t<this.labels.length;t++){var i=this.labels[t],o=i.distance;t==this.labels.length-1?i.text="总长："+that.formateLength(o,e):i.text=that.formateLength(o,e)}this.unit=e}}]),o}(),MeasureSpaceArea=function(){_inherits(n,BaseMeasure);var o=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),i=o.call(this,e,t),t=t||{},i.unitType="area",i.style=t.style||{},i.viewer=e,i.polyline=null,i.polygon=null,i.positions=[],i.movePush=!1,i.prompt,i}return _createClass(n,[{key:"start",value:function(n){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle));var s=this;this.state="startCreate",this.handler.setInputAction(function(e){s.state="creating";e=s.getCatesian3FromPX(e.position,s.viewer);e&&(s.movePush&&(s.positions.pop(),s.movePush=!1),s.positions.push(e))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){var t,i;s.state="creating",s.positions.length<1?s.prompt.update(e.endPosition,"单击开始绘制"):(s.prompt.update(e.endPosition,"双击结束，右键取消上一步"),e=s.getCatesian3FromPX(e.endPosition,s.viewer),1<=s.positions.length&&(s.movePush?s.positions[s.positions.length-1]=e:(s.positions.push(e),s.movePush=!0),2!=s.positions.length||Cesium.defined(s.polyline)||(s.polyline=s.createPolyline()),3==s.positions.length&&(Cesium.defined(s.polygon)||(s.polygon=s.createPolygon(),s.polygon.isFilter=!0,s.polygon.objId=s.objId,s.polyline&&(s.polyline.show=!1)),s.floatLabel||(s.floatLabel=s.createLabel(e,""))),s.polygon&&(t=(e=s.getAreaAndCenter(s.positions)).area,e=e.center,i=s.formateArea(t,s.unit),s.floatLabel.label.text="面积："+i,s.floatLabel.area=t,e&&s.floatLabel.position.setValue(e),s.floatLabel.show=!0)))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){var t,i;s.state="creating",(s.polyline||s.polygon)&&(s.positions.splice(s.positions.length-2,1),2==s.positions.length&&(s.polygon&&(s.viewer.entities.remove(s.polygon),s.polygon=null,s.polyline&&(s.polyline.show=!0)),s.floatLabel.show=!1),1==s.positions.length&&(s.polyline&&(s.viewer.entities.remove(s.polyline),s.polyline=null),s.prompt.update(e.endPosition,"单击开始测量"),s.positions=[],s.movePush=!1),2<s.positions.length&&(t=(e=s.getAreaAndCenter(s.positions)).area,e=e.center,i=s.formateArea(t,s.unit),s.floatLabel.label.text="面积："+i,e&&s.floatLabel.position.setValue(e),s.floatLabel.area=t,s.floatLabel.show=!0))},Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.handler.setInputAction(function(e){var t,i,o;s.polygon&&(s.viewer.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),s.viewer.trackedEntity=void 0,s.positions.pop(),t=(i=s.getAreaAndCenter(s.positions)).area,i=i.center,o=s.formateArea(t,s.unit),s.floatLabel.label.text="面积："+o,s.floatLabel.area=t,i&&s.floatLabel.position.setValue(i),s.handler&&(s.handler.destroy(),s.handler=null),s.movePush=!1,s.prompt&&(s.prompt.destroy(),s.prompt=null),s.state="endCreate",n&&n(s.polyline))},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}},{key:"destroy",value:function(){this.state="no",this.polyline&&(this.viewer.entities.remove(this.polyline),this.polyline=null),this.polygon&&(this.viewer.entities.remove(this.polygon),this.polygon=null),this.floatLabel&&(this.viewer.entities.remove(this.floatLabel),this.floatLabel=null),this.handler&&(this.handler.destroy(),this.handler=null),this.floatLable=null}},{key:"createPolyline",value:function(){var e=this;return this.viewer.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return e.positions},!1),material:Cesium.Color.YELLOW,width:3,clampToGround:!0}})}},{key:"createPolygon",value:function(){var e=this;return viewer.entities.add({polygon:new Cesium.PolygonGraphics({hierarchy:new Cesium.CallbackProperty(function(){return new Cesium.PolygonHierarchy(e.positions)},!1),material:this.style.material||Cesium.Color.LIME.withAlpha(.5),fill:!0})})}},{key:"setUnit",value:function(e){this.unit=e;e=this.formateArea(this.floatLabel.area,e);this.floatLabel.label.text="面积："+e}}]),n}(),MeasureHeight=function(){_inherits(n,BaseMeasure);var o=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),i=o.call(this,e,t),t=t||{},i.unitType="length",i.style=t.style||{},i.viewer=e,i.polyline=null,i.floatLabel=null,i.positions=[],i.height=0,i}return _createClass(n,[{key:"start",value:function(){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle)),this.state="startCreate";var i=this;this.handler.setInputAction(function(e){i.state="creating";e=i.getCatesian3FromPX(e.position,i.viewer);e&&(2==i.positions.length&&(i.positions.pop(),i.positions.push(e),i.handler&&(i.handler.destroy(),i.handler=null),i.prompt&&(i.prompt.destroy(),i.prompt=null),i.state="endCreate"),i.positions.push(e))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){var t=i.getCatesian3FromPX(e.endPosition,i.viewer);t&&(i.state="creating",i.positions.length<1?i.prompt.update(e.endPosition,"单击开始测量"):(i.prompt.update(e.endPosition,"单击结束"),2!=i.positions.length||Cesium.defined(i.polyline)||(i.polyline=i.createLine(i.positions,!1),i.floatLabel||(i.floatLabel=i.createLabel(t,""))),e=i.getHeightAndCenter(i.positions[0],i.positions[1]),t=i.formateLength(e.height,i.unit),i.height=e.height,i.floatLabel.label.text="高度差："+t,i.floatLabel.length=e.height,e.center&&i.floatLabel.position.setValue(e.center)))},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"destroy",value:function(){this.polyline&&(this.viewer.entities.remove(this.polyline),this.polyline=null),this.floatLabel&&(this.viewer.entities.remove(this.floatLabel),this.floatLabel=null),this.prompt&&(this.prompt.destroy(),this.prompt=null),this.handler&&(this.handler.destroy(),this.handler=null),this.state="no"}},{key:"getHeightAndCenter",value:function(e,t){var i,o;if(e&&t)return i=Cesium.Cartographic.fromCartesian(e),o=Cesium.Cartographic.fromCartesian(t),{height:Math.abs(i.height-o.height),center:Cesium.Cartesian3.midpoint(e,t,new Cesium.Cartesian3)}}},{key:"setUnit",value:function(e){var t=this.formateLength(this.floatLabel.length,e);this.floatLabel.label.text="高度差："+t,this.unit=e}}]),n}(),MeasureTriangle=function(){_inherits(n,BaseMeasure);var o=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),i=o.call(this,e,t),t=t||{},i.unitType="length",i.style=t.style||{},i.objId=Number((new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0)),i.viewer=e,i.handler=new Cesium.ScreenSpaceEventHandler(i.viewer.scene.canvas),i.ts_handler=new Cesium.ScreenSpaceEventHandler(i.viewer.scene.canvas),i.heightfloatLabel=null,i.spaceDistancefloatLabel=null,i.horizonDistancefloatLabel=null,i.heightLine=null,i.spaceLine=null,i.horizonLine=null,i.firstPoint=null,i.endPoint=null,i.midPoint=null,i.prompt,i}return _createClass(n,[{key:"start",value:function(){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle));var i=this;this.state=1,this.handler.setInputAction(function(e){e=i.getCatesian3FromPX(e.position,i.viewer);e&&(i.firstPoint?(i.endPoint=e,i.midPoint=i.computerPoint(i.firstPoint,i.endPoint),i.handler&&(i.handler.destroy(),i.handler=null),i.ts_handler&&(i.ts_handler.destroy(),i.ts_handler=null),i.prompt&&(i.prompt.destroy(),i.prompt=null),i.state="endCreate"):(i.firstPoint=e,i.heightfloatLabel=i.createLabel(e,""),i.spaceDistancefloatLabel=i.createLabel(e,""),i.horizonDistancefloatLabel=i.createLabel(e,"")))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){var t;i.state="creating",i.firstPoint<1?i.prompt.update(e.endPosition,"单击开始测量"):(i.prompt.update(e.endPosition,"单击结束"),(e=i.getCatesian3FromPX(e.endPosition,i.viewer))&&(i.endPoint=e,i.midPoint=i.computerPoint(i.firstPoint,i.endPoint),i.firstPoint&&i.endPoint&&!i.spaceLine&&(i.spaceLine=i.viewer.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return[i.firstPoint,i.endPoint]},!1),show:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY,material:Cesium.Color.YELLOW,width:3,depthFailMaterial:new Cesium.PolylineArrowMaterialProperty(Cesium.Color.YELLOW)}}),i.heightLine=i.viewer.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return[i.firstPoint,i.midPoint]},!1),show:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY,material:Cesium.Color.YELLOW,width:3,depthFailMaterial:new Cesium.PolylineArrowMaterialProperty(Cesium.Color.YELLOW)}}),i.horizonLine=i.viewer.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return[i.endPoint,i.midPoint]},!1),show:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY,material:Cesium.Color.YELLOW,width:3,depthFailMaterial:new Cesium.PolylineArrowMaterialProperty(Cesium.Color.YELLOW)}})),i.spaceLine&&(e=Math.abs(Cesium.Cartographic.fromCartesian(i.firstPoint).height-Cesium.Cartographic.fromCartesian(i.endPoint).height),t=Cesium.Cartesian3.midpoint(i.firstPoint,i.midPoint,new Cesium.Cartesian3),i.heightfloatLabel.show=!0,i.heightfloatLabel.position.setValue(t),t=i.formateLength(e,i.unit),i.heightfloatLabel.label.text="高度差："+t,i.heightfloatLabel.length=e,t=Cesium.Cartesian3.distance(i.endPoint,i.midPoint),e=Cesium.Cartesian3.midpoint(i.endPoint,i.midPoint,new Cesium.Cartesian3),i.horizonDistancefloatLabel.show=!0,i.horizonDistancefloatLabel.position.setValue(e),e=i.formateLength(t,i.unit),i.horizonDistancefloatLabel.label.text="水平距离："+e,i.horizonDistancefloatLabel.length=t,e=Cesium.Cartesian3.distance(i.endPoint,i.firstPoint),t=Cesium.Cartesian3.midpoint(i.endPoint,i.firstPoint,new Cesium.Cartesian3),i.spaceDistancefloatLabel.show=!0,i.spaceDistancefloatLabel.position.setValue(t),t=i.formateLength(e,i.unit),i.spaceDistancefloatLabel.label.text="空间距离："+t,i.spaceDistancefloatLabel.length=e)))},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"destroy",value:function(){this.state="no",this.heightLine&&(this.viewer.entities.remove(this.heightLine),this.heightLine=null),this.spaceLine&&(this.viewer.entities.remove(this.spaceLine),this.spaceLine=null),this.horizonLine&&(this.viewer.entities.remove(this.horizonLine),this.horizonLine=null),this.heightfloatLabel&&(this.viewer.entities.remove(this.heightfloatLabel),this.heightfloatLabel=null),this.heightfloatLabel=null,this.spaceDistancefloatLabel&&(this.viewer.entities.remove(this.spaceDistancefloatLabel),this.spaceDistancefloatLabel=null),this.spaceDistancefloatLabel=null,this.horizonDistancefloatLabel&&(this.viewer.entities.remove(this.horizonDistancefloatLabel),this.horizonDistancefloatLabel=null),this.horizonDistancefloatLabel=null,this.prompt&&(this.prompt.destroy(),this.prompt=null),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"createLine",value:function(e,t){if(e&&t)return this.viewer.entities.add({polyline:{positions:new Cesium.CallbackProperty(function(){return[e,t]},!1),show:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY,material:Cesium.Color.YELLOW,width:3,depthFailMaterial:new Cesium.PolylineArrowMaterialProperty(Cesium.Color.YELLOW)}})}},{key:"computerPoint",value:function(e,t){e=Cesium.Cartographic.fromCartesian(e),t=Cesium.Cartographic.fromCartesian(t);return e.height>t.height?Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,e.height):Cesium.Cartesian3.fromRadians(e.longitude,e.latitude,t.height)}},{key:"setUnit",value:function(e){var t=that.formateLength(this.heightfloatLabel.length,e),t=(this.heightfloatLabel.label.text="高度差："+t,that.formateLength(this.horizonDistancefloatLabel.length,e)),t=(this.horizonDistancefloatLabel.label.text="水平距离："+t,that.formateLength(this.spaceDistancefloatLabel.length,e));this.spaceDistancefloatLabel.label.text="空间距离："+t,this.unit=e}}]),n}(),MeasureLnglat=function(){_inherits(o,BaseMeasure);var i=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(e=i.call(this,e,t)).style=(t=t||{}).style||{},e.point=null,e.position=null,e.state=0,e}return _createClass(o,[{key:"start",value:function(){this.state="startCreate";var t=this;this.handler.setInputAction(function(e){t.state="endCreate";e=t.getCatesian3FromPX(e.position,t.viewer);e&&(t.position=e,t.handler&&(t.handler.destroy(),t.handler=null))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){t.state="creating";var e=t.getCatesian3FromPX(e.endPosition,t.viewer);e&&(t.position=e.clone(),Cesium.defined(t.point)||(t.point=t.createPoint()),e=cUtil$1.cartesianToLnglat(e),t.point.label.text="经度："+e[0].toFixed(6)+"\n纬度："+e[1].toFixed(6)+"\n高度："+e[2].toFixed(2)+"米")},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"destroy",value:function(){this.state="no",this.point&&(this.viewer.entities.remove(this.point),this.point=null),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"createPoint",value:function(){var e=this;return this.viewer.entities.add({position:new Cesium.CallbackProperty(function(){return e.position},!1),point:{show:!0,outlineColor:Cesium.Color.YELLOW,pixelSize:6,outlineWidth:3,disableDepthTestDistance:Number.MAX_VALUE},label:{font:"24px Helvetica",fillColor:Cesium.Color.SKYBLUE,outlineColor:Cesium.Color.BLACK,outlineWidth:2,disableDepthTestDistance:Number.POSITIVE_INFINITY,style:Cesium.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Cesium.Cartesian2(0,-60)}})}}]),o}(),MeasureAzimutht=function(){_inherits(o,BaseMeasure);var i=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(e=i.call(this,e,t)).style=t.style||{},e.polyline=null,e.floatLabel=null,e.positions=[],e.mtx=null,e.azimutht=null,e}return _createClass(o,[{key:"start",value:function(t){var i=this;this.state="startCreate",!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt$1(this.viewer,this.promptStyle)),this.handler.setInputAction(function(e){e=i.getCatesian3FromPX(e.position,i.viewer);e&&(2==i.positions.length&&(i.positions.pop(),i.handler&&(i.handler.destroy(),i.handler=null,i.state="endCreate")),i.polyline||(i.polyline=i.createLine(i.positions),i.polyline.polyline.width=5,i.polyline.polyline.material=new Cesium.PolylineArrowMaterialProperty(Cesium.Color.YELLOW)),i.positions.push(e),1==i.positions.length&&(i.mtx=Cesium.Transforms.eastNorthUpToFixedFrame(i.positions[0].clone()),i.floatLabel=i.createLabel(e,""),t&&t(i.azimutht)))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){i.positions.length<1?i.prompt.update(e.endPosition,"单击开始测量"):(i.prompt.update(e.endPosition,"单击结束"),i.state="creating",(e=i.getCatesian3FromPX(e.endPosition,i.viewer))&&(i.positions.length<2?i.positions.push(e.clone()):i.positions[1]=e.clone(),i.floatLabel&&(i.azimutht=i.getAzimuthtAndCenter(i.mtx,i.positions),i.floatLabel.label.text="方位角："+i.azimutht.toFixed(2))))},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"destroy",value:function(){this.polyline&&(this.viewer.entities.remove(this.polyline),this.polyline=null),this.floatLabel&&(this.viewer.entities.remove(this.floatLabel),this.floatLabel=null),this.floatLable=null,this.handler&&(this.handler.destroy(),this.handler=null),this.state="no",this.prompt&&(this.prompt.destroy(),this.prompt=null)}}]),o}(),MeasureSection=function(){_inherits(n,BaseMeasure);var o=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=o.call(this,e,t)).style=t.style||{},i.viewer=e,i.polyline=null,i.positions=[],i.movePush=!1,i.prompt,i.isStart=!1,i.firstPosition=null,i.state="no",i}return _createClass(n,[{key:"start",value:function(t){!this.prompt&&this.promptStyle.show&&(this.prompt=new Prompt(this.viewer,this.promptStyle));var i=this;i.state="startCreate",this.handler.setInputAction(function(e){e=i.getCatesian3FromPX(e.position,i.viewer);e&&(i.isStart?(i.handler&&(i.handler.destroy(),i.handler=null),i.prompt&&(i.prompt.destroy(),i.prompt=null),i.getHeight(i.positions,function(e){t(e)}),i.state="endCreate"):(i.isStart=!0,i.firstPosition=e))},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){var t;i.state="creating",i.isStart?(i.prompt.update(e.endPosition,"再次单击结束"),t=i.getCatesian3FromPX(e.endPosition,i.viewer),i.positions=[i.firstPosition,t],i.polyline||(i.polyline=i.viewer.entities.add({polyline:{show:!0,positions:new Cesium.CallbackProperty(function(){return i.positions},!1),material:Cesium.Color.GREEN,width:3,clampToGround:!0}}))):i.prompt.update(e.endPosition,"单击开始")},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"destroy",value:function(){this.polyline&&(this.viewer.entities.remove(this.polyline),this.polyline=null),this.prompt&&(this.prompt.destroy(),this.prompt=null),this.handler&&(this.handler.destroy(),this.handler=null),this.viewer.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this.viewer.trackedEntity=void 0,this.state="no"}},{key:"getHeight",value:function(o,n){var t,s;!o||o.length<1||(o=cUtil.lerpPositions(o),t=[],o.forEach(function(e){t.push(Cesium.Cartographic.fromCartesian(e))}),!t||t.length<1||(s=Cesium.Cartographic.fromCartesian(o[0]).height,Cesium.when(Cesium.sampleTerrainMostDetailed(this.viewer.terrainProvider,t),function(e){for(var t=0;t<e.length;t++){var i=e[t];i.height=i.height||s}n&&n({positions:o,lnglats:e})})))}}]),n}(),MeasureSlope=function(){_inherits(n,BaseMeasure);var o=_createSuper(n);function n(e,t){var i;return _classCallCheck(this,n),(i=o.call(this,e,t=t||{})).style=t.style||{},i.viewer=e,i.label=null,i.point=null,i}return _createClass(n,[{key:"start",value:function(){this.state="startCreate";var i=this;this.handler.setInputAction(function(e){i.handler&&(i.handler.destroy(),i.handler=null,i.state="endCreate")},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){i.state="creating";var t=i.getCatesian3FromPX(e.endPosition,i.viewer);t&&(i.point||(i.point=i.createPoint(t)),i.point.position.setValue(t),i.getSlope(t,function(e){i.label||(i.label=i.createLabel(t,"")),i.label.position.setValue(t),i.label.label.text="坡度："+e.toFixed(2)+"°"}))},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"destroy",value:function(){this.state="no",this.label&&(this.viewer.entities.remove(this.label),this.label=null),this.point&&(this.viewer.entities.remove(this.point),this.point=null),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"createPoint",value:function(e){return this.viewer.entities.add({position:e,point:(_defineProperty(e={heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,show:!0,fillColor:Cesium.Color.WHITE,outlineColor:Cesium.Color.RED,outlineWidth:2,pixelSize:6},"outlineWidth",3),_defineProperty(e,"disableDepthTestDistance",Number.MAX_VALUE),e)})}}]),n}(),MeasureTool=function(){function i(e,t){_classCallCheck(this,i),e?(t=t||{},this.viewer=e,this.nowMeasureObj=null,this.toolArr=[],this.lastMeasureObj=null,this.handler=null,this.canEdit=null==t.canEdit||t.canEdit,this.intoEdit=null==t.intoEdit||t.intoEdit,this.bindEdit()):console.warn("缺少必要参数！--viewer")}return _createClass(i,[{key:"on",value:function(e,t){"endMeasure"==e&&(this.endMeasureFun=t),"startEdit"==e&&(this.startEditFun=t),"endEdit"==e&&(this.endEditFun=t)}},{key:"start",value:function(t){var i;if((t=t||{}).type&&(!this.nowMeasureObj||"endCreate"==this.nowMeasureObj.state||"endEdit"==this.nowMeasureObj.state||"no"==measureTool.nowMeasureObj.state)){switch(Number(t.type)){case 1:i=new MeasureSpaceDistance(this.viewer,t);break;case 2:i=new MeasureGroundDistance(this.viewer,t);break;case 3:i=new MeasureSpaceArea(this.viewer,t);break;case 4:i=new MeasureHeight(this.viewer,t);break;case 5:i=new MeasureTriangle(this.viewer,t);break;case 6:i=new MeasureLnglat(this.viewer,t);break;case 7:i=new MeasureAzimutht(this.viewer,t);break;case 8:i=new MeasureSection(this.viewer,t);break;case 9:i=new MeasureSlope(this.viewer,t);break;case 11:i=new MeasureSlopePolygon(this.viewer)}this.nowMeasureObj=i;var o=this;i&&(i.start(function(e){o.intoEdit&&(i.startEdit(),o.startEditFun&&o.startEditFun(i),o.lastMeasureObj=i),t.success&&t.success(i,e),o.endMeasureFun&&o.endMeasureFun(i,e)}),this.toolArr.push(i))}}},{key:"bindEdit",value:function(){var o=this;this.handler||(this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)),this.handler.setInputAction(function(e){if(o.canEdit){var t=o.viewer.scene.pick(e.position);if(Cesium.defined(t)&&t.id&&t.id.objId){for(var i=0;i<o.toolArr.length;i++)if(t.id.objId==o.toolArr[i].objId&&("endCreate"==o.toolArr[i].state||"endEdit"==o.toolArr[i].state)){o.lastMeasureObj&&(o.lastMeasureObj.endEdit(),o.endEditFun&&o.endEditFun(o.lastMeasureObj),o.lastMeasureObj=null),o.toolArr[i].startEdit(),o.nowEditObj=o.toolArr[i],o.startEditFun&&o.startEditFun(o.nowEditObj),o.lastMeasureObj=o.toolArr[i];break}}else o.lastMeasureObj&&(o.lastMeasureObj.endEdit(),o.endEditFun&&o.endEditFun(o.lastMeasureObj),o.lastMeasureObj=null)}},Cesium.ScreenSpaceEventType.LEFT_CLICK)}},{key:"endEdit",value:function(){this.lastMeasureObj&&(this.lastMeasureObj.endEdit(),this.endEditFun&&this.endEditFun(this.lastMeasureObj,this.lastMeasureObj.getEntity()),this.lastMeasureObj=null);for(var e=0;e<this.toolArr.length;e++)this.toolArr[e].endEdit()}},{key:"clear",value:function(){for(var e=0;e<this.toolArr.length;e++)this.toolArr[e]&&this.toolArr[e].destroy();this.toolArr=[],this.nowMeasureObj=null}},{key:"destroy",value:function(){this.clear(),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"setUnit",value:function(e){e&&this.nowMeasureObj.setUnit(e)}}]),i}(),LatlngNavigation=function(){function i(e,t){_classCallCheck(this,i),this.viewer=e,this.moveHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.initHtml(),this.bindMouseMoveHandler(),this.ellipsoid=this.viewer.scene.globe.ellipsoid}return _createClass(i,[{key:"bindMouseMoveHandler",value:function(){var n=this;this.moveHandler.setInputAction(function(e){var t,i,o,e=n.getCatesian3FromPX(e.endPosition);e&&(e=n.ellipsoid.cartesianToCartographic(e),t=Cesium.Math.toDegrees(e.latitude),i=Cesium.Math.toDegrees(e.longitude),e=e.height,o=n.getCameraView(),n.setHtml({lng:i,lat:t,height:e},o))},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"destroy",value:function(){this.moveHandler&&(this.moveHandler.destroy(),this.moveHandler=null);var e=document.getElementsByClassName("easy3d-lnglatNavigation"),t=this.viewer.container.id;document.getElementById(t).removeChild(e[0])}},{key:"initHtml",value:function(){var e=this.viewer.container.id,e=document.getElementById(e),t=document.createElement("div");t.className="easy3d-lnglatNavigation",t.innerHTML=" <ul>\n                            <li></li>   \n                            <li></li>\n                            <li></li>\n                            <li></li>\n                            <li></li>\n                            <li></li>\n                            <li></li>\n                        <ul>",e.appendChild(t)}},{key:"getCatesian3FromPX",value:function(e){for(var t,i=this.viewer.scene.drillPick(e),o=(this.viewer.scene.render(),!1),n=0;n<i.length;n++)if(i[n]&&i[n].primitive&&i[n].primitive instanceof Cesium.Cesium3DTileset){o=!0;break}if(o)t=this.viewer.scene.pickPosition(e);else{e=this.viewer.camera.getPickRay(e);if(!e)return null;t=this.viewer.scene.globe.pick(e,this.viewer.scene)}return t}},{key:"setHtml",value:function(e,t){var i=Number(e.lng).toFixed(6),o=Number(e.lat).toFixed(6),e=Number(e.height).toFixed(2),n=Number(t.heading).toFixed(2),s=Number(t.pitch).toFixed(2),r=Number(t.roll).toFixed(2),t=Number(t.z).toFixed(2),a=document.getElementsByClassName("easy3d-lnglatNavigation");!a||a.length<1||((a=a[0].children[0].children)[0].innerHTML="经度：".concat(i),a[1].innerHTML="纬度：".concat(o),a[2].innerHTML="高度：".concat(e),a[3].innerHTML="偏转角：".concat(n),a[4].innerHTML="仰俯角：".concat(s),a[5].innerHTML="翻滚角：".concat(r),a[6].innerHTML="相机高度：".concat(t))}},{key:"getCameraView",value:function(){var e=this.viewer.camera,t=e.position,i=e.heading,o=e.pitch,e=e.roll,t=Cesium.Cartographic.fromCartesian(t);return{x:Cesium.Math.toDegrees(t.longitude),y:Cesium.Math.toDegrees(t.latitude),z:t.height,heading:Cesium.Math.toDegrees(i),pitch:Cesium.Math.toDegrees(o),roll:Cesium.Math.toDegrees(e)}}}]),i}(),GaodeRoute=function(){function t(e){_classCallCheck(this,t),this._keys=(e=e||{}).key||["ae29a37307840c7ae4a785ac905927e0","888a52a74c55ca47abe6c55ab3661d11","0bc2903efcb3b67ebf1452d2f664a238","0df8f6f984adc49fca5b7b1108664da2","72f75689dff38a781055e68843474751"],this.GaodeRouteType={Walking:1,Bicycling:2,Driving:3},this._key_index=0}return _createClass(t,[{key:"keys",get:function(){return this._keys},set:function(e){this._keys=e}},{key:"key",get:function(){var e=this._key_index++%this._keys.length;return this._keys[e]}},{key:"query",value:function(e){var t={key:this.key,output:"json"},i=cUtil$1.wgs2gcj(e.points[0]),o=cUtil$1.wgs2gcj(e.points[e.points.length-1]);if(t.origin=i[0]+","+i[1],t.destination=o[0]+","+o[1],e.avoidareas){for(var n="",s=0;s<e.avoidareas.length;s++){var r=e.avoidareas[s];n+="".concat(r[0],",").concat(r[1],";")}t.avoidpolygons=n}switch(e.type){default:case this.GaodeRouteType.Walking:this.queryWalking(t,e);break;case this.GaodeRouteType.Bicycling:this.queryBicycling(t,e);break;case this.GaodeRouteType.Driving:this.queryDriving(t,e)}}},{key:"queryList",value:function(i){var e,o=this,n=-1,s={};for(e in i)"points"!=e&&"success"!=e&&"error"!=e&&(s[e]=i[e]);var r=i.points,a=[];!function t(){n++,s.points=r[n],s.success=function(e){e&&e.paths&&0<e.paths.length?a.push(e.paths[0]):a.push(null),n>=r.length-1?i.success&&i.success(a):t()},s.error=s.success,o.query(s)}()}},{key:"computeMindistanceLine",value:function(e){for(var t=Number.MAX_VALUE,i=null,o=-1,n=0;n<e.length;n++){var s=e[n];s&&s.allDistance<=t&&(o=n,t=(i=s).allDistance)}return{lineData:i,index:o}}},{key:"queryWalking",value:function(i,o){var n=this;axios.get("http://restapi.amap.com/v3/direction/walking",{params:i}).then(function(e){var t,e=e.data||{};"10000"!==e.infocode?(t="路径规划 请求失败("+e.infocode+")："+e.info,o.error&&o.error(t)):e.route&&e.route.paths?(e=n._formatRouteData(i.origin,i.destination,e.route.paths),o.success&&o.success(e)):(t="未查询到相关结果！",o.error&&o.error(t))}).catch(function(e){o.error&&o.error(e)})}},{key:"queryBicycling",value:function(i,o){var n=this;axios.get("https://restapi.amap.com/v4/direction/bicycling",{params:i}).then(function(e){var t,e=e.data||{};"10000"!==e.infocode?(t="路径规划 请求失败("+e.infocode+")："+e.info,o.error&&o.error(t)):e.route&&e.route.paths?(e=n._formatRouteData(i.origin,i.destination,e.route.paths),o.success&&o.success(e)):(t="未查询到相关结果！",o.error&&o.error(t))}).catch(function(e){o.error&&o.error(e)})}},{key:"queryDriving",value:function(i,o){i.extensions=o.extensions||"base",i.strategy=o.strategy||0;var n=this;axios("https://restapi.amap.com/v3/direction/driving",{params:i}).then(function(e){var t,e=e.data||{};"10000"!==e.infocode?(t="路径规划 请求失败("+e.infocode+")："+e.info,o.error&&o.error(t)):e.route&&e.route.paths&&0!=e.route.paths.length?(e=n._formatRouteData(i.origin,i.destination,e.route.paths),o.success&&o.success(e)):(t="未查询到相关结果！",o.error&&o.error(t))}).catch(function(e){o.error&&o.error(e)})}},{key:"_formatRouteData",value:function(e,t,i){var o,n,s=[];if(e&&(o=cUtil$1.gcj2wgs(e.split(","))),t&&(n=cUtil$1.gcj2wgs(t.split(","))),i&&0<i.length)for(var r=0;r<i.length;r++){for(var a=[],l=(a.push(o),i[r]),h=l.steps,c=[],u=[],d=0;d<h.length;d++){for(var p={instruction:h[d].instruction,distance:h[d].distance,duration:h[d].duration,points:[],route:h[d].road},m=h[d].polyline.split(";"),v=0;v<m.length;v++){var f=m[v],f=cUtil$1.gcj2wgs(f.split(","));a.push(f),p.points.push(f)}u.push(p.route),c.push(p)}a.push(n),s.push({allDistance:l.distance,allDuration:l.duration,steps:c,points:a,road:u})}return{origin:o,destination:n,paths:s}}}]),t}(),gadgets={GaodeRoute:GaodeRoute},Roam=function(){function i(e,t){_classCallCheck(this,i),console.log("漫游对象属性--》",t),this.viewer=e,this.objId=Number((new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0)),this.opt=t||{},this.startTime=t.startTime?Cesium.JulianDate.fromDate(t.startTime,new Cesium.JulianDate):this.viewer.clock.currentTime.clone(),this.endTime=null,this.opt.positions?(this.positions=this.transfromPositions(this.opt.positions),this.clockSpeed=1,this.stopTime=null,this.alldistance=0,this.alltimes=0,this.distanceED=-1,this.timesED=-1,this.speed=0,this.viewType="none",this.rendHandler=null,this.isLockView=!1,this.viewXYZ={x:0,y:0,z:0},this.endRoamCallback=t.endRoamCallback,this.roamingCallback=t.roamingCallback,this.init(),this.setViewType(t.viewType)):console.log("缺少漫游坐标")}return _createClass(i,[{key:"init",value:function(){var e={};if(this.opt.times)this.endTime=Cesium.JulianDate.addSeconds(this.startTime,this.opt.times,new Cesium.JulianDate),e=this.createPropertyByTimes(this.positions,this.opt.times);else{if(!this.opt.speed)return void console.log("缺少漫游时长或速度参数！");e=this.createPropertyBySpeed(this.positions,this.opt.speed)}this.alldistance=e.alldistance,this.alltimes=e.alltimes,this.speed=e.speed,this.roamEntity=this.createRoamEntity(this.opt.entityType,e.property)}},{key:"setPositions",value:function(e){this.destroy(),this.positions=e,this.init()}},{key:"start",value:function(){this.roamEntity&&(this.roamEntity.show=!0),this.clockSpeed=1,this.viewer.clock.currentTime=this.startTime,this.viewer.clock.multiplier=this.clockSpeed,this.viewer.clock.shouldAnimate=!0,this.viewer.clock.clockRange=Cesium.ClockRange.LOOP_STOP,this.computeCamera()}},{key:"end",value:function(){this.roamEntity&&(this.roamEntity.show=!1),this.viewer.clock.currentTime=this.endTime,this.viewer.clock.shouldAnimate=!1,this.distanceED=this.alldistance,this.timesED=this.alltimes,this.endRoamCallback&&this.endRoamCallback(this.opt)}},{key:"stop",value:function(){this.stopTime=this.viewer.clock.currentTime.clone(),this.viewer.clock.shouldAnimate=!1,this.roamingFun&&this.roamingFun()}},{key:"goon",value:function(){this.stopTime&&(this.viewer.clock.currentTime=this.stopTime.clone(),this.viewer.clock.shouldAnimate=!0,this.stopTime=null)}},{key:"setSpeed",value:function(e){this.clockSpeed=e,this.viewer.clock.multiplier=this.clockSpeed}},{key:"destroy",value:function(){this.roamEntity&&(this.viewer.entities.remove(this.roamEntity),this.roamEntity=null),this.rendHandler&&(this.rendHandler(),this.rendHandler=null),this.viewer.clock.multiplier=1,this.isLockView=!1,this.viewer.trackedEntity=void 0,this.viewer.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)}},{key:"createRoamEntity",value:function(e,t){var i=null;if("model"==e){if(!this.opt.entityAttr||!this.opt.entityAttr.uri)return void console.log("漫游缺少模型对象！");i=this.viewer.entities.add({orientation:new Cesium.VelocityOrientationProperty(t),position:t,model:this.opt.entityAttr})}else if("image"==e){if(!this.opt.entityAttr||!this.opt.entityAttr.image)return void console.log("漫游缺少图片对象！");i=this.viewer.entities.add({orientation:new Cesium.VelocityOrientationProperty(t),position:t,billboard:this.opt.entityAttr})}else i=this.viewer.entities.add({orientation:new Cesium.VelocityOrientationProperty(t),position:t,point:{pixelSize:.001,color:Cesium.Color.WHITE.withAlpha(1e-4)}});return i.show=!1,i}},{key:"transfromPositions",value:function(e){var t;if(e)return e[0]instanceof Cesium.Cartesian3?e:(t=[],e.forEach(function(e){e=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]||0);t.push(e)}),t)}},{key:"computeCamera",value:function(){var i=this,o=new Cesium.Matrix4,n=(this.distanceED=0,this.timeED=0,null);this.rendHandler||(this.rendHandler=this.viewer.scene.preRender.addEventListener(function(e){var t;i.viewer.clock.shouldAnimate&&i.roamEntity&&(t=i.viewer.clock.currentTime,Cesium.JulianDate.compare(i.endTime,t)<0?i.end():(i.roamingCallback&&i.roamingCallback(i.distanceED,i.timesED),i.isLockView&&(i.getModelMatrix(i.roamEntity,i.viewer.clock.currentTime,o),i.viewer.scene.camera.lookAtTransform(o,new Cesium.Cartesian3(-i.viewXYZ.x,i.viewXYZ.y,i.viewXYZ.z))),i.timeED=Cesium.JulianDate.secondsDifference(t,i.startTime),(t=i.roamEntity.position.getValue(t))&&n&&(i.distanceED+=Cesium.Cartesian3.distance(t,n)),n=t))}))}},{key:"getModelMatrix",value:function(e,t,i){if(e){var o=Cesium.Property.getValueOrUndefined(e.position,t,new Cesium.Cartesian3);if(Cesium.defined(o))return(e=Cesium.Property.getValueOrUndefined(e.orientation,t,new Cesium.Quaternion))?Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromQuaternion(e,new Cesium.Matrix3),o,i):Cesium.Transforms.eastNorthUpToFixedFrame(o,void 0,i)}}},{key:"createPropertyByTimes",value:function(e,t){if(e&&!(e.length<2)){for(var i=new Cesium.SampledPositionProperty,o=0,n=1;n<e.length;n++){var s=e[n-1],r=e[n];o+=Cesium.Cartesian3.distance(s,r)}for(var a=o/t,l=0,h=0;h<e.length;h++){var c,u=e[h],d=void 0;d=0==h?this.startTime.clone():(c=e[h-1],c=(l+=Cesium.Cartesian3.distance(u,c))/a,Cesium.JulianDate.addSeconds(this.startTime.clone(),c,new Cesium.JulianDate)),i.addSample(d.clone(),u.clone())}return{property:i,alldistance:o,alltimes:t,speed:a}}}},{key:"createPropertyBySpeed",value:function(e,t){if(e&&!(e.length<2)){for(var i=new Cesium.SampledPositionProperty,o=0,n=1;n<e.length;n++){var s=e[n-1],r=e[n];o+=Cesium.Cartesian3.distance(s,r)}for(var a=0,l=0;l<e.length;l++){var h,c=e[l],u=void 0;u=0==l?this.startTime.clone():(h=e[l-1],h=(a+=Cesium.Cartesian3.distance(c,h))/t,Cesium.JulianDate.addSeconds(this.startTime.clone(),h,new Cesium.JulianDate)),i.addSample(u.clone(),c.clone())}return{property:i,alldistance:o,alltimes:o/t,speed:t}}}},{key:"setViewType",value:function(e){switch(this.viewType=e,this.viewType){case"dy":this.isLockView=!0,this.viewXYZ={x:100,y:0,z:10};break;case"sd":this.isLockView=!0,this.viewXYZ={x:0,y:0,z:5e3};break;case"gs":this.isLockView=!1,this.viewer.trackedEntity=void 0;break;default:this.isLockView=!1,this.viewer.trackedEntity=void 0,this.viewer.scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)}}},{key:"setTrackView",value:function(e){this.isLockView=!0,this.viewXYZ=e}},{key:"getAttr",value:function(){var e=_defineProperty({viewType:this.viewType,alldistance:this.alldistance,alltimes:this.alltimes,distanceED:this.distanceED,times:this.distanceED},"viewType",this.viewType);return Object.assign(this.opt,e)}}]),i}(),RoamTool=function(){function i(e,t){_classCallCheck(this,i),this.viewer=e,this.opt=t||{},this.startRoamFun=null,this.endRoamFun=null,this.roamingFun=null,this.stopRoamFun=null,this.goonRoamFun=null,this.endCreateFun=null,this.roamList=[],this.nowStartRoam=null}return _createClass(i,[{key:"on",value:function(e,t){"startRoam"==e&&(this.startRoamFun=t),"endRoam"==e&&(this.endRoamFun=t),"roaming"==e&&(this.roamingFun=t),"stopRoam"==e&&(this.stopRoamFun=t),"goonRoam"==e&&(this.goonRoamFun=t),"endCreate"==e&&(this.endCreateFun=t)}},{key:"create",value:function(e,t){var i,o=e=e||{},n=o.roamType,s=this.transfromPositions(o.positions),r=null,a={times:e.times,speed:e.speed,endRoamCallback:this.endRoamFun,roamingCallback:this.roamingFun,viewType:e.viewType},l=(e.times||e.speed||(a.times=60),a=Object.assign(e,a),this);switch(n){case 1:e.height?(i=this.updatePositionsHeight(s,e.height),a.positions=i,(r=new Roam(this.viewer,a)).attr=a,this.roamList.push(r),t&&t(r)):console.log("飞行漫游缺少高度！");break;case 2:this.getTerrainPositions(s,function(e){a.positions=e,(r=new Roam(l.viewer,a)).attr=a,l.roamList.push(r),t&&t(r)});break;case 3:break;default:a.positions=s,(r=new Roam(this.viewer,a)).attr=a,this.roamList.push(r),t&&t(r)}}},{key:"transfromPositions",value:function(e){var t,i;if(e)return e[0]instanceof Cesium.Cartesian3?e:e[0].x&&e[0].y&&e[0].z?(t=[],e.forEach(function(e){t.push(new Cesium.Cartesian3(e.x,e.y,e.z))}),t):(i=[],e.forEach(function(e){e=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]||0);i.push(e)}),i)}},{key:"updatePositionsHeight",value:function(e,t){var i;if(e&&!(e.length<2))return i=[],e.forEach(function(e){e=Cesium.Cartographic.fromCartesian(e.clone()),e.height=t,e=Cesium.Cartographic.toCartesian(e);i.push(e)}),i}},{key:"getTerrainPositions",value:function(e,t){if(e&&!(e.length<2)){for(var i=[],o=0;o<e.length;o++){var n=e[o],n=Cesium.Cartographic.fromCartesian(n);i.push(n)}Cesium.when(Cesium.sampleTerrainMostDetailed(this.viewer.terrainProvider,i),function(e){e=ellipsoid.cartographicArrayToCartesianArray(e);t&&t(e)})}}},{key:"getRoamByField",value:function(e,t){if(!e)return[];for(var i=[],o=0;o<this.roamList.length;o++){var n=this.roamList[o];n.attr[e]==t&&i.push({roam:n,index:o})}return i}},{key:"removeRoamById",value:function(e){if(e)for(var t=this.roamList.length-1;0<=t;t--){var i=this.roamList[t];if(i.objId==e){i.destroy(),this.roamList.splice(t,1);break}}}},{key:"removeRoam",value:function(e){e&&(e=e.objId,this.removeRoamById(e))}},{key:"startRoam",value:function(e){this.endRoam();for(var t=e.objId,i=this.roamList.length-1;0<=i;i--){var o=this.roamList[i];if(o.objId==t){o.start(),this.nowStartRoam=o,this.startRoamFun&&this.startRoamFun(o);break}}}},{key:"endRoam",value:function(){this.nowStartRoam&&(this.nowStartRoam.end(),this.nowStartRoam=null)}},{key:"getNowroamAttr",value:function(){return this.nowStartRoam?Object.assign(this.nowStartRoam.attr,this.nowStartRoam.getAttr()):{}}},{key:"destroy",value:function(){for(var e=this.roamList.length-1;0<=e;e--)this.roamList[e].destroy();this.roamList=[]}},{key:"toJson",value:function(){for(var e=[],t=this.roamList.length-1;0<=t;t--){var i=this.roamList[t];e.push(i.getAttr())}return e}}]),i}(),ZoomTool=function(){function i(e,t){_classCallCheck(this,i),this.viewer=e,this.opt=t||{},this.step=this.opt.step||.5,this.forwardAmount=null,this.backwardAmount=null,this.position=null}return _createClass(i,[{key:"forward",value:function(){var e;this.backwardAmount?(e=this.backwardAmount,this.backwardAmount=null):(e=this.computeLength()||1e4,e*=this.step),this.viewer.camera.moveForward(e),this.forwardAmount=e}},{key:"backward",value:function(){var e;this.forwardAmount?(e=this.forwardAmount,this.forwardAmount=null):(e=this.computeLength()||1e4,e*=this.step),this.viewer.camera.moveBackward(e),this.backwardAmount=e}},{key:"computeLength",value:function(){this.position=this.viewer.camera.position;var e=Cesium.Cartographic.fromCartesian(this.position).height,t=this.viewer.camera.direction,t=Cesium.Cartesian3.normalize(t,new Cesium.Cartesian3),i=new Cesium.Cartesian3(0,0,-1),t=Cesium.Cartesian3.dot(t,i),i=Math.asin(t);return e/Math.cos(i)}}]),i}(),OverviewMap=function(){function i(e,t){_classCallCheck(this,i),this.viewer=e,this.opt=t||{};this.style=Object.assign({height:150,width:200,bottom:30,right:60},this.opt.style),this.rectangle=null,this.init()}return _createClass(i,[{key:"init",value:function(){this.mapEle=window.document.createElement("div"),this.mapEle.setAttribute("id","map2d"),this.mapEle.style.height=this.style.height+"px",this.mapEle.style.width=this.style.width+"px",this.mapEle.style.position="absolute",this.mapEle.style.bottom=this.style.bottom+"px",this.mapEle.style.right=this.style.right+"px",document.body.appendChild(this.mapEle),this.showStyle={color:"#ff7800",weight:1,fill:!0,stroke:!0,opacity:1},this.hideStyle={fill:!1,opacity:0};var e=L.map("map2d",{minZoom:3,maxZoom:17,center:[31.827107,117.240601],zoom:4,zoomControl:!1,attributionControl:!1});L.tileLayer("http://a.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(e),this.map=e,this.viewer.camera.percentageChanged=.01,this.viewer.camera.changed.addEventListener(this.sceneRenderHandler,this),this.sceneRenderHandler()}},{key:"sceneRenderHandler",value:function(){var e=this.viewer.camera.computeViewRectangle(),t={},e=(e?(t.ymin=Cesium.Math.toDegrees(e.south),t.ymax=Cesium.Math.toDegrees(e.north),t.xmin=Cesium.Math.toDegrees(e.west),t.xmax=Cesium.Math.toDegrees(e.east)):(t.ymin=-90,t.ymax=90,t.xmin=-180,t.xmin=180),L.latLng(t.ymin,t.xmin)),i=L.latLng(t.ymax,t.xmax),e=L.latLngBounds(e,i);this.rectangle?this.rectangle.setBounds(e):this.rectangle=L.rectangle(e,this.showStyle).addTo(this.map),-180==t.xmin&&180==t.xmax&&90==t.ymax&&-90==t.ymin?(this.map.setView([0,0],0),this.rectangle.setStyle(this.hideStyle)):(i=e.pad(.5),this.map.fitBounds(i),this.rectangle.setStyle(this.showStyle))}},{key:"hide",value:function(){this.mapEle&&(this.mapEle.style.display="none")}},{key:"show",value:function(){this.map&&this.mapEle&&(this.mapEle.style.display="block")}},{key:"setStyle",value:function(e){e&&(this.showStyle=e)}},{key:"destroy",value:function(){this.mapEle&&document.body.removeChild(this.mapEle),this.viewer.camera.changed.removeEventListener(this.sceneRenderHandler,this)}}]),i}(),htmlTagRegex=/<html(.|\s)*>(.|\s)*<\/html>/im,md=new MarkdownIt({html:!0,linkify:!0}),KnockoutMarkdownBinding=(md.use(MarkdownItSanitizer,{imageClass:"",removeUnbalanced:!1,removeUnknown:!1}),{register:function(s){s.bindingHandlers.markdown={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){for(;e.firstChild;)s.removeNode(e.firstChild);var t=s.unwrap(t()),t=htmlTagRegex.test(t)?t:md.render(t),i=s.utils.parseHtmlFragment(t,e);e.className=e.className+" markdown";for(var o=0;o<i.length;++o){var n=i[o];setAnchorTargets(n),e.appendChild(n)}}}}});function setAnchorTargets(e){if(e instanceof HTMLAnchorElement&&(e.target="_blank"),e.childNodes&&0<e.childNodes.length)for(var t=0;t<e.childNodes.length;++t)setAnchorTargets(e.childNodes[t])}var cesium=require("cesium/Cesium.js"),knockout=cesium.knockout,KnockoutHammerBinding={register:function(r){r.bindingHandlers.swipeLeft={init:function(e,t,i,o,n){var s=r.unwrap(t());new Hammer(e).on("swipeleft",function(e){var t=n.$data;s.apply(t,arguments)})}},r.bindingHandlers.swipeRight={init:function(e,t,i,o,n){var s=r.unwrap(t());new Hammer(e).on("swiperight",function(e){var t=n.$data;s.apply(t,arguments)})}}}},cesium$1=require("cesium/Cesium.js"),knockout$1=cesium$1.knockout,SvgPathBindingHandler=cesium$1.SvgPathBindingHandler,Knockout=knockout$1,registerKnockoutBindings=function(){SvgPathBindingHandler.register(Knockout),KnockoutMarkdownBinding.register(Knockout),KnockoutHammerBinding.register(Knockout),Knockout.bindingHandlers.embeddedComponent={init:function(e,t,i,o,n){return Knockout.unwrap(t()).show(e),{controlsDescendantBindings:!0}},update:function(e,t,i,o,n){}}},createFragmentFromTemplate=function(e){for(var t=document.createElement("div"),i=(t.innerHTML=e,document.createDocumentFragment());t.firstChild;)i.appendChild(t.firstChild);return i},cesium$2=require("cesium/Cesium.js"),knockout$2=cesium$2.knockout,getElement=cesium$2.getElement,Knockout$1=knockout$2,loadView=function(e,t,i){t=getElement(t);for(var o=createFragmentFromTemplate(e),n=[],s=0;s<o.childNodes.length;++s)n.push(o.childNodes[s]);for(t.appendChild(o),s=0;s<n.length;++s){var r=n[s];1!==r.nodeType&&8!==r.nodeType||Knockout$1.applyBindings(i,r)}return n},cesium$3=require("cesium/Cesium.js"),defined=cesium$3.defined,DeveloperError=cesium$3.DeveloperError,EllipsoidGeodesic=cesium$3.EllipsoidGeodesic,Cartesian2=cesium$3.Cartesian2,getTimestamp=cesium$3.getTimestamp,EventHelper=cesium$3.EventHelper,knockout$3=cesium$3.knockout,Knockout$2=knockout$3,DistanceLegendViewModel=function(e){if(!defined(e)||!defined(e.terria))throw new DeveloperError("options.terria is required.");this.terria=e.terria,this._removeSubscription=void 0,this._lastLegendUpdate=void 0,this.eventHelper=new EventHelper,this.distanceLabel=void 0,this.barWidth=void 0,this.enableDistanceLegend=!defined(e.enableDistanceLegend)||e.enableDistanceLegend,Knockout$2.track(this,["distanceLabel","barWidth"]),this.eventHelper.add(this.terria.afterWidgetChanged,function(){defined(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0)},this);var t=this;function i(){var e;defined(t.terria)&&(e=t.terria.scene,t._removeSubscription=e.postRender.addEventListener(function(){updateDistanceLegendCesium(this,e)},t))}i(),this.eventHelper.add(this.terria.afterWidgetChanged,function(){i()},this)},geodesic=(DistanceLegendViewModel.prototype.destroy=function(){this.eventHelper.removeAll()},DistanceLegendViewModel.prototype.show=function(e){var t=this.enableDistanceLegend?'<div class="distance-legend" id="easy3d-distance-legend" data-bind="visible: distanceLabel && barWidth"><div class="distance-legend-label" data-bind="text: distanceLabel"></div><div class="distance-legend-scale-bar" data-bind="style: { width: barWidth + \'px\', left: (5 + (125 - barWidth) / 2) + \'px\' }"></div></div>':'<div class="distance-legend" id="easy3d-distance-legend" style="display: none;" data-bind="visible: distanceLabel && barWidth"><div class="distance-legend-label"  data-bind="text: distanceLabel"></div><div class="distance-legend-scale-bar"  data-bind="style: { width: barWidth + \'px\', left: (5 + (125 - barWidth) / 2) + \'px\' }"></div></div>';loadView(t,e,this)},DistanceLegendViewModel.create=function(e){var t=new DistanceLegendViewModel(e);return t.show(e.container),t.setStyle(e.style),t},DistanceLegendViewModel.prototype.setStyle=function(e){if(e&&!(Object.keys(e).length<1)){var t=document.getElementById("easy3d-distance-legend");if(t)for(var i in e)t.style[i]=e[i]}},new EllipsoidGeodesic),distances=[1,2,3,5,10,20,30,50,100,200,300,500,1e3,2e3,3e3,5e3,1e4,2e4,3e4,5e4,1e5,2e5,3e5,5e5,1e6,2e6,3e6,5e6,1e7,2e7,3e7,5e7];function updateDistanceLegendCesium(e,t){if(e.enableDistanceLegend){var i=getTimestamp();if(!(i<e._lastLegendUpdate+250)){e._lastLegendUpdate=i;var i=t.canvas.clientWidth,o=t.canvas.clientHeight,n=t.camera.getPickRay(new Cartesian2(i/2|0,o-1)),i=t.camera.getPickRay(new Cartesian2(1+i/2|0,o-1)),o=t.globe,n=o.pick(n,t),i=o.pick(i,t);if(defined(n)&&defined(i)){for(var s,t=o.ellipsoid.cartesianToCartographic(n),n=o.ellipsoid.cartesianToCartographic(i),r=(geodesic.setEndPoints(t,n),geodesic.surfaceDistance),a=distances.length-1;!defined(s)&&0<=a;--a)distances[a]/r<100&&(s=distances[a]);defined(s)?(o=1e3<=s?(s/1e3).toString()+" km":s.toString()+" m",e.barWidth=s/r|0,e.distanceLabel=o):(e.barWidth=void 0,e.distanceLabel=void 0)}else e.barWidth=void 0,e.distanceLabel=void 0}}else e.barWidth=void 0,e.distanceLabel=void 0}var svgReset="M 7.5,0 C 3.375,0 0,3.375 0,7.5 0,11.625 3.375,15 7.5,15 c 3.46875,0 6.375,-2.4375 7.21875,-5.625 l -1.96875,0 C 12,11.53125 9.9375,13.125 7.5,13.125 4.40625,13.125 1.875,10.59375 1.875,7.5 1.875,4.40625 4.40625,1.875 7.5,1.875 c 1.59375,0 2.90625,0.65625 3.9375,1.6875 l -3,3 6.5625,0 L 15,0 12.75,2.25 C 11.4375,0.84375 9.5625,0 7.5,0 z",cesium$4=require("cesium/Cesium.js"),defined$1=cesium$4.defined,DeveloperError$1=cesium$4.DeveloperError,knockout$4=cesium$4.knockout,Knockout$3=knockout$4,UserInterfaceControl=function(e){if(!defined$1(e))throw new DeveloperError$1("terria is required");this._terria=e,this.name="Unnamed Control",this.text=void 0,this.svgIcon=void 0,this.svgHeight=void 0,this.svgWidth=void 0,this.cssClass=void 0,this.isActive=!1,Knockout$3.track(this,["name","svgIcon","svgHeight","svgWidth","cssClass","isActive"])},NavigationControl=(Object.defineProperties(UserInterfaceControl.prototype,{terria:{get:function(){return this._terria}},hasText:{get:function(){return defined$1(this.text)&&"string"==typeof this.text}}}),UserInterfaceControl.prototype.activate=function(){throw new DeveloperError$1("activate must be implemented in the derived class.")},function(e){UserInterfaceControl.apply(this,arguments)}),cesium$5=(NavigationControl.prototype=Object.create(UserInterfaceControl.prototype),require("cesium/Cesium.js")),defined$2=cesium$5.defined,Camera=cesium$5.Camera,Rectangle=cesium$5.Rectangle,Cartographic=cesium$5.Cartographic,Math$1=cesium$5.Math,ResetViewNavigationControl=function(e){NavigationControl.apply(this,arguments),this.name="重置视图",this.navigationLocked=!1,this.svgIcon=svgReset,this.svgHeight=15,this.svgWidth=15,this.cssClass="navigation-control-icon-reset"},cesium$6=(ResetViewNavigationControl.prototype=Object.create(NavigationControl.prototype),ResetViewNavigationControl.prototype.setNavigationLocked=function(e){this.navigationLocked=e},ResetViewNavigationControl.prototype.resetView=function(){var e,t;this.navigationLocked||(e=this.terria.scene).screenSpaceCameraController.enableInputs&&(this.isActive=!0,e=e.camera,defined$2(this.terria.trackedEntity)?(t=this.terria.trackedEntity,this.terria.trackedEntity=void 0,this.terria.trackedEntity=t):this.terria.options.view?this.setCameraView(this.terria.options.view,this.terria):"function"==typeof e.flyHome?e.flyHome(1):e.flyTo({destination:Camera.DEFAULT_VIEW_RECTANGLE,duration:1}),this.isActive=!1)},ResetViewNavigationControl.prototype.activate=function(){this.resetView()},ResetViewNavigationControl.prototype.setCameraView=function(e,t){var i,t=t||window.viewer;e&&(i=e.destination||Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z),t.camera.flyTo({destination:i,orientation:{heading:Cesium.Math.toRadians(e.heading||0),pitch:Cesium.Math.toRadians(e.pitch||0),roll:Cesium.Math.toRadians(e.roll||0)},duration:void 0===e.duration?3:e.duration,complete:e.complete}))},require("cesium/Cesium.js")),defined$3=cesium$6.defined,Ray=cesium$6.Ray,Cartesian3=cesium$6.Cartesian3,Cartographic$1=cesium$6.Cartographic,ReferenceFrame=cesium$6.ReferenceFrame,SceneMode=cesium$6.SceneMode,Utils={},unprojectedScratch=new Cartographic$1,rayScratch=new Ray,cesium$7=(Utils.getCameraFocus=function(e,t,i){var o=e.scene,n=o.camera;if(o.mode!==SceneMode.MORPHING&&(defined$3(i)||(i=new Cartesian3),i=defined$3(e.trackedEntity)?e.trackedEntity.position.getValue(e.clock.currentTime,i):(rayScratch.origin=n.positionWC,rayScratch.direction=n.directionWC,o.globe.pick(rayScratch,o,i)),defined$3(i)))return o.mode===SceneMode.SCENE2D||o.mode===SceneMode.COLUMBUS_VIEW?(i=n.worldToCameraCoordinatesPoint(i,i),t&&(i=o.globe.ellipsoid.cartographicToCartesian(o.mapProjection.unproject(i,unprojectedScratch),i))):t||(i=n.worldToCameraCoordinatesPoint(i,i)),i},require("cesium/Cesium.js")),defined$4=cesium$7.defined,Ray$1=cesium$7.Ray,IntersectionTests=cesium$7.IntersectionTests,Cartesian3$1=cesium$7.Cartesian3,SceneMode$1=cesium$7.SceneMode,ZoomNavigationControl=function(e,t){NavigationControl.apply(this,arguments),this.name="视图 "+(t?"放大":"缩小"),this.text=t?"+":"-",this.cssClass="navigation-control-icon-zoom-"+(t?"in":"out"),this.relativeAmount=2,t&&(this.relativeAmount=1/this.relativeAmount)},cartesian3Scratch=(ZoomNavigationControl.prototype.relativeAmount=1,ZoomNavigationControl.prototype=Object.create(NavigationControl.prototype),ZoomNavigationControl.prototype.activate=function(){this.zoom(this.relativeAmount)},new Cartesian3$1),svgCompassOuterRing=(ZoomNavigationControl.prototype.zoom=function(e){if(this.isActive=!0,defined$4(this.terria)){var t=this.terria.scene,i=t.screenSpaceCameraController;if(!i.enableInputs||!i.enableZoom)return;var o=t.camera;switch(t.mode){case SceneMode$1.MORPHING:break;case SceneMode$1.SCENE2D:o.zoomIn(o.positionCartographic.height*(1-this.relativeAmount));break;default:n=defined$4(this.terria.trackedEntity)?new Cartesian3$1:Utils.getCameraFocus(this.terria,!1),s=defined$4(n)?{direction:o.direction,up:o.up}:(s=new Ray$1(o.worldToCameraCoordinatesPoint(t.globe.ellipsoid.cartographicToCartesian(o.positionCartographic)),o.directionWC),n=IntersectionTests.grazingAltitudeLocation(s,t.globe.ellipsoid),{heading:o.heading,pitch:o.pitch,roll:o.roll});var n,s,r=Cartesian3$1.subtract(o.position,n,cartesian3Scratch),r=Cartesian3$1.multiplyByScalar(r,e,r),r=Cartesian3$1.add(n,r,n);defined$4(this.terria.trackedEntity)||t.mode===SceneMode$1.COLUMBUS_VIEW?o.position=r:o.flyTo({destination:r,orientation:s,duration:.5,convert:!1})}}this.isActive=!1},"m 66.5625,0 0,15.15625 3.71875,0 0,-10.40625 5.5,10.40625 4.375,0 0,-15.15625 -3.71875,0 0,10.40625 L 70.9375,0 66.5625,0 z M 72.5,20.21875 c -28.867432,0 -52.28125,23.407738 -52.28125,52.28125 0,28.87351 23.413818,52.3125 52.28125,52.3125 28.86743,0 52.28125,-23.43899 52.28125,-52.3125 0,-28.873512 -23.41382,-52.28125 -52.28125,-52.28125 z m 0,1.75 c 13.842515,0 26.368948,5.558092 35.5,14.5625 l -11.03125,11 0.625,0.625 11.03125,-11 c 8.9199,9.108762 14.4375,21.579143 14.4375,35.34375 0,13.764606 -5.5176,26.22729 -14.4375,35.34375 l -11.03125,-11 -0.625,0.625 11.03125,11 c -9.130866,9.01087 -21.658601,14.59375 -35.5,14.59375 -13.801622,0 -26.321058,-5.53481 -35.4375,-14.5 l 11.125,-11.09375 c 6.277989,6.12179 14.857796,9.90625 24.3125,9.90625 19.241896,0 34.875,-15.629154 34.875,-34.875 0,-19.245847 -15.633104,-34.84375 -34.875,-34.84375 -9.454704,0 -18.034511,3.760884 -24.3125,9.875 L 37.0625,36.4375 C 46.179178,27.478444 58.696991,21.96875 72.5,21.96875 z m -0.875,0.84375 0,13.9375 1.75,0 0,-13.9375 -1.75,0 z M 36.46875,37.0625 47.5625,48.15625 C 41.429794,54.436565 37.65625,63.027539 37.65625,72.5 c 0,9.472461 3.773544,18.055746 9.90625,24.34375 L 36.46875,107.9375 c -8.96721,-9.1247 -14.5,-21.624886 -14.5,-35.4375 0,-13.812615 5.53279,-26.320526 14.5,-35.4375 z M 72.5,39.40625 c 18.297686,0 33.125,14.791695 33.125,33.09375 0,18.302054 -14.827314,33.125 -33.125,33.125 -18.297687,0 -33.09375,-14.822946 -33.09375,-33.125 0,-18.302056 14.796063,-33.09375 33.09375,-33.09375 z M 22.84375,71.625 l 0,1.75 13.96875,0 0,-1.75 -13.96875,0 z m 85.5625,0 0,1.75 14,0 0,-1.75 -14,0 z M 71.75,108.25 l 0,13.9375 1.71875,0 0,-13.9375 -1.71875,0 z"),svgCompassGyro="m 72.71875,54.375 c -0.476702,0 -0.908208,0.245402 -1.21875,0.5625 -0.310542,0.317098 -0.551189,0.701933 -0.78125,1.1875 -0.172018,0.363062 -0.319101,0.791709 -0.46875,1.25 -6.91615,1.075544 -12.313231,6.656514 -13,13.625 -0.327516,0.117495 -0.661877,0.244642 -0.9375,0.375 -0.485434,0.22959 -0.901634,0.471239 -1.21875,0.78125 -0.317116,0.310011 -0.5625,0.742111 -0.5625,1.21875 l 0.03125,0 c 0,0.476639 0.245384,0.877489 0.5625,1.1875 0.317116,0.310011 0.702066,0.58291 1.1875,0.8125 0.35554,0.168155 0.771616,0.32165 1.21875,0.46875 1.370803,6.10004 6.420817,10.834127 12.71875,11.8125 0.146999,0.447079 0.30025,0.863113 0.46875,1.21875 0.230061,0.485567 0.470708,0.870402 0.78125,1.1875 0.310542,0.317098 0.742048,0.5625 1.21875,0.5625 0.476702,0 0.876958,-0.245402 1.1875,-0.5625 0.310542,-0.317098 0.582439,-0.701933 0.8125,-1.1875 0.172018,-0.363062 0.319101,-0.791709 0.46875,-1.25 6.249045,-1.017063 11.256351,-5.7184 12.625,-11.78125 0.447134,-0.1471 0.86321,-0.300595 1.21875,-0.46875 0.485434,-0.22959 0.901633,-0.502489 1.21875,-0.8125 0.317117,-0.310011 0.5625,-0.710861 0.5625,-1.1875 l -0.03125,0 c 0,-0.476639 -0.245383,-0.908739 -0.5625,-1.21875 C 89.901633,71.846239 89.516684,71.60459 89.03125,71.375 88.755626,71.244642 88.456123,71.117495 88.125,71 87.439949,64.078341 82.072807,58.503735 75.21875,57.375 c -0.15044,-0.461669 -0.326927,-0.884711 -0.5,-1.25 -0.230061,-0.485567 -0.501958,-0.870402 -0.8125,-1.1875 -0.310542,-0.317098 -0.710798,-0.5625 -1.1875,-0.5625 z m -0.0625,1.40625 c 0.03595,-0.01283 0.05968,0 0.0625,0 0.0056,0 0.04321,-0.02233 0.1875,0.125 0.144288,0.147334 0.34336,0.447188 0.53125,0.84375 0.06385,0.134761 0.123901,0.309578 0.1875,0.46875 -0.320353,-0.01957 -0.643524,-0.0625 -0.96875,-0.0625 -0.289073,0 -0.558569,0.04702 -0.84375,0.0625 C 71.8761,57.059578 71.936151,56.884761 72,56.75 c 0.18789,-0.396562 0.355712,-0.696416 0.5,-0.84375 0.07214,-0.07367 0.120304,-0.112167 0.15625,-0.125 z m 0,2.40625 c 0.448007,0 0.906196,0.05436 1.34375,0.09375 0.177011,0.592256 0.347655,1.271044 0.5,2.03125 0.475097,2.370753 0.807525,5.463852 0.9375,8.9375 -0.906869,-0.02852 -1.834463,-0.0625 -2.78125,-0.0625 -0.92298,0 -1.802327,0.03537 -2.6875,0.0625 0.138529,-3.473648 0.493653,-6.566747 0.96875,-8.9375 0.154684,-0.771878 0.320019,-1.463985 0.5,-2.0625 0.405568,-0.03377 0.804291,-0.0625 1.21875,-0.0625 z m -2.71875,0.28125 c -0.129732,0.498888 -0.259782,0.987558 -0.375,1.5625 -0.498513,2.487595 -0.838088,5.693299 -0.96875,9.25 -3.21363,0.15162 -6.119596,0.480068 -8.40625,0.9375 -0.682394,0.136509 -1.275579,0.279657 -1.84375,0.4375 0.799068,-6.135482 5.504716,-11.036454 11.59375,-12.1875 z M 75.5,58.5 c 6.043169,1.18408 10.705093,6.052712 11.5,12.15625 -0.569435,-0.155806 -1.200273,-0.302525 -1.875,-0.4375 -2.262525,-0.452605 -5.108535,-0.783809 -8.28125,-0.9375 -0.130662,-3.556701 -0.470237,-6.762405 -0.96875,-9.25 C 75.761959,59.467174 75.626981,58.990925 75.5,58.5 z m -2.84375,12.09375 c 0.959338,0 1.895843,0.03282 2.8125,0.0625 C 75.48165,71.267751 75.5,71.871028 75.5,72.5 c 0,1.228616 -0.01449,2.438313 -0.0625,3.59375 -0.897358,0.0284 -1.811972,0.0625 -2.75,0.0625 -0.927373,0 -1.831062,-0.03473 -2.71875,-0.0625 -0.05109,-1.155437 -0.0625,-2.365134 -0.0625,-3.59375 0,-0.628972 0.01741,-1.232249 0.03125,-1.84375 0.895269,-0.02827 1.783025,-0.0625 2.71875,-0.0625 z M 68.5625,70.6875 c -0.01243,0.60601 -0.03125,1.189946 -0.03125,1.8125 0,1.22431 0.01541,2.407837 0.0625,3.5625 -3.125243,-0.150329 -5.92077,-0.471558 -8.09375,-0.90625 -0.784983,-0.157031 -1.511491,-0.316471 -2.125,-0.5 -0.107878,-0.704096 -0.1875,-1.422089 -0.1875,-2.15625 0,-0.115714 0.02849,-0.228688 0.03125,-0.34375 0.643106,-0.20284 1.389577,-0.390377 2.25,-0.5625 2.166953,-0.433487 4.97905,-0.75541 8.09375,-0.90625 z m 8.3125,0.03125 c 3.075121,0.15271 5.824455,0.446046 7.96875,0.875 0.857478,0.171534 1.630962,0.360416 2.28125,0.5625 0.0027,0.114659 0,0.228443 0,0.34375 0,0.735827 -0.07914,1.450633 -0.1875,2.15625 -0.598568,0.180148 -1.29077,0.34562 -2.0625,0.5 -2.158064,0.431708 -4.932088,0.754666 -8.03125,0.90625 0.04709,-1.154663 0.0625,-2.33819 0.0625,-3.5625 0,-0.611824 -0.01924,-1.185379 -0.03125,-1.78125 z M 57.15625,72.5625 c 0.0023,0.572772 0.06082,1.131112 0.125,1.6875 -0.125327,-0.05123 -0.266577,-0.10497 -0.375,-0.15625 -0.396499,-0.187528 -0.665288,-0.387337 -0.8125,-0.53125 -0.147212,-0.143913 -0.15625,-0.182756 -0.15625,-0.1875 0,-0.0047 -0.02221,-0.07484 0.125,-0.21875 0.147212,-0.143913 0.447251,-0.312472 0.84375,-0.5 0.07123,-0.03369 0.171867,-0.06006 0.25,-0.09375 z m 31.03125,0 c 0.08201,0.03503 0.175941,0.05872 0.25,0.09375 0.396499,0.187528 0.665288,0.356087 0.8125,0.5 0.14725,0.14391 0.15625,0.21405 0.15625,0.21875 0,0.0047 -0.009,0.04359 -0.15625,0.1875 -0.147212,0.143913 -0.416001,0.343722 -0.8125,0.53125 -0.09755,0.04613 -0.233314,0.07889 -0.34375,0.125 0.06214,-0.546289 0.09144,-1.094215 0.09375,-1.65625 z m -29.5,3.625 c 0.479308,0.123125 0.983064,0.234089 1.53125,0.34375 2.301781,0.460458 5.229421,0.787224 8.46875,0.9375 0.167006,2.84339 0.46081,5.433176 0.875,7.5 0.115218,0.574942 0.245268,1.063612 0.375,1.5625 -5.463677,-1.028179 -9.833074,-5.091831 -11.25,-10.34375 z m 27.96875,0 C 85.247546,81.408945 80.919274,85.442932 75.5,86.5 c 0.126981,-0.490925 0.261959,-0.967174 0.375,-1.53125 0.41419,-2.066824 0.707994,-4.65661 0.875,-7.5 3.204493,-0.15162 6.088346,-0.480068 8.375,-0.9375 0.548186,-0.109661 1.051942,-0.220625 1.53125,-0.34375 z M 70.0625,77.53125 c 0.865391,0.02589 1.723666,0.03125 2.625,0.03125 0.912062,0 1.782843,-0.0048 2.65625,-0.03125 -0.165173,2.736408 -0.453252,5.207651 -0.84375,7.15625 -0.152345,0.760206 -0.322989,1.438994 -0.5,2.03125 -0.437447,0.03919 -0.895856,0.0625 -1.34375,0.0625 -0.414943,0 -0.812719,-0.02881 -1.21875,-0.0625 -0.177011,-0.592256 -0.347655,-1.271044 -0.5,-2.03125 -0.390498,-1.948599 -0.700644,-4.419842 -0.875,-7.15625 z m 1.75,10.28125 c 0.284911,0.01545 0.554954,0.03125 0.84375,0.03125 0.325029,0 0.648588,-0.01171 0.96875,-0.03125 -0.05999,0.148763 -0.127309,0.31046 -0.1875,0.4375 -0.18789,0.396562 -0.386962,0.696416 -0.53125,0.84375 -0.144288,0.147334 -0.181857,0.125 -0.1875,0.125 -0.0056,0 -0.07446,0.02233 -0.21875,-0.125 C 72.355712,88.946416 72.18789,88.646562 72,88.25 71.939809,88.12296 71.872486,87.961263 71.8125,87.8125 z",svgCompassRotationMarker="M 72.46875,22.03125 C 59.505873,22.050338 46.521615,27.004287 36.6875,36.875 L 47.84375,47.96875 C 61.521556,34.240041 83.442603,34.227389 97.125,47.90625 l 11.125,-11.125 C 98.401629,26.935424 85.431627,22.012162 72.46875,22.03125 z",cesium$8=require("cesium/Cesium.js"),defined$5=cesium$8.defined,Math$2=cesium$8.Math,getTimestamp$1=cesium$8.getTimestamp,EventHelper$1=cesium$8.EventHelper,Transforms=cesium$8.Transforms,SceneMode$2=cesium$8.SceneMode,Cartesian2$1=cesium$8.Cartesian2,Cartesian3$2=cesium$8.Cartesian3,Matrix4=cesium$8.Matrix4,BoundingSphere=cesium$8.BoundingSphere,HeadingPitchRange=cesium$8.HeadingPitchRange,knockout$5=cesium$8.knockout,Knockout$4=knockout$5,NavigationViewModel=function e(t){this.terria=t.terria,this.eventHelper=new EventHelper$1,this.enableZoomControls=!defined$5(t.enableZoomControls)||t.enableZoomControls,this.enableCompass=!defined$5(t.enableCompass)||t.enableCompass,this.navigationLocked=!1,this.controls=t.controls,defined$5(this.controls)||(this.controls=[new ZoomNavigationControl(this.terria,!0),new ResetViewNavigationControl(this.terria),new ZoomNavigationControl(this.terria,!1)]),this.svgCompassOuterRing=svgCompassOuterRing,this.svgCompassGyro=svgCompassGyro,this.svgCompassRotationMarker=svgCompassRotationMarker,this.showCompass=defined$5(this.terria)&&this.enableCompass,this.heading=this.showCompass?this.terria.scene.camera.heading:0,this.isOrbiting=!1,this.orbitCursorAngle=0,this.orbitCursorOpacity=0,this.orbitLastTimestamp=0,this.orbitFrame=void 0,this.orbitIsLook=!1,this.orbitMouseMoveFunction=void 0,this.orbitMouseUpFunction=void 0,this.isRotating=!1,this.rotateInitialCursorAngle=void 0,this.rotateFrame=void 0,this.rotateIsLook=!1,this.rotateMouseMoveFunction=void 0,this.rotateMouseUpFunction=void 0,this._unsubcribeFromPostRender=void 0,Knockout$4.track(this,["controls","showCompass","heading","isOrbiting","orbitCursorAngle","isRotating"]);var i=this;function o(){defined$5(i.terria)?(i._unsubcribeFromPostRender&&(i._unsubcribeFromPostRender(),i._unsubcribeFromPostRender=void 0),i.showCompass=i.enableCompass,i._unsubcribeFromPostRender=i.terria.scene.postRender.addEventListener(function(){i.heading=i.terria.scene.camera.heading})):(i._unsubcribeFromPostRender&&(i._unsubcribeFromPostRender(),i._unsubcribeFromPostRender=void 0),i.showCompass=!1)}e.prototype.setNavigationLocked=function(e){this.navigationLocked=e,this.controls&&1<this.controls.length&&this.controls[1].setNavigationLocked(this.navigationLocked)},this.eventHelper.add(this.terria.afterWidgetChanged,o,this),o()},vectorScratch=(NavigationViewModel.prototype.destroy=function(){this.eventHelper.removeAll()},NavigationViewModel.prototype.show=function(e){var t=null==this.enableCompass||this.enableCompass,i=null==this.enableZoomControls||this.enableZoomControls;loadView('<div class="compass" id="easy3d-compass" title="" style="display:'+(t?"block":"none")+'" data-bind="visible: showCompass, event: { mousedown: handleMouseDown, dblclick: handleDoubleClick }"><div class="compass-outer-ring-background"></div> <div class="compass-rotation-marker" data-bind="visible: isOrbiting, style: { transform: \'rotate(-\' + orbitCursorAngle + \'rad)\', \'-webkit-transform\': \'rotate(-\' + orbitCursorAngle + \'rad)\', opacity: orbitCursorOpacity }, cesiumSvgPath: { path: svgCompassRotationMarker, width: 145, height: 145 }"></div> <div class="compass-outer-ring" title="" data-bind="style: { transform: \'rotate(-\' + heading + \'rad)\', \'-webkit-transform\': \'rotate(-\' + heading + \'rad)\' }, cesiumSvgPath: { path: svgCompassOuterRing, width: 145, height: 145 }"></div> <div class="compass-gyro-background"></div> <div class="compass-gyro" data-bind="cesiumSvgPath: { path: svgCompassGyro, width: 145, height: 145 }, css: { \'compass-gyro-active\': isOrbiting }"></div></div><div class="navigation-controls" id="easy3d-navigation-controls" style="display:'+(i?"block":"none")+"\">\x3c!-- ko foreach: controls --\x3e<div data-bind=\"click: activate, attr: { title: $data.name }, css: $root.isLastControl($data) ? 'navigation-control-last' : 'navigation-control' \">   \x3c!-- ko if: $data.hasText --\x3e   <div data-bind=\"text: $data.text, css: $data.isActive ?  'navigation-control-icon-active ' + $data.cssClass : $data.cssClass\"></div>   \x3c!-- /ko --\x3e  \x3c!-- ko ifnot: $data.hasText --\x3e  <div data-bind=\"cesiumSvgPath: { path: $data.svgIcon, width: $data.svgWidth, height: $data.svgHeight }, css: $data.isActive ?  'navigation-control-icon-active ' + $data.cssClass : $data.cssClass\"></div>  \x3c!-- /ko --\x3e </div> \x3c!-- /ko --\x3e</div>",e,this)},NavigationViewModel.prototype.setStyle=function(e){if(e&&!(Object.keys(e).length<1)){var t=document.getElementById("easy3d-compass"),i=document.getElementById("easy3d-navigation-controls");if(t)for(var o in e)t.style[o]=e[o],i.style[o]=e[o],"top"==o&&(i.style[o]=parseFloat(e[o])+100+"px"),"bottom"==o&&(t.style[o]=parseFloat(e[o])+82+"px"),"left"==o&&(i.style.left=parseFloat(t.style.left)+30+"px"),"right"==o&&(i.style.right=parseFloat(t.style.right)-30+"px")}},NavigationViewModel.prototype.add=function(e){this.controls.push(e)},NavigationViewModel.prototype.remove=function(e){this.controls.remove(e)},NavigationViewModel.prototype.isLastControl=function(e){return e===this.controls[this.controls.length-1]},new Cartesian2$1),oldTransformScratch=(NavigationViewModel.prototype.handleMouseDown=function(e,t){if(this.terria.scene.mode===SceneMode$2.MORPHING)return!0;if(e.navigationLocked)return!0;var e=t.currentTarget,i=t.currentTarget.getBoundingClientRect(),o=i.width/2,n=new Cartesian2$1((i.right-i.left)/2,(i.bottom-i.top)/2),t=new Cartesian2$1(t.clientX-i.left,t.clientY-i.top),i=Cartesian2$1.subtract(t,n,vectorScratch),t=Cartesian2$1.magnitude(i)/o;if(t<50/145)orbit(this,e,i);else{if(!(t<1))return!0;rotate(this,e,i)}},new Matrix4),newTransformScratch=new Matrix4,centerScratch=new Cartesian3$2;function orbit(r,o,e){var a=r.terria.scene,t=a.screenSpaceCameraController;if(a.mode!==SceneMode$2.MORPHING&&t.enableInputs){if(r.navigationLocked)return!0;switch(a.mode){case SceneMode$2.COLUMBUS_VIEW:if(t.enableLook)break;if(t.enableTranslate&&t.enableTilt)break;return;case SceneMode$2.SCENE3D:if(t.enableLook)break;if(t.enableTilt&&t.enableRotate)break;return;case SceneMode$2.SCENE2D:if(t.enableTranslate)break;return}document.removeEventListener("mousemove",r.orbitMouseMoveFunction,!1),document.removeEventListener("mouseup",r.orbitMouseUpFunction,!1),defined$5(r.orbitTickFunction)&&r.terria.clock.onTick.removeEventListener(r.orbitTickFunction),r.orbitMouseMoveFunction=void 0,r.orbitMouseUpFunction=void 0,r.orbitTickFunction=void 0,r.isOrbiting=!0,r.orbitLastTimestamp=getTimestamp$1();var i,l=a.camera;defined$5(r.terria.trackedEntity)?(r.orbitFrame=void 0,r.orbitIsLook=!1):(i=Utils.getCameraFocus(r.terria,!0,centerScratch),defined$5(i)?(r.orbitFrame=Transforms.eastNorthUpToFixedFrame(i,a.globe.ellipsoid,newTransformScratch),r.orbitIsLook=!1):(r.orbitFrame=Transforms.eastNorthUpToFixedFrame(l.positionWC,a.globe.ellipsoid,newTransformScratch),r.orbitIsLook=!0)),r.orbitTickFunction=function(e){var t,i=getTimestamp$1(),o=(i-r.orbitLastTimestamp)*(2.5*(r.orbitCursorOpacity-.5)/1e3),n=r.orbitCursorAngle+Math$2.PI_OVER_TWO,s=Math$2.cos(n)*o,n=Math$2.sin(n)*o;if(r.navigationLocked)return!0;defined$5(r.orbitFrame)&&(t=Matrix4.clone(l.transform,oldTransformScratch),l.lookAtTransform(r.orbitFrame)),a.mode===SceneMode$2.SCENE2D?l.move(new Cartesian3$2(s,n,0),Math$2.max(a.canvas.clientWidth,a.canvas.clientHeight)/100*l.positionCartographic.height*o):r.orbitIsLook?(l.look(Cartesian3$2.UNIT_Z,-s),l.look(l.right,-n)):(l.rotateLeft(s),l.rotateUp(n)),defined$5(r.orbitFrame)&&l.lookAtTransform(t),r.orbitLastTimestamp=i},r.orbitMouseMoveFunction=function(e){var t=o.getBoundingClientRect(),i=new Cartesian2$1((t.right-t.left)/2,(t.bottom-t.top)/2),e=new Cartesian2$1(e.clientX-t.left,e.clientY-t.top);n(Cartesian2$1.subtract(e,i,vectorScratch),t.width)},r.orbitMouseUpFunction=function(e){r.isOrbiting=!1,document.removeEventListener("mousemove",r.orbitMouseMoveFunction,!1),document.removeEventListener("mouseup",r.orbitMouseUpFunction,!1),defined$5(r.orbitTickFunction)&&r.terria.clock.onTick.removeEventListener(r.orbitTickFunction),r.orbitMouseMoveFunction=void 0,r.orbitMouseUpFunction=void 0,r.orbitTickFunction=void 0},document.addEventListener("mousemove",r.orbitMouseMoveFunction,!1),document.addEventListener("mouseup",r.orbitMouseUpFunction,!1),r.terria.clock.onTick.addEventListener(r.orbitTickFunction),n(e,o.getBoundingClientRect().width)}function n(e,t){var i=Math$2.atan2(-e.y,e.x),i=(r.orbitCursorAngle=Math$2.zeroToTwoPi(i-Math$2.PI_OVER_TWO),Cartesian2$1.magnitude(e)),e=Math$2.min(i/(t/2),1);r.orbitCursorOpacity=.5*e*e+.5}}function rotate(n,s,e){var t,i=n.terria.scene,o=i.camera,r=i.screenSpaceCameraController;if(i.mode!==SceneMode$2.MORPHING&&i.mode!==SceneMode$2.SCENE2D&&r.enableInputs){if(n.navigationLocked)return!0;(r.enableLook||i.mode!==SceneMode$2.COLUMBUS_VIEW&&(i.mode!==SceneMode$2.SCENE3D||r.enableRotate))&&(document.removeEventListener("mousemove",n.rotateMouseMoveFunction,!1),document.removeEventListener("mouseup",n.rotateMouseUpFunction,!1),n.rotateMouseMoveFunction=void 0,n.rotateMouseUpFunction=void 0,n.isRotating=!0,n.rotateInitialCursorAngle=Math$2.atan2(-e.y,e.x),defined$5(n.terria.trackedEntity)?(n.rotateFrame=void 0,n.rotateIsLook=!1):(e=Utils.getCameraFocus(n.terria,!0,centerScratch),defined$5(e)&&(i.mode!==SceneMode$2.COLUMBUS_VIEW||r.enableLook||r.enableTranslate)?(n.rotateFrame=Transforms.eastNorthUpToFixedFrame(e,i.globe.ellipsoid,newTransformScratch),n.rotateIsLook=!1):(n.rotateFrame=Transforms.eastNorthUpToFixedFrame(o.positionWC,i.globe.ellipsoid,newTransformScratch),n.rotateIsLook=!0)),defined$5(n.rotateFrame)&&(t=Matrix4.clone(o.transform,oldTransformScratch),o.lookAtTransform(n.rotateFrame)),n.rotateInitialCameraAngle=-o.heading,defined$5(n.rotateFrame)&&o.lookAtTransform(t),n.rotateMouseMoveFunction=function(e){var t,i=s.getBoundingClientRect(),o=new Cartesian2$1((i.right-i.left)/2,(i.bottom-i.top)/2),e=new Cartesian2$1(e.clientX-i.left,e.clientY-i.top),i=Cartesian2$1.subtract(e,o,vectorScratch),e=Math$2.atan2(-i.y,i.x)-n.rotateInitialCursorAngle,o=Math$2.zeroToTwoPi(n.rotateInitialCameraAngle-e),i=n.terria.scene.camera,e=(defined$5(n.rotateFrame)&&(t=Matrix4.clone(i.transform,oldTransformScratch),i.lookAtTransform(n.rotateFrame)),-i.heading);i.rotateRight(o-e),defined$5(n.rotateFrame)&&i.lookAtTransform(t)},n.rotateMouseUpFunction=function(e){n.isRotating=!1,document.removeEventListener("mousemove",n.rotateMouseMoveFunction,!1),document.removeEventListener("mouseup",n.rotateMouseUpFunction,!1),n.rotateMouseMoveFunction=void 0,n.rotateMouseUpFunction=void 0},document.addEventListener("mousemove",n.rotateMouseMoveFunction,!1),document.addEventListener("mouseup",n.rotateMouseUpFunction,!1))}}NavigationViewModel.prototype.handleDoubleClick=function(e,t){var i=e.terria.scene,o=i.camera,n=i.screenSpaceCameraController;if(i.mode===SceneMode$2.MORPHING||!n.enableInputs)return!0;if(e.navigationLocked)return!0;if(i.mode!==SceneMode$2.COLUMBUS_VIEW||n.enableTranslate){if(i.mode===SceneMode$2.SCENE3D||i.mode===SceneMode$2.COLUMBUS_VIEW){if(!n.enableLook)return;if(i.mode===SceneMode$2.SCENE3D&&!n.enableRotate)return}var s,n=Utils.getCameraFocus(e.terria,!0,centerScratch);defined$5(n)?(e=i.globe.ellipsoid.cartographicToCartesian(o.positionCartographic,new Cartesian3$2),i=i.globe.ellipsoid.geodeticSurfaceNormal(n),s=new BoundingSphere(n,0),o.flyToBoundingSphere(s,{offset:new HeadingPitchRange(0,Math$2.PI_OVER_TWO-Cartesian3$2.angleBetween(i,o.directionWC),Cartesian3$2.distance(e,n)),duration:1.5})):this.controls[1].resetView()}},NavigationViewModel.create=function(e){var t=new NavigationViewModel(e);return t.show(e.container),t.setStyle(e.style),t};var cesium$9=require("cesium/Cesium.js"),defined$6=cesium$9.defined,Event=cesium$9.Event,knockout$6=cesium$9.knockout,DeveloperError$2=cesium$9.DeveloperError,CesiumEvent=Event,CesiumNavigation=function(e){initialize.apply(this,arguments),this._onDestroyListeners=[]};function initialize(e,t){if(!defined$6(e))throw new DeveloperError$2("CesiumWidget or Viewer is required.");var i=defined$6(e.cesiumWidget)?e.cesiumWidget:e,o=document.createElement("div");o.className="cesium-widget-cesiumNavigationContainer",i.container.appendChild(o),this.container=o,this.terria=e,this.terria.options=defined$6(t)?t:{},this.terria.afterWidgetChanged=new CesiumEvent,this.terria.beforeWidgetChanged=new CesiumEvent,this.distanceLegendDiv=document.createElement("div"),o.appendChild(this.distanceLegendDiv),this.distanceLegendDiv.setAttribute("id","distanceLegendDiv");i="string"==typeof(i=t.distanceLegend&&t.distanceLegend.style||"leftBottom")?getDistanceStyleByType(i):i;this.distanceLegendViewModel=DistanceLegendViewModel.create({container:this.distanceLegendDiv,style:i,terria:this.terria,enableDistanceLegend:null==this.terria.options.enableDistanceLegend||this.terria.options.enableDistanceLegend}),this.navigationDiv=document.createElement("div"),this.navigationDiv.setAttribute("id","navigationDiv"),o.appendChild(this.navigationDiv);e="string"==typeof(e=t.distanceLegend&&t.distanceLegend.style||"leftBottom")?getCompassStyleByType(e):e;this.navigationViewModel=NavigationViewModel.create({container:this.navigationDiv,terria:this.terria,style:e,enableZoomControls:null==this.terria.options.enableZoomControls||this.terria.options.enableZoomControls,enableCompass:null==this.terria.options.enableCompass||this.terria.options.enableCompass}),registerKnockoutBindings()}function getDistanceStyleByType(e){var t={};return(t="leftBottom"==(e=e||"leftBottom")?{left:"10px",bottom:"4px"}:"leftTop"==e?{left:"20px",top:"20px"}:"rightBottom"==e?{right:"20px",bottom:"4px"}:{right:"20px",top:"20px"}).zIndex=99999,t}function getCompassStyleByType(e){var t={};return(t="leftBottom"==(e=e||"rightTop")?{left:"20px",bottom:"60px"}:"leftTop"==e?{left:"20px",top:"20px"}:"rightBottom"==e?{right:"20px",bottom:"60px"}:{right:"20px",top:"20px"}).zIndex=99999,t}CesiumNavigation.prototype.distanceLegendViewModel=void 0,CesiumNavigation.prototype.navigationViewModel=void 0,CesiumNavigation.prototype.navigationDiv=void 0,CesiumNavigation.prototype.distanceLegendDiv=void 0,CesiumNavigation.prototype.terria=void 0,CesiumNavigation.prototype.container=void 0,CesiumNavigation.prototype._onDestroyListeners=void 0,CesiumNavigation.prototype._navigationLocked=!1,CesiumNavigation.prototype.setNavigationLocked=function(e){this._navigationLocked=e,this.navigationViewModel.setNavigationLocked(this._navigationLocked)},CesiumNavigation.prototype.getNavigationLocked=function(){return this._navigationLocked},CesiumNavigation.prototype.destroy=function(){defined$6(this.navigationViewModel)&&this.navigationViewModel.destroy(),defined$6(this.distanceLegendViewModel)&&this.distanceLegendViewModel.destroy(),defined$6(this.navigationDiv)&&this.navigationDiv.parentNode.removeChild(this.navigationDiv),delete this.navigationDiv,defined$6(this.distanceLegendDiv)&&this.distanceLegendDiv.parentNode.removeChild(this.distanceLegendDiv),delete this.distanceLegendDiv,defined$6(this.container)&&this.container.parentNode.removeChild(this.container),delete this.container;for(var e=0;e<this._onDestroyListeners.length;e++)this._onDestroyListeners[e]()},CesiumNavigation.prototype.addOnDestroyListener=function(e){"function"==typeof e&&this._onDestroyListeners.push(e)};var easy3dView={viewAround:{initView:null,removeEventHdl:null,startTime:null,isStop:!1,initHeading:null,start:function(e){viewer.clock.shouldAnimate=!0,this.isStop=!1,this.initView=e||cUtil.getCameraView(),this.initHeading=this.initView.heading,this.startTime=viewer.clock.currentTime;var t=this;this.removeEventHdl||(this.removeEventHdl=viewer.clock.onTick.addEventListener(function(){var e;t.isStop||(e=Cesium.JulianDate.secondsDifference(viewer.clock.currentTime,t.startTime),t.initView.heading=t.initHeading+e*t.angle,t.initView.duration=0,cUtil.setCameraView(t.initView))}))},end:function(){this.removeEventHdl&&(this.removeEventHdl(),this.removeEventHdl=null),this.initView=null,this.startTime=null,this.isStop=!1,this.initHeading=null,this.angle=5},stop:function(){this.isStop=!0},goon:function(){this.initView=cUtil.getCameraView(),this.startTime=viewer.clock.startTime,this.initHeading=this.initView.heading,this.isStop=!1},angle:5,setSpeed:function(e){this.angle=e}},viewPoint:{removeEventLis:null,initHeading:0,isStop:!1,position:null,startTime:null,start:function(t){viewer.clock.shouldAnimate=!0,t||(e=cUtil.getViewCenter(),t=Cesium.Cartesian3.fromDegrees(e[0],e[1])),this.position=t,this.startTime=viewer.clock.currentTime,this.isStop=!1;var e,i=this;this.removeEventLis||(this.removeEventLis=viewer.clock.onTick.addEventListener(function(){var e;i.isStop||(e=Cesium.JulianDate.secondsDifference(viewer.clock.currentTime,i.startTime),e=i.initHeading+e*i.angle,e=i.setHpr({heading:e}),viewer.camera.lookAt(t,e))}))},stop:function(){this.isStop=!0},goon:function(){this.startTime=viewer.clock.startTime,this.isStop=!1},end:function(){this.removeEventLis&&(this.removeEventLis(),this.removeEventLis=null),this.initHeading=0,this.isStop=!1,this.position=null,this.startTime=null,this.angle=5},angle:5,setSpeed:function(e){this.angle=e},setHpr:function(e){var t=Cesium.Math.toRadians(e.heading||0),i=Cesium.Math.toRadians(e.pitch||-60),e=e.range||5e3;return new Cesium.HeadingPitchRange(t,i,e)},setPosotion:function(e){this.position=e}},setRotate:function(e,t){var i,o,n,s,r,a,l;e.x&&e.y?(i=e.v||1,o=0,n=e.q||2,s=e.x,r=e.y,a=e.z,l=window.setInterval(function(){179<=(s+=i)&&(s=-180,o++),viewer.scene.camera.setView({destination:new Cesium.Cartesian3.fromDegrees(s,r,a||2e7)}),o==n&&(clearInterval(l),t())},16)):console.log("设定地球旋转时，并未传入经纬度！")}},LayerSplit=function(){function i(e,t){_classCallCheck(this,i),this.viewer=e,this.slider=null,this.handler=null,this.moveActive=!1,this.opt=t||{},this.layer=this.opt.layer,this.layer&&(this.layer.splitDirection=window.Cesium.ImagerySplitDirection.RIGHT),this.mapContainer=this.viewer.container,this.init()}return _createClass(i,[{key:"init",value:function(){var t=this;this.slider=window.document.createElement("div"),this.slider.setAttribute("id","layer-split"),this.slider.style.height="100%",this.slider.style.width="5px",this.slider.style.position="absolute",this.slider.style.left="50%",this.slider.style.top="0px",this.slider.style.background="rgba(255,255,255,0.5)",this.mapContainer.appendChild(this.slider),this.handler=new window.Cesium.ScreenSpaceEventHandler(this.slider),this.viewer.scene.imagerySplitPosition=.5,this.handler.setInputAction(function(){t.moveActive=!0},Cesium.ScreenSpaceEventType.LEFT_DOWN),this.handler.setInputAction(function(){t.moveActive=!0},Cesium.ScreenSpaceEventType.PINCH_START),this.handler.setInputAction(function(e){t.move(e)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){t.move(e)},Cesium.ScreenSpaceEventType.PINCH_MOVE),this.handler.setInputAction(function(){t.moveActive=!1},Cesium.ScreenSpaceEventType.LEFT_UP),this.handler.setInputAction(function(){t.moveActive=!1},Cesium.ScreenSpaceEventType.PINCH_END)}},{key:"move",value:function(e){this.moveActive&&(e=e.endPosition.x,e=(this.slider.offsetLeft+e)/this.slider.parentElement.offsetWidth,this.slider.style.left=100*e+"%",this.viewer.scene.imagerySplitPosition=e)}},{key:"destroy",value:function(){this.slider&&(this.mapContainer.removeChild(this.slider),this.slider=null),this.handler&&(this.handler.destroy(),this.handler=null),this.layer.splitDirection=window.Cesium.ImagerySplitDirection.NONE}},{key:"setLayer",value:function(e){e&&(this.layer.splitDirection=window.Cesium.ImagerySplitDirection.NONE,this.layer=e,this.layer.splitDirection=window.Cesium.ImagerySplitDirection.LEFT)}}]),i}(),fog={fogProcs:null,isActivate:!1,fogVal:.5,activate:function(){var e;this.isActivate||(this.isActivate=!0,e=this.initfog(),this.fogProcs=new Cesium.PostProcessStage({name:"czm_fog",fragmentShader:e}),viewer.scene.postProcessStages.add(this.fogProcs))},disable:function(){this.isActivate&&(this.isActivate=!1,this.fogProcs&&(viewer.scene.postProcessStages.remove(this.fogProcs),this.fogProcs.destroy(),this.fogProcs=null))},initfog:function(){return"  uniform sampler2D colorTexture;\n  uniform sampler2D depthTexture;\n  varying vec2 v_textureCoordinates;\n  void main(void)\n  {\n      vec4 origcolor=texture2D(colorTexture, v_textureCoordinates);\n      vec4 fogcolor=vec4(0.8,0.8,0.8,0.2);\n\n      vec4 depthcolor = texture2D(depthTexture, v_textureCoordinates);\n\n      float f=(depthcolor.r-0.22)/"+this.fogVal+";\n      if(f<0.0) f=0.0;\n      else if(f>1.0) f=1.0;\n      gl_FragColor = mix(origcolor,fogcolor,f);\n   }"}},rain={rainProcs:null,isActivate:!1,activate:function(){var e;this.isActivate||(this.isActivate=!0,e=this.initRain(),this.rainProcs=new Cesium.PostProcessStage({name:"czm_rain",fragmentShader:e}),viewer.scene.postProcessStages.add(this.rainProcs))},disable:function(){this.isActivate&&(this.isActivate=!1,this.rainProcs&&(viewer.scene.postProcessStages.remove(this.rainProcs),this.rainProcs=null))},initRain:function(){return"uniform sampler2D colorTexture;\n                varying vec2 v_textureCoordinates;\n                \n                float hash(float x){\n                    return fract(sin(x*23.3)*13.13);\n                }\n                \n                void main(void){\n                \n                    float time = czm_frameNumber / 60.0;\n                    vec2 resolution = czm_viewport.zw;\n                    \n                    vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n                    vec3 c=vec3(.6,.7,.8);\n                    \n                    float a=-.4;\n                    float si=sin(a),co=cos(a);\n                    uv*=mat2(co,-si,si,co);\n                    uv*=length(uv+vec2(0,4.9))*.3+1.;\n                    \n                    float v=1.-sin(hash(floor(uv.x*100.))*2.);\n                    float b=clamp(abs(sin(20.*time*v+uv.y*(5./(2.+v))))-.95,0.,1.)*20.;\n                    c*=v*b; \n                    \n                    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(c,1), 0.5);  \n                }\n        "}},snow={snowProcs:null,isActivate:!1,activate:function(){var e;this.isActivate||(this.isActivate=!0,e=this.initSnow(),this.snowProcs=new Cesium.PostProcessStage({name:"czm_snow",fragmentShader:e}),viewer.scene.postProcessStages.add(this.snowProcs))},disable:function(){this.isActivate&&(this.isActivate=!1,this.snowProcs&&(viewer.scene.postProcessStages.remove(this.snowProcs),this.snowProcs=null))},initSnow:function(){return"uniform sampler2D colorTexture;\n                varying vec2 v_textureCoordinates;\n                \n                float snow(vec2 uv,float scale)\n                {\n                float time = czm_frameNumber / 60.0;\n                float w=smoothstep(1.,0.,-uv.y*(scale/10.));if(w<.1)return 0.;\n                uv+=time/scale;uv.y+=time*2./scale;uv.x+=sin(uv.y+time*.5)/scale;\n                uv*=scale;vec2 s=floor(uv),f=fract(uv),p;float k=3.,d;\n                p=.5+.35*sin(11.*fract(sin((s+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);k=min(d,k);\n                k=smoothstep(0.,k,sin(f.x+f.y)*0.01);\n                return k*w;\n                }\n                \n                void main(void){\n                vec2 resolution = czm_viewport.zw;\n                vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n                vec3 finalColor=vec3(0);\n                float c = 0.0;\n                c+=snow(uv,30.)*.0;\n                c+=snow(uv,20.)*.0;\n                c+=snow(uv,15.)*.0;\n                c+=snow(uv,10.);\n                c+=snow(uv,8.);\n                c+=snow(uv,6.);\n                c+=snow(uv,5.);\n                finalColor=(vec3(c)); \n                gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(finalColor,1), 0.3); \n                \n                }\n            "}};function getPostStageFragmentShader(e,t){var i=e._usesDepthTexture,o=e._polygonOffsetSupported,n=e._isPointLight,s=e._isSpotLight,r=1<e._numberOfCascades,a=e.debugCascadeColors,l="",l=(n?l+="#define USE_CUBE_MAP_SHADOW\n":i&&(l+="#define USE_SHADOW_DEPTH_TEXTURE\n"),e.softShadows&&!n&&(l+="#define USE_SOFT_SHADOWS\n"),(l=(l+="uniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\n")+(n?"uniform samplerCube shadowMap_textureCube; \n":"uniform sampler2D shadowMap_texture; \n")+"uniform mat4 shadowMap_matrix; \nuniform vec3 shadowMap_lightDirectionEC; \nuniform vec4 shadowMap_lightPositionEC; \nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \nuniform vec4 viewShed_frontColor; \nuniform vec4 viewShed_backColor; \nuniform float viewShed_Fov; \nuniform float viewShed_Far;\n\nvarying vec2 v_textureCoordinates;\n\nstruct sg_shadowParameters\n{\n#ifdef USE_CUBE_MAP_SHADOW\n    vec3 texCoords;\n#else\n    vec2 texCoords;\n#endif\n\n    float depthBias;\n    float depth;\n    float nDotL;\n    vec2 texelStepSize;\n    float normalShadingSmooth;\n    float darkness;\n};\n#ifdef USE_CUBE_MAP_SHADOW\nfloat sg_sampleShadowMap(samplerCube shadowMap, vec3 d)\n{\n    return czm_unpackDepth(textureCube(shadowMap, d));\n}\nfloat sg_shadowDepthCompare(samplerCube shadowMap, vec3 uv, float depth)\n{\n    return step(depth, sg_sampleShadowMap(shadowMap, uv));\n}\nfloat sg_shadowVisibility(samplerCube shadowMap, sg_shadowParameters shadowParameters)\n{\n    float depthBias = shadowParameters.depthBias;\n    float depth = shadowParameters.depth;\n    float nDotL = shadowParameters.nDotL;\n    float normalShadingSmooth = shadowParameters.normalShadingSmooth;\n    float darkness = shadowParameters.darkness;\n    vec3 uvw = shadowParameters.texCoords;\n\n    depth -= depthBias;\n    float visibility = sg_shadowDepthCompare(shadowMap, uvw, depth);\n    return visibility;\n}\n#else\nfloat sg_sampleShadowMap(sampler2D shadowMap, vec2 uv)\n{\n#ifdef USE_SHADOW_DEPTH_TEXTURE\n    return texture2D(shadowMap, uv).r;\n#else\n    return czm_unpackDepth(texture2D(shadowMap, uv));\n#endif\n}\nfloat sg_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth)\n{\n    return step(depth, sg_sampleShadowMap(shadowMap, uv));\n}\nfloat sg_shadowVisibility(sampler2D shadowMap, sg_shadowParameters shadowParameters)\n{\n    float depthBias = shadowParameters.depthBias;\n    float depth = shadowParameters.depth;\n    float nDotL = shadowParameters.nDotL;\n    float normalShadingSmooth = shadowParameters.normalShadingSmooth;\n    float darkness = shadowParameters.darkness;\n    vec2 uv = shadowParameters.texCoords;\n\n    depth -= depthBias;\n#ifdef USE_SOFT_SHADOWS\n    vec2 texelStepSize = shadowParameters.texelStepSize;\n    float radius = 1.0;\n    float dx0 = -texelStepSize.x * radius;\n    float dy0 = -texelStepSize.y * radius;\n    float dx1 = texelStepSize.x * radius;\n    float dy1 = texelStepSize.y * radius;\n    float visibility = (\n        sg_shadowDepthCompare(shadowMap, uv, depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\n        sg_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\n    ) * (1.0 / 9.0);\n#else\n    float visibility = sg_shadowDepthCompare(shadowMap, uv, depth);\n#endif\n\n    return visibility;\n}\n#endif\nvec4 getPositionEC(float depth) \n{ \n    vec2 xy = vec2((v_textureCoordinates.x * 2.0 - 1.0), (v_textureCoordinates.y * 2.0 - 1.0));\n    float z = (depth - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\n    vec4 posInCamera = czm_inverseProjection * vec4(xy, z, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n} \nvec3 getNormalEC() \n{ \n    return vec3(1.0); \n} \n\n")+"void main() \n{ \n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    if(depth > 0.999999)\n    {\n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return;\n    }\n    vec4 positionEC = getPositionEC(depth); \n    vec3 normalEC = getNormalEC(); \n    float z = -positionEC.z; \n"+"    sg_shadowParameters shadowParameters; \n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \n");return t?l+="    shadowParameters.depthBias *= max(z * 0.01, 1.0); \n":o||(l+="    shadowParameters.depthBias *= mix(1.0, 100.0, z * 0.0015); \n"),l=l+(n?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    directionEC = normalize(directionEC); \n    float radius = shadowMap_lightPositionEC.w; \n    // Stop early if the fragment is beyond the point light radius \n    if (distance > radius) \n    { \n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return; \n    } \n    vec3 directionWC  = czm_inverseViewRotation * directionEC; \n    shadowParameters.depth = distance / radius; \n    shadowParameters.texCoords = directionWC; \n    float visibility = sg_shadowVisibility(shadowMap_textureCube, shadowParameters); \n":s?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    if(distance > viewShed_Far)\n    {\n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return;\n    }\n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Spot light uses a perspective projection, so perform the perspective divide \n    shadowPosition /= shadowPosition.w; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    float visibility = sg_shadowVisibility(shadowMap_texture, shadowParameters); \n":r?"    float maxDepth = shadowMap_cascadeSplits[1].w; \n    // Stop early if the eye depth exceeds the last cascade \n    if (z > maxDepth) \n    { \n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return; \n    } \n    // Get the cascade based on the eye-space z \n    vec4 weights = czm_cascadeWeights(z); \n    // Transform position into the cascade \n    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; \n    // Get visibility \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    float visibility = sg_shadowVisibility(shadowMap_texture, shadowParameters); \n    // Fade out shadows that are far away \n    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \n    float fade = max((z - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \n    visibility = mix(visibility, 1.0, fade); \n":"    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    float visibility = sg_shadowVisibility(shadowMap_texture, shadowParameters); \n")+("    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n"+(r&&a?"    color *= czm_cascadeColor(weights); \n":"")+"    if(visibility > 0.0) \n        gl_FragColor = vec4(color.rgb * (1.0 - viewShed_frontColor.a) + viewShed_frontColor.rgb * viewShed_frontColor.a, color.a); \n    else \n        gl_FragColor = vec4(color.rgb * (1.0 - viewShed_backColor.a) + viewShed_backColor.rgb * viewShed_backColor.a, color.a); \n} \n")}var VisualField=function(){function i(e,t){if(_classCallCheck(this,i),!Cesium.defined(e))throw new Cesium.DeveloperError("缺少地图对象！");this.options=t||{},this._scene=e.scene;e=t.cameraOptions||{};this._enabled=Cesium.defaultValue(t.enabled,!0),this._viewerPosition=Cesium.defaultValue(e.viewerPosition,new Cesium.Cartesian3.fromDegrees(0,0,0)),this._heading=Cesium.defaultValue(e.heading,0),this._pitch=Cesium.defaultValue(e.pitch,0),this._horizontalFov=Cesium.defaultValue(e.horizontalFov,179.9),this._verticalFov=Cesium.defaultValue(e.verticalFov,60),this._distance=Cesium.defaultValue(e.distance,100),this._visibleAreaColor=e.visibleAreaColor instanceof Cesium.Color?e.visibleAreaColor:Cesium.Color.fromCssColorString(e.visibleAreaColor),this._visibleAreaColorAlpha=null==e.visibleAreaColorAlpha?1:e.visibleAreaColorAlpha,this._hiddenAreaColor=e.hiddenAreaColor instanceof Cesium.Color?e.hiddenAreaColor:Cesium.Color.fromCssColorString(e.hiddenAreaColor),this._hiddenAreaColorAlpha=null==e.hiddenAreaColorAlpha?1:e.hiddenAreaColorAlpha,this._size=Cesium.defaultValue(t.size,2048),this._softShadows=Cesium.defaultValue(t.softShadows,!1),this._bugDistance=this._distance+1e-6*this._horizontalFov-1e-6*this._verticalFov,this._outlineColor=Cesium.defaultValue(t.outlineColor,Cesium.Color.YELLOW),this._lightCameraPrimitive=void 0,this._lightCamera=new Cesium.Camera(this._scene),this._lightCameraDirty=!1,this._stage=void 0,this._stageDirty=!0,this.updateCamera(),this._shadowMap=new Cesium.ShadowMap({context:this._scene.context,lightCamera:this._lightCamera,enabled:this._enabled,isPointLight:!1,pointLightRadius:100,cascadesEnabled:!1,size:this._size,softShadows:this._softShadows,normalOffset:!1,fromLightSource:!1}),this._bias=this._shadowMap._primitiveBias}return _createClass(i,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this._shadowMap.enabled=e}},{key:"softShadows",get:function(){return this._softShadows},set:function(e){this._softShadows=e,this._shadowMap.softShadows=e}},{key:"size",get:function(){return this._size},set:function(e){this.size=e,this._shadowMap.size=e}},{key:"visibleAreaColor",get:function(){return Cesium.Color.fromCartesian4(this._visibleAreaColor)},set:function(e){e=e instanceof Cesium.Color?e:Cesium.Color.fromCssColorString(e);this._visibleAreaColor=e,this._scene.requestRender()}},{key:"visibleAreaColorAlpha",get:function(){return this._visibleAreaColorAlpha},set:function(e){this._visibleAreaColorAlpha=Number(e),this._scene.requestRender()}},{key:"hiddenAreaColorAlpha",get:function(){return this._hiddenAreaColorAlpha},set:function(e){this._hiddenAreaColorAlpha=Number(e),this._scene.requestRender()}},{key:"hiddenAreaColor",get:function(){return Cesium.Color.fromCartesian4(this._hiddenAreaColor)},set:function(e){e=e instanceof Cesium.Color?e:Cesium.Color.fromCssColorString(e);this._hiddenAreaColor=e,this._scene.requestRender()}},{key:"viewerPosition",get:function(){return this._viewerPosition},set:function(e){this._viewerPosition=e,this._lightCameraDirty=!0,this._scene.requestRender()}},{key:"heading",get:function(){return this._heading},set:function(e){this._heading=e,this._lightCameraDirty=!0,this._scene.requestRender()}},{key:"pitch",get:function(){return this._pitch},set:function(e){this._pitch=e,this._lightCameraDirty=!0,this._scene.requestRender()}},{key:"horizontalFov",get:function(){return this._horizontalFov},set:function(e){this._horizontalFov=e,this._bugDistance=this._distance+1e-6*this._horizontalFov-1e-6*this._verticalFov,this._lightCameraDirty=!0,this._scene.requestRender()}},{key:"verticalFov",get:function(){return this._verticalFov},set:function(e){this._verticalFov=e,this._bugDistance=this._distance+1e-6*this._horizontalFov-1e-6*this._verticalFov,this._lightCameraDirty=!0,this._scene.requestRender()}},{key:"distance",get:function(){return this._distance},set:function(e){this._distance=e,this._bugDistance=this._distance+1e-6*this._horizontalFov-1e-6*this._verticalFov,this._lightCameraDirty=!0,this._scene.requestRender()}},{key:"updateCamera",value:function(){this._lightCamera.frustum.near=.001*this._bugDistance,this._lightCamera.frustum.far=this._bugDistance,this._lightCamera.frustum.fov=Cesium.Math.toRadians(this._verticalFov);var e=Cesium.Math.toRadians(this._horizontalFov),t=Cesium.Math.toRadians(this._verticalFov),e=(this._lightCamera.frustum.aspectRatio=this._bugDistance*Math.tan(.5*e)*2/(this._bugDistance*Math.tan(.5*t)*2),this._lightCamera.frustum.aspectRatio=Math.tan(.5*e)/Math.tan(.5*t),this._horizontalFov>this._verticalFov&&(this._lightCamera.frustum.fov=Cesium.Math.toRadians(this._horizontalFov)),this._lightCamera.setView({destination:this._viewerPosition,orientation:{heading:Cesium.Math.toRadians(this._heading),pitch:Cesium.Math.toRadians(this._pitch)}}),this._lightCameraPrimitive&&(this._lightCameraPrimitive.destroy(),this._lightCameraPrimitive=void 0),this.createOutLineGeometry());this._lightCameraPrimitive=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:e,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(this._outlineColor)}}),appearance:new Cesium.PerInstanceColorAppearance({translucent:!1,flat:!0}),modelMatrix:this._lightCamera.inverseViewMatrix,asynchronous:!1}),this._lightCameraDirty=!1}},{key:"createOutLineGeometry",value:function(){for(var e,t=new Float32Array(633),i=t,o=Cesium.Math.toRadians(this._horizontalFov),n=Cesium.Math.toRadians(this._verticalFov),s=Math.tan(.5*o),n=Math.tan(.5*n),s=this._distance*s,r=this._distance*n,a=-s,l=0,h=(i[l++]=0,i[l++]=0,i[l++]=0,Math.PI-.5*o),c=o/4,u=0;u<5;++u)for(var d=h+u*c,p=r/(this._distance/Math.cos(d)),p=Math.atan(p),m=-p,v=p/10,f=0;f<21;++f)e=m+f*v,i[l++]=this._distance*Math.cos(e)*Math.sin(d),i[l++]=this._distance*Math.sin(e),i[l++]=this._distance*Math.cos(e)*Math.cos(d);for(var c=o/20,y=0;y<21;++y){d=h+y*c;for(var g=r/(this._distance/Math.cos(d)),g=Math.atan(g),C=-g,w=g/2,b=0;b<5;++b)e=C+b*w,i[l++]=this._distance*Math.cos(e)*Math.sin(d),i[l++]=this._distance*Math.sin(e),i[l++]=this._distance*Math.cos(e)*Math.cos(d)}var n=new Cesium.GeometryAttributes({position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:t})}),s=new Uint16Array(408),P=s,k=0;P[k++]=0,P[k++]=1,P[k++]=0,P[k++]=21,P[k++]=0,P[k++]=85,P[k++]=0,P[k++]=105;for(var _=0,S=0;S<5;++S){_++;for(var T=0;T<20;++T)P[k++]=_++,P[k++]=_}a++;for(var M=0;M<20;++M)for(var L=0;L<5;++L)P[k++]=a,P[k++]=5+a++;return new Cesium.Geometry({attributes:n,indices:s,primitiveType:Cesium.PrimitiveType.LINES,boundingSphere:Cesium.BoundingSphere.fromVertices(t)})}},{key:"updateStage",value:function(){var t,i,o,n,e,s;this._stageDirty&&(this._stageDirty=!1,Cesium.defined(this._stage)&&(this._scene.postProcessStages.remove(this._stage),this._stage=void 0),t=new Cesium.Cartesian2,i=this._bias,o=this._shadowMap,n=this,e={shadowMap_texture:function(){return o._shadowMapTexture},shadowMap_matrix:function(){return o._shadowMapMatrix},viewShed_frontColor:function(){var e=n._visibleAreaColor.withAlpha(n._visibleAreaColorAlpha);return Cesium.Cartesian4.fromColor(e)},viewShed_backColor:function(){var e=n._hiddenAreaColor.withAlpha(n._hiddenAreaColorAlpha);Cesium.Cartesian4.fromColor(e);return n._hiddenAreaColor},viewShed_Far:function(){return o._lightCamera.frustum.far},shadowMap_lightheadingEC:function(){return o._lightheadingEC},shadowMap_lightPositionEC:function(){return o._lightPositionEC},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var e=t;return e.x=1/o._textureSize.x,e.y=1/o._textureSize.y,Cesium.Cartesian4.fromElements(e.x,e.y,i.depthBias,i.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return Cesium.Cartesian4.fromElements(i.normalOffsetScale,o._distance,o.maximumDistance,o._darkness,this.combinedUniforms2)},combinedUniforms1:new Cesium.Cartesian4,combinedUniforms2:new Cesium.Cartesian4},s=getPostStageFragmentShader(o,!1),this._stage=new Cesium.PostProcessStage({fragmentShader:s,uniforms:e}),this._scene.postProcessStages.add(this._stage))}},{key:"update",value:function(e){this._lightCameraDirty&&this.updateCamera(),this.updateStage(),e.shadowMaps.push(this._shadowMap),this._lightCameraPrimitive&&this._lightCameraPrimitive.update(e)}},{key:"destroy",value:function(){Cesium.defined(this._stage)&&(this._scene.postProcessStages.remove(this._stage),this._stage=void 0),this._shadowMap=this._shadowMap.destroy(),this._lightCameraPrimitive&&(this._lightCameraPrimitive.destroy(),this._lightCameraPrimitive=void 0)}}]),i}(),VisualTool=function(){function i(e,t){if(_classCallCheck(this,i),!Cesium.defined(e))throw new Cesium.DeveloperError("缺少地图对象！");this.viewer=e,this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.positions=[],this.prompt=null,this.startPosition=null,this.endPosition=null,this.vfPrimitive=null;this.opt=Object.assign({visibleAreaColor:"#00FF00",visibleAreaColorAlpha:1,hiddenAreaColor:"#FF0000",hiddenAreaColorAlpha:1,verticalFov:60,horizontalFov:120},t||{}),this.visibleAreaColor=this.opt.visibleAreaColor,this.hiddenAreaColor=this.opt.hiddenAreaColor,this.visibleAreaColorAlpha=this.opt.visibleAreaColorAlpha,this.hiddenAreaColorAlpha=this.opt.hiddenAreaColorAlpha,this.heading=this.opt.heading||0,this.pitch=this.opt.pitch||0,this.verticalFov=this.opt.verticalFov,this.horizontalFov=this.opt.horizontalFov,this.distance=0}return _createClass(i,[{key:"startDraw",value:function(n){var s=this;this.prompt||(this.prompt=new Prompt$1(this.viewer,this.promptStyle)),this.handler.setInputAction(function(e){e=s.getCatesian3FromPX(e.position,s.viewer);e&&(s.startPosition?(s.endPosition=e.clone(),s.handler&&(s.handler.destroy(),s.handler=null),s.prompt&&(s.prompt.destroy(),s.prompt=null)):s.startPosition=e.clone())},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){var t,i,o;s.startPosition?(s.prompt.update(e.endPosition,"再次单击结束"),(t=s.getCatesian3FromPX(e.endPosition,s.viewer))&&(s.vfPrimitive||(s.vfPrimitive=new VisualField(s.viewer,{cameraOptions:{viewerPosition:s.startPosition.clone(),visibleAreaColor:s.visibleAreaColor,visibleAreaColorAlpha:s.visibleAreaColorAlpha,hiddenAreaColor:s.hiddenAreaColor,hiddenAreaColorAlpha:s.hiddenAreaColorAlpha,horizontalFov:s.horizontalFov,verticalFov:s.verticalFov}}),s.viewer.scene.primitives.add(s.vfPrimitive)),i=Cesium.Cartographic.fromCartesian(s.startPosition.clone()),o=Cesium.Cartographic.fromCartesian(t.clone()),i=s.computeAngle(i,o),s.heading=i,s.vfPrimitive.heading=i,o=Cesium.Cartesian3.distance(s.startPosition.clone(),t.clone()),s.distance=o,s.vfPrimitive.distance=o,n&&n(heading,o))):s.prompt.update(e.endPosition,"单击开始绘制")},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"setVisibleAreaColor",value:function(e){e&&(this.visibleAreaColor=e,this.vfPrimitive&&(this.vfPrimitive.visibleAreaColor=e))}},{key:"setVisibleAreaColorAlpha",value:function(e){e&&(this.visibleAreaColorAlpha=Number(e),this.vfPrimitive&&(this.vfPrimitive.visibleAreaColorAlpha=Number(e)))}},{key:"setHiddenAreaColor",value:function(e){e&&(this.hiddenAreaColor=e,this.vfPrimitive&&(this.vfPrimitive.hiddenAreaColor=e))}},{key:"setHiddenAreaColorAlpha",value:function(e){e&&(this.hiddenAreaColorAlpha=Number(e),this.vfPrimitive&&(this.vfPrimitive.hiddenAreaColorAlpha=Number(e)))}},{key:"setDistance",value:function(e){e&&(this.distance=Number(e),this.vfPrimitive&&(this.vfPrimitive.distance=Number(e)))}},{key:"setVerticalFov",value:function(e){e&&(this.verticalFov=Number(e),this.vfPrimitive&&(this.vfPrimitive.verticalFov=Number(e)))}},{key:"setHorizontalFov",value:function(e){e&&(this.horizontalFov=Number(e),this.vfPrimitive&&(this.vfPrimitive.horizontalFov=Number(e)))}},{key:"setHeading",value:function(e){e&&(this.heading=0,this.vfPrimitive&&(this.vfPrimitive.heading=Number(e)))}},{key:"setPitch",value:function(e){e&&(this.pitch=Number(e),this.vfPrimitive&&(this.vfPrimitive.pitch=Number(e)))}},{key:"computeAngle",value:function(e,t){var i,o,n;if(e&&t)return i=e.longitude,e=e.latitude,o=t.longitude,t=t.latitude,n=Math.sin(o-i)*Math.cos(t),e=Math.cos(e)*Math.sin(t)-Math.sin(e)*Math.cos(t)*Math.cos(o-i),(t=180*(t=Math.atan2(n,e))/Math.PI)<-180&&(t+=360),t}},{key:"getCatesian3FromPX",value:function(e){for(var t,i=this.viewer.scene.drillPick(e),o=(this.viewer.scene.render(),!1),n=0;n<i.length;n++)if(i[n]&&i[n].primitive&&i[n].primitive instanceof Cesium.Cesium3DTileset){o=!0;break}if(o)t=this.viewer.scene.pickPosition(e);else{e=this.viewer.camera.getPickRay(e);if(!e)return null;t=this.viewer.scene.globe.pick(e,this.viewer.scene)}return t}},{key:"clear",value:function(){this.vfPrimitiv&&(this.viewer.scene.primitives.remove(this.vfPrimitive),this.vfPrimitive=null)}},{key:"destroy",value:function(){this.clear(),this.handler&&(this.handler.destroy(),this.handler=null),this.prompt&&(this.prompt.destroy(),this.prompt=null)}}]),i}(),Sunshine=function(){function i(e,t){_classCallCheck(this,i),this.viewer=e,this.opt=t||{},this._startTime=t.startTime||Cesium.JulianDate.fromDate((new Date).setHours(8),new Cesium.JulianDate),this._startTime instanceof Date&&(this._startTime=Cesium.JulianDate.fromDate(this._startTime,new Cesium.JulianDate)),this._endTime=t.endTime,this._endTime instanceof Date&&(this._endTime=Cesium.JulianDate.fromDate(this._endTime,new Cesium.JulianDate)),this.oldShouldAnimate=this.viewer.clock.shouldAnimate,this.multiplier=t.multiplier||60}return _createClass(i,[{key:"start",value:function(){this.viewer.clock.currentTime=this._startTime.clone(),this.viewer.clock.startTime=this._startTime.clone(),this.viewer.clock.shouldAnimate=!0,this.viewer.clock.multiplier=this.multiplier,this.viewer.scene.globe.enableLighting=!0,this.viewer.shadows=!0,this.viewer.clock.clockRange=Cesium.ClockRange.LOOP_STOP,this._endTime&&(this.viewer.clock.endTime=this._endTime.clone())}},{key:"end",value:function(){this.viewer.clock.clockRange=Cesium.ClockRange.UNBOUNDED,this.viewer.clock.shouldAnimate=this.oldShouldAnimate,this.viewer.clock.multiplier=1}},{key:"destroy",value:function(){this.viewer.clock.clockRange=Cesium.ClockRange.UNBOUNDED,this.viewer.clock.shouldAnimate=this.oldShouldAnimate,this.viewer.clock.multiplier=1}},{key:"pause",value:function(){this.viewer.clock.shouldAnimate=!this.viewer.clock.shouldAnimate}},{key:"startTime",get:function(){return this._startTime},set:function(e){e&&(this._startTime instanceof Date?this._startTime=Cesium.JulianDate.fromDate(this._startTime,new Cesium.JulianDate):this._startTime=e.clone(),this.start())}},{key:"endTime",get:function(){return this._endTime},set:function(e){e&&(this._endTime instanceof Date?this._endTime=Cesium.JulianDate.fromDate(this._startTime,new Cesium.JulianDate):this._endTime=e.clone(),this.start())}}]),i}();function FlowLineMaterial$1(e){this.defaultColor=new Cesium.Color(0,0,0,0),e=e||{},this._definitionChanged=new Cesium.Event,this._color=void 0,this.color=e.color||this.defaultColor,this._duration=e.duration||1e3,this.url=e.image,this._time=void 0,this.repeat=e.repeat||new Cesium.Cartesian2(1,1)}function FlyLineMaterial$1(e){this.defaultColor=new Cesium.Color(0,0,0,0),this._definitionChanged=new Cesium.Event,this._color=void 0,this.color=e.color||this.defaultColor,this.duration=e.duration||3e3,this.image=e.image,this.image||console.warn("缺少材质图片！")}function AnimateWall(e){this._definitionChanged=new Cesium.Event,this.color=e.color,this.duration=e.duration,this._time=(new Date).getTime(),e.image||console.log("未传入材料图片！"),this.image=e.image,this.repeat=e.repeat||new Cesium.Cartesian2(5,1),this.axisY=e.axisY}function AnimateWave(e){this._definitionChanged=new Cesium.Event,this._color=void 0,this.defaultColor=Cesium.Color.fromCssColorString("#02ff00"),this.color=Cesium.defaultValue(e.color,this.defaultColor),this._duration=e.duration||1e3,this._time=void 0}FlowLineMaterial$1.prototype.getType=function(e){return"FlowLine"},FlowLineMaterial$1.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).color=Cesium.Property.getValueOrClonedDefault(this._color,e,this.defaultColor,t.color),t.image=this.url,void 0===this._time&&(this._time=(new Date).getTime()),t.time=((new Date).getTime()-this._time)/this._duration,t.repeat=this.repeat,t},FlowLineMaterial$1.prototype.equals=function(e){return this===e||e instanceof FlowLineMaterial$1&&Cesium.Property.equals(this._color,e._color)&&this._image._value==e._image._value&&this.repeat.equals(e.repeat)},FlyLineMaterial$1.prototype.getType=function(e){return"FlyLine"},FlyLineMaterial$1.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),this._time||(this._time=(new Date).getTime()),t.color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=this.image,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t},FlyLineMaterial$1.prototype.equals=function(e){return this===e||e instanceof FlyLineMaterial$1&&Cesium.Property.equals(this._color,e._color)&&this._image._value==e._image._value&&this.repeat.equals(e.repeat)},AnimateWall.prototype.getType=function(e){return"AnimateWall"},AnimateWall.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=this.image,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t.axisY=this.axisY,t.repeat=this.repeat,t},AnimateWall.prototype.equals=function(e){return this===e||e instanceof AnimateWall&&Cesium.Property.equals(this._color,e._color)&&this._image._value==e._image._value&&this.repeat.equals(e.repeat)},AnimateWave.prototype.color=function(){return Cesium.createPropertyDescriptor("color")},AnimateWave.prototype.getType=function(){return"AnimateWave"},AnimateWave.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).color=Cesium.Property.getValueOrClonedDefault(this._color,e,this.color,t.color),void 0===this._time&&(this._time=(new Date).getTime()),t.time=((new Date).getTime()-this._time)/this._duration,t},AnimateWave.prototype.equals=function(e){return this===e||e instanceof AnimateWave&&Cesium.Property.equals(this._color,e._color)};var Cesium$1=require("cesium/Cesium.js");function registerAnimate(){return Object.defineProperties(FlowLineMaterial$1.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium$1.createPropertyDescriptor("color")}),Cesium$1.Material._materialCache.addMaterial("FlowLine",{fabric:{type:"FlowLine",uniforms:{color:new Cesium$1.Color(1,0,0,1),image:"",time:0,repeat:new Cesium$1.Cartesian2(1,1)},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                {\n                    czm_material material = czm_getDefaultMaterial(materialInput);\n                    vec2 st = repeat * materialInput.st;\n                    vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));\n                    if(color.a == 0.0)\n                    {\n                        material.alpha = colorImage.a;\n                        material.diffuse = colorImage.rgb; \n                    }\n                    else\n                    {\n                        material.alpha = colorImage.a * color.a;\n                        material.diffuse = max(color.rgb * material.alpha * 3.0, color.rgb); \n                    }\n                    return material;\n                }"},translucent:function(){return!0}}),Object.defineProperties(FlyLineMaterial$1.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium$1.createPropertyDescriptor("color")}),Cesium$1.Material._materialCache.addMaterial("FlyLine",{fabric:{type:"FlyLine",uniforms:{color:new Cesium$1.Color(1,0,0,.5),image:"",time:0},source:"\n            czm_material czm_getMaterial(czm_materialInput materialInput)\n            {\n                    czm_material material = czm_getDefaultMaterial(materialInput);\n                    vec2 st = materialInput.st;\n                    vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));\n                    material.alpha = colorImage.a * color.a;\n                    material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n                    return material;\n                }\n    "},translucent:function(e){return!0}}),Object.defineProperties(AnimateWall.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium$1.createPropertyDescriptor("color")}),Cesium$1.Material._materialCache.addMaterial("AnimateWall",{fabric:{type:"AnimateWall",uniforms:{color:new Cesium$1.Color(1,1,1,.5),image:"",time:0,repeat:new Cesium$1.Cartesian2(5,1),axisY:!1},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                            {\n                                czm_material material = czm_getDefaultMaterial(materialInput);\n                                vec2 st = repeat * materialInput.st;\n                                vec4 colorImage = texture2D(image, vec2(fract((axisY?st.s:st.t) - time), st.t));\n                                if(color.a == 0.0)\n                                {\n                                    material.alpha = colorImage.a;\n                                    material.diffuse = colorImage.rgb; \n                                }\n                                else\n                                {\n                                    material.alpha = colorImage.a * color.a;\n                                    material.diffuse = max(color.rgb * material.alpha * 3.0, color.rgb); \n                                }\n                                material.emission = colorImage.rgb;\n                                return material;\n                            }"},translucent:function(e){return!0}}),Object.defineProperties(AnimateWave.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}}),Cesium$1.Material._materialCache.addMaterial("AnimateWave",{fabric:{type:"AnimateWave",uniforms:{color:new Cesium$1.Color(1,0,0,1),time:10},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n                {\n                    czm_material material = czm_getDefaultMaterial(materialInput);\n                    material.diffuse = 1.5 * color.rgb;\n                    vec2 st = materialInput.st;\n                    float dis = distance(st, vec2(0.5, 0.5));\n                    float per = fract(time);\n                    if(dis > per * 0.5){\n                        discard;\n                    }else {\n                        material.alpha = color.a  * dis / per / 2.0;\n                    }\n                    return material;\n                }\n            "},translucent:function(){return!0}}),{FlowLineMaterial:FlowLineMaterial$1,FlyLineMaterial:FlyLineMaterial$1,AnimateWall:AnimateWall,AnimateWave:AnimateWave}}var analysis={VisualTool:VisualTool,Sunshine:Sunshine},weather={fog:fog,rain:rain,snow:snow},rganimate=registerAnimate(),animate={Wall:rganimate.AnimateWall,FlowLine:rganimate.FlowLineMaterial},MapViewer=function(){function i(e,t){_classCallCheck(this,i),e&&(this.domId=e,this.opt=t||{},this._viewer=null,this.baseLayerTool=null,this.operateLayerTool=null,this.operatePlotTool=null,this.rightTool=null,this.bottomLnglatTool=null,this.popupTooltipTool=null,this.createViewer(),this.loadbaseLayers(),this.loadOperateLayers(),this.terrainUrl="",(e=this.opt.map.terrain)&&e.url&&e.show&&this.loadTerrain(e.url),this.opt.map.bottomLnglatTool&&this.openBottomLnglatTool(),this.opt.map.rightTool&&this.openRightTool(),this.opt.map.popupTooltipTool&&this.openPopupTooltip(),this.opt.map.navigationTool&&this.openNavigationTool(),this.opt.map.worldAnimate?this.openWorldAnimate():this.opt.map.cameraView&&cUtil$1.setCameraView(this.opt.map.cameraView,this._viewer))}return _createClass(i,[{key:"viewer",get:function(){return this._viewer}},{key:"createViewer",value:function(){var e=this.opt.map.viewerConfig;this._viewer=new window.Cesium.Viewer(this.domId,e),this._viewer.imageryLayers.removeAll(),this._viewer._cesiumWidget._creditContainer.style.display="none",this._viewer.mapConfig=this.opt,this._viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.viewer.scene.globe.depthTestAgainstTerrain=this.opt.map.depthTestAgainstTerrain}},{key:"loadbaseLayers",value:function(){for(var e=(this.opt||[]).baseLayers,t=0;t<e.length;t++){var i=e[t];if(!i.type)return void console.log("缺少基础图层的图层类型",i);"group"!=i.type&&(i.id=i.id||(new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0),this.baseLayerTool||(this.baseLayerTool=new LayerTool(this._viewer)),this.baseLayerTool.add(i))}}},{key:"loadOperateLayers",value:function(){var e=(this.opt||[]).operateLayers,n=[];!function e(t){for(var i=0;i<t.length;i++){var o=t[i];o.id=o.id||(new Date).getTime()+""+Number(1e3*Math.random()).toFixed(0),o.alpha=null==o.alpha?1:o.alpha,o.children&&0<o.children.length?e(o.children):n.push(o)}}(e);for(var t=0;t<n.length;t++){var i=n[t];if(!i.type)return void console.log("缺少基础图层的图层类型",i);"group"!=i.type&&("plot"==i.type&&i.show?(this.operatePlotTool||(this.operatePlotTool=new DrawTool(this._viewer,{canEdit:!1})),i.type=i.plotType,this.operatePlotTool.createByPositions(i)):(this.operateLayerTool||(this.operateLayerTool=new LayerTool(this._viewer)),this.operateLayerTool.add(i)))}}},{key:"loadTerrain",value:function(e){this._viewer.scene.terrainProvider=new Cesium.EllipsoidTerrainProvider({}),(this.terrainUrl=e)&&(e=new Cesium.CesiumTerrainProvider({url:e}),this._viewer.scene.terrainProvider=e)}},{key:"setTerrainVisible",value:function(e){e?this.loadTerrain(this.terrainUrl):this._viewer.scene.terrainProvider=new Cesium.EllipsoidTerrainProvider({}),this._viewer.scene.render()}},{key:"openRightTool",value:function(){this.rightTool||(this.rightTool=new RightTool(this.viewer,{}))}},{key:"closeRightTool",value:function(){this.rightTool&&(this.rightTool.destroy(),this.rightTool=null)}},{key:"openPopupTooltip",value:function(){this.popupTooltip||(this.popupTooltip=new PopupTooltipTool(this.viewer,{}),this.popupTooltip.autoBindTooltip(),this.popupTooltip.autoBindPopup())}},{key:"openBottomLnglatTool",value:function(){this.bottomLnglatTool||(this.bottomLnglatTool=new LatlngNavigation(this._viewer))}},{key:"closeBottomLnglatTool",value:function(){this.bottomLnglatTool&&(this.bottomLnglatTool.destroy(),this.bottomLnglatTool=null)}},{key:"openWorldAnimate",value:function(){var e=this;easy3dView.setRotate({x:this.opt.map.cameraView.x,y:this.opt.map.cameraView.y},function(){e.opt.map.cameraView&&cUtil$1.setCameraView(e.opt.map.cameraView)})}},{key:"openNavigationTool",value:function(){new CesiumNavigation(this._viewer,{enableCompass:!0,enableZoomControls:!0,enableDistanceLegend:!0,enableCompassOuterRing:!0,view:this.viewer.mapConfig.map&&this.viewer.mapConfig.map.cameraView})}},{key:"destroy",value:function(){this.baseLayerTool&&(this.baseLayerTool.destroy(),this.baseLayerTool=null),this.operateLayerTool&&(this.operateLayerTool.destroy(),this.operateLayerTool=null),this.operatePlotTool&&(this.operatePlotTool.destroy(),this.operatePlotTool=null),this.bottomLnglatTool&&(this.bottomLnglatTool.destroy(),this.bottomLnglatTool=null),this._viewer&&(this._viewer.destroy(),this._viewer=null)}}]),i}(),easy3d_export={cUtil:cUtil$1,cTool:cTool,MapViewer:MapViewer,DrawTool:DrawTool,LayerTool:LayerTool,MeasureTool:MeasureTool,Prompt:Prompt$1,gadgets:gadgets,RoamTool:RoamTool,ZoomTool:ZoomTool,OverviewMap:OverviewMap,weather:weather,animate:animate,analysis:analysis,LayerSplit:LayerSplit};module.exports=easy3d_export;
